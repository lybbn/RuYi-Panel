var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{r as o,i as s,n,k as r,ag as u,aq as d,c,o as p,P as f,H as h,a as m,I as v,V as g,O as w,a6 as y,u as b,J as _,L as k,M as x,G as j,t as S}from"./@vue.CQt2tj-6.js";import{_ as C,u as F,m as O,B as I,C as P,F as L,G as V,I as R,i as B,A as D,K as z}from"./index.9wSm1W-X.js";import{L as U}from"./dialog.sg3oaGqx.js";import{P as A}from"./Pagination.Nl1ehftE.js";import{E}from"./element-plus.C3E-FvSa.js";function M(e){const a=o(!1),l=o(""),t=o();s(a,(a=>{a&&(l.value=e.value.length>0?e.value.at(-1).url:"",n((()=>{t.value.focus()})))}));return{pathSearchFilterStatus:a,searchPath:l,searchPathInputRef:t,searchPathInputBlur:()=>{a.value=!1}}}const T={class:"lyfileselect"},q={ref:"tableSelect"},G={class:"handle-path-filter-right"},H={class:"handle-path-filter-right-inner"},J={key:0,class:"right-arrow"},K={class:"flex-center"},N={key:0,class:"ruyi-fileicons",src:O},Q={key:1,class:"ruyi-fileicons",src:I},W={key:2,class:"ruyi-fileicons",src:P},X={key:3,class:"ruyi-fileicons",src:L},Y={key:4,class:"ruyi-fileicons",src:V},Z={key:6,class:"ruyi-fileicons",src:R},$={key:0},ee={key:1},ae={key:0},le={key:1},te=C({__name:"fileList",props:{multiple:{type:Boolean,default:!1},onlyFileSelect:{type:Boolean,default:!1}},emits:["change","closed"],setup(e,{expose:s,emit:n}){const C=n,O=F();r((()=>O.ismobile));let I=o(!1),P=o(!1),L=o(!1),V=o(""),R=o(!1),te=o([]),ie=o(0),oe=o(0),se=o([]);M(se);let ne=o({path:"default",sort:"name",order:"asc",search:"",isDir:!1,containSub:!1,page:1,limit:100}),re=o({page:1,limit:100,total:0});function ue(){C("closed")}let de=o(null),ce=o([]);function pe(e){ce.value=[],e.length>1&&(e.shift(),de.value.clearSelection(),de.value.toggleRowSelection(e[0])),ce.value=e}let fe=r((()=>{let e=!0;return ce.value.forEach((a=>{"file"!=a.type&&(e=!1)})),!(ce.value.length<1)&&e}));function he(e){ne.value.page=e.page,ne.value.limit=e.limit,me("list_dir")}function me(e="list_dir"){L.value=!0;let o=((e,o)=>{for(var s in o||(o={}))l.call(o,s)&&i(e,s,o[s]);if(a)for(var s of a(o))t.call(o,s)&&i(e,s,o[s]);return e})({},ne.value);o.action=e,D.sysFileManage(o).then((e=>{L.value=!1,2e3==e.code?(te.value=e.data.data.data,se.value=e.data.data.paths,ie.value=e.data.data.file_nums,oe.value=e.data.data.dir_nums,re.value.page=e.data.page,re.value.limit=e.data.limit,re.value.total=e.data.total,R.value=e.data.data.is_windows,ne.value.path=e.data.data.path):E.warning(e.msg)}))}function ve(e){ne.value.sort="name",ne.value.order="asc",ne.value.path=e,me("list_dir")}function ge(){ne.value.sort="name",ne.value.order="asc",ne.value.path="",me("list_dir")}function we(e){const a=e.split(".").pop();return(a==e?"":a).toLowerCase()}function ye(e){let a=we(e);return"png"===a||"jpg"===a||"jpeg"===a||"gif"===a||"webp"===a}function be(e){let a=we(e);return"mp4"===a||"flv"===a||"m4a"===a||"avi"===a}function _e(){ne.value.page=1,ne.value.limit=100,me("list_dir")}function ke({row:e,column:a,rowIndex:l,columnIndex:t}){if(0===t)return"chooseAllbtn"}function xe(){if(ce.value.length>0)C("change",ce.value[0].path),ue();else{if(R&&""===ne.value.path)return void E.warning("\u8bf7\u9009\u62e9\u5177\u4f53\u76ee\u5f55\u6216\u78c1\u76d8");C("change",ne.value.path),ue()}}return s({handleOpen:function(e,a){if(V.value=a,I.value=!0,e){const a=B(e);ne.value.path=a.path,ne.value.isDir=void 0!==a.isDir&&a.isDir,me("list_dir")}}}),(a,l)=>{const t=u("el-button"),i=u("HomeFilled"),o=u("el-icon"),s=u("el-link"),n=u("el-col"),r=u("el-row"),C=u("el-table-column"),F=u("MessageBox"),O=u("el-table"),R=d("loading");return p(),c("div",T,[f(U,{modelValue:b(I),"onUpdate:modelValue":l[0]||(l[0]=e=>S(I)?I.value=e:I=e),title:b(V),width:"680px","before-close":ue,showFullScreen:!1,draggable:!1},{footer:h((()=>[l[3]||(l[3]=m("div",{style:{float:"left","font-size":"14px"}},"\u8bf7\u52fe\u9009\u590d\u9009\u6846",-1)),f(t,{onClick:ue,loading:b(P)},{default:h((()=>l[1]||(l[1]=[k("\u5173\u95ed")]))),_:1},8,["loading"]),f(t,{type:"primary",onClick:xe,loading:b(P),disabled:e.onlyFileSelect&&!b(fe)},{default:h((()=>l[2]||(l[2]=[k("\u9009\u62e9")]))),_:1},8,["loading","disabled"])])),default:h((()=>[m("div",q,[f(r,{class:"handle-header"},{default:h((()=>[f(n,{xs:24,sm:24,md:24,lg:24,xl:24,class:"handle-path-filter"},{default:h((()=>[m("div",null,[f(t,{icon:"Refresh",onClick:_e,size:"small"})]),m("div",G,[m("span",H,[m("span",null,[f(s,{onClick:g(ge,["stop"])},{default:h((()=>[f(o,{size:20},{default:h((()=>[f(i)])),_:1})])),_:1})]),(p(!0),c(w,null,y(b(se),(e=>(p(),c("span",{key:e.url,class:"flex-center"},[e.url?(p(),c("span",J,">")):_("",!0),f(s,{onClick:g((a=>ve(e.url)),["stop"])},{default:h((()=>[k(x(e.name),1)])),_:2},1032,["onClick"])])))),128))])])])),_:1})])),_:1})],512),v((p(),j(O,{ref_key:"ruyFileTtableRef",ref:de,"header-cell-class-name":ke,data:b(te),height:"40vh",style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},onSelectionChange:pe},{default:h((()=>[f(C,{type:"selection",width:"30"}),f(C,{prop:"name",label:"\u540d\u79f0","min-width":"200","show-overflow-tooltip":""},{default:h((e=>[m("div",K,["dir"==e.row.type?(p(),c("img",N)):"file"==e.row.type&&"py"===we(e.row.path)?(p(),c("img",Q)):"file"==e.row.type&&"php"===we(e.row.path)?(p(),c("img",W)):"file"==e.row.type&&ye(e.row.path)?(p(),c("img",X)):"file"==e.row.type&&be(e.row.path)?(p(),c("img",Y)):"pan"==e.row.type?(p(),j(o,{key:5,size:20},{default:h((()=>[f(F)])),_:1})):(p(),c("img",Z)),f(s,{type:"primary",onClick:g((a=>function(e){if("dir"==e.type||"pan"==e.type)ve(e.path);else if("file"==e.type)if(ye(e.name))D.sysFileDownload({filename:e.path}).then((e=>{if("application/json"==e.headers["content-type"]){const a=new FileReader;a.readAsText(e.data),a.onload=()=>{const e=JSON.parse(a.result);E.warning(e.msg)}}else{const a=window.URL.createObjectURL(new Blob([e.data]));imageViewerUrlList.value=[a],showImageViewer.value=!0}}));else if(be(e.name))isVideoDialogShow.value=!0,nextTick((()=>{moduleLyVideoFlag.value.handleOpen(e.path,"\u89c6\u9891\u64ad\u653e")}));else if(!z(e.name))return void E.warning("\u8be5\u6587\u4ef6\u4e0d\u652f\u6301\u5728\u7ebf\u7f16\u8f91")}(e.row)),["stop"]),style:{"margin-left":"5px"}},{default:h((()=>[k(x(e.row.name),1)])),_:2},1032,["onClick"])])])),_:1}),f(C,{label:"\u6743\u9650",width:"70","show-overflow-tooltip":""},{default:h((e=>[e.row.permissions?(p(),c("span",$,x(e.row.permissions),1)):(p(),c("span",ee))])),_:1}),f(C,{label:"\u7528\u6237",width:"130","show-overflow-tooltip":""},{default:h((e=>[e.row.owner?(p(),c("span",ae,x(e.row.owner),1)):(p(),c("span",le,"\u5931\u8d25"))])),_:1}),f(C,{prop:"modified",label:"\u4fee\u6539\u65f6\u95f4",width:"170"})])),_:1},8,["data"])),[[R,b(L)]]),f(A,{small:!0,"child-msg":b(re),onCallFather:he,border:!1,position:"center"},null,8,["child-msg"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-9d686248"]]);export{te as l,M as u};
