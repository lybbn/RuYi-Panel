var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{b as o,e as s,n,k as r,ag as u,aq as p,o as d,c,P as f,H as h,a as m,u as v,L as g,V as w,O as y,a4 as b,K as _,M as k,I as x,G as j,t as S}from"./@vue.BluSRtaz.js";import{u as C,m as F,r as O,s as P,x as I,y as L,B as V,i as R,A as B,C as D}from"./index.CzVJI0jJ.js";import{L as z}from"./dialog.BvK2-1BY.js";import{P as T}from"./Pagination.DhOoI1te.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as A}from"./element-plus.CMBwCou9.js";function E(e){const a=o(!1),l=o(""),t=o();s(a,(a=>{a&&(l.value=e.value.length>0?e.value.at(-1).url:"",n((()=>{t.value.focus()})))}));return{pathSearchFilterStatus:a,searchPath:l,searchPathInputRef:t,searchPathInputBlur:()=>{a.value=!1}}}const M={class:"lyfileselect"},H={ref:"tableSelect"},q={class:"handle-path-filter-right"},G={class:"handle-path-filter-right-inner"},J={key:0,class:"right-arrow"},K={class:"flex-center"},N={key:0,class:"ruyi-fileicons",src:F},Q={key:1,class:"ruyi-fileicons",src:O},W={key:2,class:"ruyi-fileicons",src:P},X={key:3,class:"ruyi-fileicons",src:I},Y={key:4,class:"ruyi-fileicons",src:L},Z={key:6,class:"ruyi-fileicons",src:V},$={key:0},ee={key:1},ae={key:0},le={key:1},te=U({__name:"fileList",props:{multiple:{type:Boolean,default:!1},onlyFileSelect:{type:Boolean,default:!1}},emits:["change","closed"],setup(e,{expose:s,emit:n}){const F=n,O=C();r((()=>O.ismobile));let P=o(!1),I=o(!1),L=o(!1),V=o(""),U=o(!1),te=o([]),ie=o(0),oe=o(0),se=o([]);E(se);let ne=o({path:"default",sort:"name",order:"asc",search:"",isDir:!1,containSub:!1,page:1,limit:100}),re=o({page:1,limit:100,total:0});function ue(){F("closed")}let pe=o(null),de=o([]);function ce(e){de.value=[],e.length>1&&(e.shift(),pe.value.clearSelection(),pe.value.toggleRowSelection(e[0])),de.value=e}let fe=r((()=>{let e=!0;return de.value.forEach((a=>{"file"!=a.type&&(e=!1)})),!(de.value.length<1)&&e}));function he(e){ne.value.page=e.page,ne.value.limit=e.limit,me("list_dir")}function me(e="list_dir"){L.value=!0;let o=((e,o)=>{for(var s in o||(o={}))l.call(o,s)&&i(e,s,o[s]);if(a)for(var s of a(o))t.call(o,s)&&i(e,s,o[s]);return e})({},ne.value);o.action=e,B.sysFileManage(o).then((e=>{L.value=!1,2e3==e.code?(te.value=e.data.data.data,se.value=e.data.data.paths,ie.value=e.data.data.file_nums,oe.value=e.data.data.dir_nums,re.value.page=e.data.page,re.value.limit=e.data.limit,re.value.total=e.data.total,U.value=e.data.data.is_windows,ne.value.path=e.data.data.path):A.warning(e.msg)}))}function ve(e){ne.value.sort="name",ne.value.order="asc",ne.value.path=e,me("list_dir")}function ge(){ne.value.sort="name",ne.value.order="asc",ne.value.path="",me("list_dir")}function we(e){const a=e.split(".").pop();return(a==e?"":a).toLowerCase()}function ye(e){let a=we(e);return"png"===a||"jpg"===a||"jpeg"===a||"gif"===a||"webp"===a}function be(e){let a=we(e);return"mp4"===a||"flv"===a||"m4a"===a||"avi"===a}function _e(){ne.value.page=1,ne.value.limit=100,me("list_dir")}function ke({row:e,column:a,rowIndex:l,columnIndex:t}){if(0===t)return"chooseAllbtn"}function xe(){if(de.value.length>0)F("change",de.value[0].path),ue();else{if(U&&""===ne.value.path)return void A.warning("\u8bf7\u9009\u62e9\u5177\u4f53\u76ee\u5f55\u6216\u78c1\u76d8");F("change",ne.value.path),ue()}}return s({handleOpen:function(e,a){if(V.value=a,P.value=!0,e){const a=R(e);ne.value.path=a.path,ne.value.isDir=void 0!==a.isDir&&a.isDir,me("list_dir")}}}),(a,l)=>{const t=u("el-button"),i=u("HomeFilled"),o=u("el-icon"),s=u("el-link"),n=u("el-col"),r=u("el-row"),C=u("el-table-column"),F=u("MessageBox"),O=u("el-table"),R=p("loading");return d(),c("div",M,[f(z,{modelValue:v(P),"onUpdate:modelValue":l[0]||(l[0]=e=>S(P)?P.value=e:P=e),title:v(V),width:"680px","before-close":ue,showFullScreen:!1,draggable:!1},{footer:h((()=>[l[3]||(l[3]=m("div",{style:{float:"left","font-size":"14px"}},"\u8bf7\u52fe\u9009\u590d\u9009\u6846",-1)),f(t,{onClick:ue,loading:v(I)},{default:h((()=>l[1]||(l[1]=[g("\u5173\u95ed")]))),_:1},8,["loading"]),f(t,{type:"primary",onClick:xe,loading:v(I),disabled:e.onlyFileSelect&&!v(fe)},{default:h((()=>l[2]||(l[2]=[g("\u9009\u62e9")]))),_:1},8,["loading","disabled"])])),default:h((()=>[m("div",H,[f(r,{class:"handle-header"},{default:h((()=>[f(n,{xs:24,sm:24,md:24,lg:24,xl:24,class:"handle-path-filter"},{default:h((()=>[m("div",null,[f(t,{icon:"Refresh",onClick:_e,size:"small"})]),m("div",q,[m("span",G,[m("span",null,[f(s,{onClick:w(ge,["stop"])},{default:h((()=>[f(o,{size:20},{default:h((()=>[f(i)])),_:1})])),_:1})]),(d(!0),c(y,null,b(v(se),(e=>(d(),c("span",{key:e.url,class:"flex-center"},[e.url?(d(),c("span",J,">")):_("",!0),f(s,{onClick:w((a=>ve(e.url)),["stop"])},{default:h((()=>[g(k(e.name),1)])),_:2},1032,["onClick"])])))),128))])])])),_:1})])),_:1})],512),x((d(),j(O,{ref_key:"ruyFileTtableRef",ref:pe,"header-cell-class-name":ke,data:v(te),height:"40vh",style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},onSelectionChange:ce},{default:h((()=>[f(C,{type:"selection",width:"30"}),f(C,{prop:"name",label:"\u540d\u79f0","min-width":"200","show-overflow-tooltip":""},{default:h((e=>[m("div",K,["dir"==e.row.type?(d(),c("img",N)):"file"==e.row.type&&"py"===we(e.row.path)?(d(),c("img",Q)):"file"==e.row.type&&"php"===we(e.row.path)?(d(),c("img",W)):"file"==e.row.type&&ye(e.row.path)?(d(),c("img",X)):"file"==e.row.type&&be(e.row.path)?(d(),c("img",Y)):"pan"==e.row.type?(d(),j(o,{key:5,size:20},{default:h((()=>[f(F)])),_:1})):(d(),c("img",Z)),f(s,{type:"primary",onClick:w((a=>function(e){if("dir"==e.type||"pan"==e.type)ve(e.path);else if("file"==e.type)if(ye(e.name))B.sysFileDownload({filename:e.path}).then((e=>{if("application/json"==e.headers["content-type"]){const a=new FileReader;a.readAsText(e.data),a.onload=()=>{const e=JSON.parse(a.result);A.warning(e.msg)}}else{const a=window.URL.createObjectURL(new Blob([e.data]));imageViewerUrlList.value=[a],showImageViewer.value=!0}}));else if(be(e.name))isVideoDialogShow.value=!0,nextTick((()=>{moduleLyVideoFlag.value.handleOpen(e.path,"\u89c6\u9891\u64ad\u653e")}));else if(!D(e.name))return void A.warning("\u8be5\u6587\u4ef6\u4e0d\u652f\u6301\u5728\u7ebf\u7f16\u8f91")}(e.row)),["stop"]),style:{"margin-left":"5px"}},{default:h((()=>[g(k(e.row.name),1)])),_:2},1032,["onClick"])])])),_:1}),f(C,{label:"\u6743\u9650",width:"70","show-overflow-tooltip":""},{default:h((e=>[e.row.permissions?(d(),c("span",$,k(e.row.permissions),1)):(d(),c("span",ee))])),_:1}),f(C,{label:"\u7528\u6237",width:"130","show-overflow-tooltip":""},{default:h((e=>[e.row.owner?(d(),c("span",ae,k(e.row.owner),1)):(d(),c("span",le,"\u5931\u8d25"))])),_:1}),f(C,{prop:"modified",label:"\u4fee\u6539\u65f6\u95f4",width:"170"})])),_:1},8,["data"])),[[R,v(L)]]),f(T,{small:!0,"child-msg":v(re),onCallFather:he,border:!1,position:"center"},null,8,["child-msg"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-9d686248"]]);export{te as l,E as u};
