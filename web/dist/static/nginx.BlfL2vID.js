import{c as e,A as a}from"./index.DdU3pFbI.js";import{l as o}from"./index.GhyFdw6y.js";import{_ as l}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as t,a as n}from"./element-plus.CMBwCou9.js";import{b as s,j as i,ag as r,o as d,G as u,H as c,P as p,a as m,M as _,u as g,C as f,L as b,K as v,t as h,n as y}from"./@vue.BluSRtaz.js";import"./axios.3Xbkft1r.js";import"./crypto-js.CCePG2on.js";import"./@xterm.8vZnc5Va.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.CjTOZN0C.js";import"./clipboard.55ERAcYO.js";import"./pinia.DhJalR8o.js";import"./@element-plus.sBVz1STF.js";import"./vue-router.CjawWhbh.js";import"./nprogress.B5M_jmCc.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.BccSst5e.js";import"./@vueuse.l0Dx-5Bl.js";import"./@popperjs.CpAfbxx4.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.9DdhAVak.js";import"./async-validator.Cuo4gI4y.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.CUoAWVRo.js";import"./@floating-ui.yzr8CaSr.js";import"./vue-codemirror.DFdUdG36.js";import"./codemirror.BJSsQESG.js";import"./@codemirror.BkM7iGym.js";import"./@lezer.CzslrRCj.js";import"./crelt.DSg10-ms.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const z={class:"statusc"},k={class:"lyflex status"},j={class:"lyflex opbtn"},V=l({__name:"nginx",props:{data:{type:Object}},emits:["refreshStatus"],setup(l,{emit:V}){const I=e(),w=V,x=l;let C=s("status"),L=s({id:null,name:"",error_log:"",status:!1,loadstatus:{},conf:"",oldConf:""}),M=s({worker_connections:1024,worker_processes:"auto",server_names_hash_bucket_size:1,client_header_buffer_size:2,client_max_body_size:1,client_body_buffer_size:16,keepalive_timeout:60,gzip_min_length:1,gzip_comp_level:2,gzip:"on"});function S(e,a){return{required:!0,trigger:"blur",min:e,max:a,type:"number",message:`\u6570\u5b57\u53ef\u9009\u8303\u56f4${e}\u5230${a}`}}let U=s({worker_processes:[{required:!0,message:"\u8bf7\u8f93\u5165\u5de5\u4f5c\u8fdb\u7a0b\u6570\u91cf\uff1aauto\u6216\u5177\u4f53\u6570\u503c",trigger:"blur"},{validator:function(e,a,o){return"auto"===a?o():/^\d+$/.test(a)?parseInt(a,10)<1?o(new Error("\u503c\u5fc5\u987b\u4e3a\u6b63\u6574\u6570")):void o():o(new Error('\u503c\u4e3a\u5177\u4f53\u6570\u5b57\u6216"auto"'))},trigger:"blur"}],worker_connections:[S(1,999999999)],server_names_hash_bucket_size:[S(1,9999)],client_header_buffer_size:[S(0,999999999)],client_max_body_size:[S(0,999999999)],client_body_buffer_size:[S(0,999999999)],keepalive_timeout:[S(0,999999999)],gzip:[{required:!0,trigger:"blur",message:"\u5fc5\u586b\u9879"}],gzip_min_length:[{required:!0,trigger:"change",message:"\u8bf7\u9009\u62e9"}],gzip_comp_level:[S(1,9)]}),W=s(null);function B(){W.value.validate((e=>{if(e){I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u4fdd\u5b58...";let e={id:L.value.id,cont:M.value,action:"set_performance"};a.sysSoftManage(e).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?t.success(e.msg):t.warning(e.msg)}))}}))}function T(e="stop"){let o="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",l=!1,s="\u542f\u52a8\u6210\u529f";"stop"==e?(I.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",l=!1,s="\u505c\u6b62\u6210\u529f"):"reload"==e?(I.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",o="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",l=!0,s="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==e&&(I.loadingInfo.content=L.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",o=L.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",l=!0,s=L.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),n.confirm(`${o}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((o=>{I.loadingInfo.isLoading=!0,a.sysSoftManage({id:L.value.id,status:e,action:"status"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?(t.success(s),L.value.status=l,w("refreshStatus",{id:L.value.id,status:l})):t.warning(e.msg)}))})).catch((()=>{}))}let q=s(null);let A=s(null);function R(e){"error_log"==e.props.name?(I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u9519\u8bef\u65e5\u5fd7...",a.sysSoftManage({id:L.value.id,action:"get_error_log"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?(L.value.error_log=e.data,y((()=>{q.value&&q.value.scrollToBottom()}))):t.warning(e.msg)}))):"access_log"==e.props.name?(I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u8bbf\u95ee\u65e5\u5fd7...",a.sysSoftManage({id:L.value.id,action:"get_access_log"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?(L.value.access_log=e.data,y((()=>{A.value&&A.value.scrollToBottom()}))):t.warning(e.msg)}))):"loadstatus"===e.props.name?(I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u8d1f\u8f7d\u72b6\u6001...",a.sysSoftManage({id:L.value.id,action:"get_loadstatus"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?L.value.loadstatus=e.data:t.warning(e.msg)}))):"edit_conf"===e.props.name?(I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6...",a.sysSoftManage({id:L.value.id,action:"get_conf"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?(L.value.conf=e.data,L.value.oldConf=e.data):t.warning(e.msg)}))):"performanceSettings"===e.props.name&&(I.loadingInfo.isLoading=!0,I.loadingInfo.content="",a.sysSoftManage({id:L.value.id,action:"get_performance"}).then((e=>{I.loadingInfo.isLoading=!1,2e3==e.code?M.value=e.data:t.warning(e.msg)})))}function N(){if(L.value.oldConf==L.value.conf)return void t.warning("\u914d\u7f6e\u6587\u4ef6\u672a\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58!!!");if(""==L.value.conf||null==L.value.conf)return void t.warning("\u914d\u7f6e\u6587\u4ef6\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u914d\u7f6e");n.confirm("\u786e\u5b9a\u8981\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{I.loadingInfo.isLoading=!0,I.loadingInfo.content="\u6b63\u5728\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6...",a.sysSoftManage({id:L.value.id,conf:L.value.conf,action:"save_conf"}).then((e=>{I.loadingInfo.isLoading=!1,I.loadingInfo.content="",2e3==e.code?t.success("\u4fdd\u5b58\u6210\u529f"):t.warning(e.msg)}))})).catch((()=>{}))}return i((()=>{L.value.id=x.data.id,L.value.name=x.data.name,L.value.status=x.data.status})),(e,a)=>{const l=r("CaretRight"),t=r("el-icon"),n=r("el-button"),s=r("el-tab-pane"),i=r("el-input"),y=r("el-form-item"),V=r("el-col"),I=r("el-option"),w=r("el-select"),x=r("el-row"),S=r("el-form"),E=r("el-descriptions-item"),K=r("el-descriptions"),$=r("el-tabs");return d(),u($,{"tab-position":"left",modelValue:g(C),"onUpdate:modelValue":a[16]||(a[16]=e=>h(C)?C.value=e:C=e),onTabClick:R},{default:c((()=>[p(s,{label:"\u670d\u52a1\u72b6\u6001",name:"status"},{default:c((()=>[m("div",z,[m("div",k,[m("div",null,"\u5f53\u524d\u72b6\u6001\uff1a"+_(g(L).status?"\u542f\u52a8":"\u505c\u6b62"),1),p(t,{class:f(g(L).status?"on":"off")},{default:c((()=>[p(l)])),_:1},8,["class"])]),m("div",j,[p(n,{onClick:a[0]||(a[0]=e=>T("restart"))},{default:c((()=>[b(_(g(L).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1}),p(n,{onClick:a[1]||(a[1]=e=>T("stop")),disabled:!g(L).status},{default:c((()=>a[17]||(a[17]=[b("\u505c\u6b62")]))),_:1},8,["disabled"]),p(n,{onClick:a[2]||(a[2]=e=>T("reload")),disabled:!g(L).status},{default:c((()=>a[18]||(a[18]=[b("\u91cd\u8f7d\u914d\u7f6e")]))),_:1},8,["disabled"])])])])),_:1}),p(s,{label:"\u6027\u80fd\u8c03\u6574",name:"performanceSettings"},{default:c((()=>["performanceSettings"==g(C)?(d(),u(S,{key:0,model:g(M),rules:g(U),ref_key:"performanceRef",ref:W,"label-position":"top"},{default:c((()=>[p(x,{gutter:20},{default:c((()=>[p(V,{xs:24,sm:24,md:12,lg:12,xl:12},{default:c((()=>[p(y,{label:"worker_processes",prop:"worker_processes"},{default:c((()=>[p(i,{clearable:"",modelValue:g(M).worker_processes,"onUpdate:modelValue":a[3]||(a[3]=e=>g(M).worker_processes=e)},null,8,["modelValue"]),a[19]||(a[19]=m("span",{class:"right-tips"},"\u5de5\u4f5c\u8fdb\u7a0b\u6570\u91cf(auto\u4e3a\u81ea\u52a8,\u8303\u56f41\u5230cpu\u6838\u5fc3\u6570)",-1))])),_:1}),p(y,{label:"worker_connections",prop:"worker_connections"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).worker_connections,"onUpdate:modelValue":a[4]||(a[4]=e=>g(M).worker_connections=e),modelModifiers:{number:!0}},null,8,["modelValue"]),a[20]||(a[20]=m("span",{class:"right-tips"},"\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u540c\u65f6\u5904\u7406\u7684\u6700\u5927\u8fde\u63a5\u6570",-1))])),_:1}),p(y,{label:"server_names_hash_bucket_size",prop:"server_names_hash_bucket_size"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).server_names_hash_bucket_size,"onUpdate:modelValue":a[5]||(a[5]=e=>g(M).server_names_hash_bucket_size=e),modelModifiers:{number:!0}},{append:c((()=>a[21]||(a[21]=[b("bytes")]))),_:1},8,["modelValue"]),a[22]||(a[22]=m("span",{class:"right-tips"},"\u670d\u52a1\u5668\u540d\u5b57\u7684hash\u8868\u5927\u5c0f(\u503c\u8d8a\u5927\u5360\u7528\u5185\u5b58\u8d8a\u5927)",-1))])),_:1}),p(y,{label:"client_header_buffer_size",prop:"client_header_buffer_size"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).client_header_buffer_size,"onUpdate:modelValue":a[6]||(a[6]=e=>g(M).client_header_buffer_size=e),modelModifiers:{number:!0}},{append:c((()=>a[23]||(a[23]=[b("KB")]))),_:1},8,["modelValue"]),a[24]||(a[24]=m("span",{class:"right-tips"},"\u8bf7\u6c42\u5934\u90e8\u7f13\u51b2\u533a\u5927\u5c0f(\u9632\u6b62\u8bf7\u6c42\u5934\u8fc7\u5927\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\u6216\u6027\u80fd\u95ee\u9898)",-1))])),_:1}),p(y,{label:"client_max_body_size",prop:"client_max_body_size"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).client_max_body_size,"onUpdate:modelValue":a[7]||(a[7]=e=>g(M).client_max_body_size=e),modelModifiers:{number:!0}},{append:c((()=>a[25]||(a[25]=[b("MB")]))),_:1},8,["modelValue"]),a[26]||(a[26]=m("span",{class:"right-tips"},"\u63a7\u5236\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u6700\u5927\u503c",-1))])),_:1})])),_:1}),p(V,{xs:24,sm:24,md:12,lg:12,xl:12},{default:c((()=>[p(y,{label:"client_body_buffer_size",prop:"client_body_buffer_size"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).client_body_buffer_size,"onUpdate:modelValue":a[8]||(a[8]=e=>g(M).client_body_buffer_size=e),modelModifiers:{number:!0}},{append:c((()=>a[27]||(a[27]=[b("KB")]))),_:1},8,["modelValue"]),a[28]||(a[28]=m("span",{class:"right-tips"},"\u8bf7\u6c42\u4e3b\u4f53\u7f13\u51b2\u533a\u5927\u5c0f(\u503c\u8d8a\u5927\u4f1a\u6d88\u8017\u66f4\u591a\u5185\u5b58,\u4e34\u65f6\u6587\u4ef6\u4f1a\u8d8a\u5c11)",-1))])),_:1}),p(y,{label:"keepalive_timeout",prop:"keepalive_timeout"},{default:c((()=>[p(i,{clearable:"",type:"number",modelValue:g(M).keepalive_timeout,"onUpdate:modelValue":a[9]||(a[9]=e=>g(M).keepalive_timeout=e),modelModifiers:{number:!0}},null,8,["modelValue"]),a[29]||(a[29]=m("span",{class:"right-tips"},"\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4",-1))])),_:1}),p(y,{label:"gzip",prop:"gzip"},{default:c((()=>[p(w,{modelValue:g(M).gzip,"onUpdate:modelValue":a[10]||(a[10]=e=>g(M).gzip=e)},{default:c((()=>[p(I,{label:"\u5f00\u542f",value:"on"}),p(I,{label:"\u5173\u95ed",value:"off"})])),_:1},8,["modelValue"]),a[30]||(a[30]=m("span",{class:"right-tips"},"\u662f\u5426\u5f00\u542f\u538b\u7f29\u4f20\u8f93",-1))])),_:1}),p(y,{label:"gzip_min_length",prop:"gzip_min_length"},{default:c((()=>[p(i,{clearable:"",modelValue:g(M).gzip_min_length,"onUpdate:modelValue":a[11]||(a[11]=e=>g(M).gzip_min_length=e),modelModifiers:{number:!0}},{append:c((()=>a[31]||(a[31]=[b("KB")]))),_:1},8,["modelValue"]),a[32]||(a[32]=m("span",{class:"right-tips"},"\u6700\u5c0f\u538b\u7f29\u6587\u4ef6(\u54cd\u5e94\u4f53\u7684\u5927\u5c0f\u8d85\u8fc7\u6b64\u503c\u65f6\u624d\u4f1a\u538b\u7f29)",-1))])),_:1}),p(y,{label:"gzip_comp_level",prop:"gzip_comp_level"},{default:c((()=>[p(i,{clearable:"",modelValue:g(M).gzip_comp_level,"onUpdate:modelValue":a[12]||(a[12]=e=>g(M).gzip_comp_level=e),modelModifiers:{number:!0}},null,8,["modelValue"]),a[33]||(a[33]=m("span",{class:"right-tips"},"\u538b\u7f29\u7387(\u8303\u56f41-9\uff0c\u503c\u8d8a\u5927\u538b\u7f29\u901f\u5ea6\u8d8a\u6162)",-1))])),_:1})])),_:1})])),_:1}),p(y,null,{default:c((()=>[p(n,{type:"primary",onClick:B},{default:c((()=>a[34]||(a[34]=[b(" \u4fdd\u5b58\u5e76\u91cd\u8f7d ")]))),_:1})])),_:1})])),_:1},8,["model","rules"])):v("",!0)])),_:1}),p(s,{label:"\u8d1f\u8f7d\u72b6\u6001",name:"loadstatus"},{default:c((()=>[p(K,{border:!0,class:"rydescriptions",szie:"large",column:2,direction:"vertical",title:"\u8fd0\u884c\u8d1f\u8f7d"},{default:c((()=>[p(E,{label:"\u6d3b\u52a8\u8fde\u63a5(Active Connections)"},{default:c((()=>[b(_(g(L).loadstatus.ActiveConnections||0),1)])),_:1}),p(E,{label:"\u603b\u8fde\u63a5\u6b21\u6570(Accepted Connections)"},{default:c((()=>[b(_(g(L).loadstatus.AcceptedConnections||0),1)])),_:1}),p(E,{label:"\u603b\u63e1\u624b\u6b21\u6570(Handled Connections)"},{default:c((()=>[b(_(g(L).loadstatus.HandledConnections||0),1)])),_:1}),p(E,{label:"\u603b\u8bf7\u6c42\u6570(Total Requests)"},{default:c((()=>[b(_(g(L).loadstatus.TotalRequests||0),1)])),_:1}),p(E,{label:"\u8bf7\u6c42\u6570(Reading)"},{default:c((()=>[b(_(g(L).loadstatus.Reading||0),1)])),_:1}),p(E,{label:"\u54cd\u5e94\u6570(Writing)"},{default:c((()=>[b(_(g(L).loadstatus.Writing||0),1)])),_:1}),p(E,{label:"\u9a7b\u7559\u8fdb\u7a0b(Waiting)"},{default:c((()=>[b(_(g(L).loadstatus.Waiting||0),1)])),_:1}),p(E,{label:"\u5de5\u4f5c\u8fdb\u7a0b(Worker)"},{default:c((()=>[b(_(g(L).loadstatus.Worker||0),1)])),_:1}),p(E,{label:"Nginx\u4f7f\u7528CPU(Worker Cpu)"},{default:c((()=>[b(_(g(L).loadstatus.WorkerCpu||0),1)])),_:1}),p(E,{label:"Nginx\u4f7f\u7528\u5185\u5b58(Worker Mem)"},{default:c((()=>[b(_(g(L).loadstatus.WorkerMem||"0 MB"),1)])),_:1})])),_:1})])),_:1}),p(s,{label:"\u914d\u7f6e\u4fee\u6539",name:"edit_conf"},{default:c((()=>[p(o,{modelValue:g(L).conf,"onUpdate:modelValue":a[13]||(a[13]=e=>g(L).conf=e),fontSize:"13px",placeholder:g(L).conf?"":"\u672a\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6",showLineNums:!0,lineWrapping:!0,mode:"javascript",height:"60vh","read-only":!1,ref:"lyCodemirrorConf"},null,8,["modelValue","placeholder"]),p(n,{type:"primary",style:{"margin-top":"10px","margin-bottom":"10px"},onClick:N},{default:c((()=>a[35]||(a[35]=[b("\u4fdd\u5b58\u5e76\u91cd\u8f7d")]))),_:1}),a[36]||(a[36]=m("div",{class:"ry-cj-care"},[m("li",null,"\u82e5\u60a8\u4e0d\u4e86\u89e3Nginx\u7684\u914d\u7f6e\u6587\u4ef6\u89c4\u5219\uff0c\u8bf7\u52ff\u968f\u610f\u4fee\u6539!!!"),m("li",null,"\u5feb\u6377\u952e CTRL+F \u67e5\u627e\u548c\u66ff\u6362\u5185\u5bb9")],-1))])),_:1}),p(s,{label:"\u9519\u8bef\u65e5\u5fd7",name:"error_log"},{default:c((()=>[p(o,{modelValue:g(L).error_log,"onUpdate:modelValue":a[14]||(a[14]=e=>g(L).error_log=e),fontSize:"13px",placeholder:g(L).error_log?"":"\u5f53\u524d\u6ca1\u6709\u9519\u8bef\u65e5\u5fd7\uff01",showLineNums:!1,lineWrapping:!1,mode:"log",height:"68vh","read-only":!0,ref_key:"lyCodemirrorErrorLog",ref:q},null,8,["modelValue","placeholder"])])),_:1}),p(s,{label:"\u8bbf\u95ee\u65e5\u5fd7",name:"access_log"},{default:c((()=>[p(o,{modelValue:g(L).access_log,"onUpdate:modelValue":a[15]||(a[15]=e=>g(L).access_log=e),fontSize:"13px",placeholder:g(L).access_log?"":"\u5f53\u524d\u6ca1\u6709\u8bbf\u95ee\u65e5\u5fd7\uff01",showLineNums:!1,lineWrapping:!1,mode:"log",height:"68vh","read-only":!0,ref_key:"lyCodemirrorAccessLog",ref:A},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-d52337a4"]]);export{V as default};
