var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t;import{r as i,ag as r,aq as d,c as n,o as s,P as u,H as m,a as p,I as c,u as f,G as v,J as g,O as h,a6 as _,a4 as y,L as b,M as j,t as w,k,h as x,n as V}from"./@vue.CQt2tj-6.js";import{P as C}from"./Pagination.8Er6hDxx.js";import{_ as D,q as O,A as q,j as I,d as z,u as U,e as P,p as L}from"./index.FQhv3U_5.js";import{b as A}from"./vue-router.BmPBvlxi.js";import{L as E}from"./dialog.Bsrh65Nu.js";import{l as K}from"./wslogs.C4YhkFAq.js";import{a as M,E as S}from"./element-plus.C3E-FvSa.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";import"./index.CLtx-Eae.js";import"./vue-codemirror.CkyLiK-7.js";import"./codemirror.Fbop2eii.js";import"./@codemirror.CIOe3mu6.js";import"./@lezer.CQ-BhAmV.js";import"./crelt.DSg10-ms.js";import"./@marijn.Df4efayV.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const B={style:{display:"flex","align-items":"center",width:"100%"}},F={style:{"padding-left":"10px"}},G={style:{display:"flex","align-items":"center",width:"100%"}},R={style:{"padding-left":"10px"}},Z={style:{display:"flex","align-items":"center",width:"100%"}},$={style:{"padding-left":"10px"}},T=D({__name:"modulePull",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),k=i(!1),x=i("\u6dfb\u52a0\u7f51\u7ad9"),V=i({method:"command",repo_id:"",repo_url:"",is_auth:!1,image_name:"",cmd:""}),C=i(""),D=i([]),z=i(null),U=i(!1),P=i([{required:!0,message:"\u8bf7\u9009\u62e9\u4ed3\u5e93\u540d",trigger:"blur"}]);function L(e){e.preventDefault()}let A=i([{required:!1,validator:function(e,l,a){if(l)/^docker\s+pull\s+([a-zA-Z0-9-_\.]+(?:\/[a-zA-Z0-9-_\.]+)*(?::[a-zA-Z0-9-_\.]+)?)$/.test(l)?a():a(new Error("\u65e0\u6548\u7684 Docker \u62c9\u53d6\u547d\u4ee4\u683c\u5f0f\uff0c\u6b63\u786e\u683c\u5f0f: docker pull mysql:latest"));else{e.required||a(),a(new Error("\u8bf7\u8f93\u5165 Docker \u62c9\u53d6\u547d\u4ee4"))}},trigger:"blur"}]),M=i({image_name:[{required:!0,validator:O,trigger:"blur"}]});function S(){t("closed"),U.value&&t("refreshData")}function T(e){if(null!=e){let l=D.value.find((l=>l.id===e));V.value.repo_url=l.url,V.value.is_auth=l.is_auth}else V.value.repo_url="",V.value.is_auth=!1}let W=i(null);function H(){W.value.validate((e=>{if(e){k.value=!0;let e="docker_pull";"cmd"==V.value.method&&(e="runcmd"),z.value.isWebSocketOpen()?(C.value="",z.value.sendMsg(V.value,e)):z.value.init("api/wstask/",V.value,e,"")}}))}function J(){k.value=!1}function N(){k.value=!1,U.value=!0}return l({handleOpen:function(e,l){x.value=l,o.value=!0,q.GetDockerReposList({is_simple:!0}).then((e=>{2e3==e.code?(D.value=e.data.data,D.value.length>0&&(V.value.repo_id=D.value[0].id,V.value.repo_url=D.value[0].url,V.value.is_auth=D.value[0].is_auth)):I(e.msg)}))}}),(e,l)=>{const a=r("el-radio-button"),t=r("el-radio-group"),i=r("el-form-item"),O=r("el-option"),q=r("el-select"),I=r("el-input"),U=r("el-button"),Q=r("el-form"),X=d("loading");return s(),n("div",null,[u(E,{modelValue:f(o),"onUpdate:modelValue":l[6]||(l[6]=e=>w(o)?o.value=e:o=e),title:f(x),width:"780px","before-close":S,class:"pulldialog"},{default:m((()=>[u(Q,{inline:!1,model:f(V),rules:f(M),ref_key:"rulesForm",ref:W,"label-position":"right","label-width":"auto",disabled:f(k)},{default:m((()=>[u(i,{label:"\u62c9\u53d6\u65b9\u5f0f\uff1a",prop:"method"},{default:m((()=>[u(t,{modelValue:f(V).method,"onUpdate:modelValue":l[0]||(l[0]=e=>f(V).method=e)},{default:m((()=>[u(a,{label:"\u9ed8\u8ba4",value:"command"}),u(a,{label:"\u6307\u5b9a\u4ed3\u5e93",value:"repo"}),u(a,{label:"\u547d\u4ee4\u884c",value:"cmd"})])),_:1},8,["modelValue"])])),_:1}),"repo"==f(V).method?(s(),v(i,{key:0,label:"\u4ed3\u5e93\u540d\uff1a",prop:"repo_id",rules:"repo"==f(V).method?f(P):[]},{default:m((()=>[u(q,{modelValue:f(V).repo_id,"onUpdate:modelValue":l[1]||(l[1]=e=>f(V).repo_id=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},filterable:"",onChange:T},{default:m((()=>[(s(!0),n(h,null,_(f(D),(e=>(s(),v(O,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["rules"])):g("",!0),"repo"==f(V).method?(s(),v(i,{key:1,label:"\u955c\u50cf\u540d\uff1a",prop:"image_name"},{default:m((()=>[p("div",B,[u(I,{modelValue:f(V).image_name,"onUpdate:modelValue":l[2]||(l[2]=e=>f(V).image_name=e),placeholder:"\u5982\uff1amysql:latest",onKeydown:y(L,["enter"])},{prepend:m((()=>[b(j(f(V).repo_url),1)])),_:1},8,["modelValue"]),p("div",F,[u(U,{type:"primary",onClick:H},{default:m((()=>l[7]||(l[7]=[b("\u62c9\u53d6")]))),_:1})])])])),_:1})):g("",!0),"command"==f(V).method?(s(),v(i,{key:2,label:"\u955c\u50cf\u540d\uff1a",prop:"image_name"},{default:m((()=>[p("div",G,[u(I,{modelValue:f(V).image_name,"onUpdate:modelValue":l[3]||(l[3]=e=>f(V).image_name=e),placeholder:"\u5982\uff1amysql:latest",onKeydown:y(L,["enter"])},null,8,["modelValue"]),p("div",R,[u(U,{type:"primary",onClick:H},{default:m((()=>l[8]||(l[8]=[b("\u62c9\u53d6")]))),_:1})])])])),_:1})):g("",!0),"cmd"==f(V).method?(s(),v(i,{key:3,label:"\u62c9\u53d6\u547d\u4ee4\uff1a",prop:"cmd",rules:"cmd"==f(V).method?f(A):[]},{default:m((()=>[p("div",Z,[u(I,{modelValue:f(V).cmd,"onUpdate:modelValue":l[4]||(l[4]=e=>f(V).cmd=e),placeholder:"\u5982\uff1adocker pull mysql:latest",onKeydown:y(L,["enter"])},null,8,["modelValue"]),p("div",$,[u(U,{type:"primary",onClick:H},{default:m((()=>l[9]||(l[9]=[b("\u6267\u884c\u547d\u4ee4")]))),_:1})])])])),_:1},8,["rules"])):g("",!0)])),_:1},8,["model","rules","disabled"]),l[10]||(l[10]=p("div",{style:{"margin-bottom":"10px"}},"\u62c9\u53d6\u65e5\u5fd7\uff1a",-1)),c(u(K,{modelValue:f(C),"onUpdate:modelValue":l[5]||(l[5]=e=>w(C)?C.value=e:C=e),fontSize:"12px",placeholder:"\u6682\u65e0\u65e5\u5fd7",showLineNums:!1,lineWrapping:!0,mode:"log",height:"350px",ref_key:"lyCodemirror",ref:z,onOnerror:J,onOnsuccess:N},null,8,["modelValue"]),[[X,!1]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-1c3b7459"]]),W={class:"handle-top"},H={class:"search-sites-input"},J=D({__name:"index",setup(e,{expose:D}){A();const O=z(),I=U();let E=k((()=>I.ismobile)),K=i(!1),B=i([{id:"",name:"\u5168\u90e8"},{id:"1",name:"\u5df2\u4f7f\u7528"},{id:"0",name:"\u672a\u4f7f\u7528"}]),F=i({page:1,limit:10}),G=i({page:1,limit:10,total:0}),R=i([]);function Z(){N()}function $(e){F.value.page=e.page,F.value.limit=e.limit,J()}function J(){K.value=!0;let e=((e,i)=>{for(var r in i||(i={}))a.call(i,r)&&o(e,r,i[r]);if(l)for(var r of l(i))t.call(i,r)&&o(e,r,i[r]);return e})({},F.value);q.GetDockerImages(e).then((e=>{K.value=!1,2e3===e.code&&(R.value=e.data.data,G.value.page=e.data.page,G.value.limit=e.data.limit,G.value.total=e.data.total)}))}function N(){F.value.page=1,J()}let Q=i(!1),X=i(null);function Y(){Q.value=!0,V((()=>{X.value.handleOpen(null,"\u62c9\u53d6\u955c\u50cf")}))}return D({RefreshData:function(){V((()=>{J()}))}}),x((()=>{J()})),(e,l)=>{const a=r("el-button"),t=r("el-col"),o=r("el-option"),i=r("el-select"),k=r("el-input"),x=r("el-row"),V=r("el-table-column"),D=r("el-tag"),I=r("el-table"),z=d("loading");return s(),n("div",null,[p("div",W,[u(x,null,{default:m((()=>[u(t,{xs:24,sm:16,md:16,lg:16,xl:16},{default:m((()=>[u(a,{type:"primary",onClick:Y,icon:"Download"},{default:m((()=>l[6]||(l[6]=[b("\u62c9\u53d6\u955c\u50cf")]))),_:1}),u(a,{icon:"refresh",circle:"",onClick:N,style:{"margin-left":"10px"}})])),_:1}),u(t,{xs:24,sm:8,md:8,lg:8,xl:8},{default:m((()=>[p("div",H,[u(i,{modelValue:f(F).used,"onUpdate:modelValue":l[0]||(l[0]=e=>f(F).used=e),style:{width:"280px","margin-right":"10px"},filterable:"",clearable:"",onChange:Z},{prefix:m((()=>l[7]||(l[7]=[b("\u72b6\u6001")]))),default:m((()=>[(s(!0),n(h,null,_(f(B),(e=>(s(),v(o,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u(k,{modelValue:f(F).search,"onUpdate:modelValue":l[1]||(l[1]=e=>f(F).search=e),clearable:"",onClear:l[2]||(l[2]=e=>N()),"suffix-icon":"Search",onKeyup:l[3]||(l[3]=y((e=>N()),["enter"])),onChange:l[4]||(l[4]=e=>N()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),c((s(),v(I,{data:f(R),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:m((()=>[u(V,{prop:"name",label:"ID",width:"160"},{default:m((e=>[b(j(e.row.id),1)])),_:1}),u(V,{prop:"status",label:"\u72b6\u6001",width:"130"},{default:m((({row:e})=>["1"==e.used?(s(),v(D,{key:0,type:"success"},{default:m((()=>l[8]||(l[8]=[b(" \u5df2\u4f7f\u7528 ")]))),_:1})):(s(),v(D,{key:1,type:"info"},{default:m((()=>l[9]||(l[9]=[b(" \u672a\u4f7f\u7528 ")]))),_:1}))])),_:1}),u(V,{prop:"tags",label:"\u6807\u7b7e","min-width":"130"},{default:m((({row:e})=>[(s(!0),n(h,null,_(e.tags,(e=>(s(),n("div",null,[u(D,{type:"info"},{default:m((()=>[b(j(e),1)])),_:2},1024)])))),256))])),_:1}),u(V,{prop:"size",label:"\u5927\u5c0f","min-width":"100"},{default:m((e=>[p("span",null,j(f(P)(e.row.size)),1)])),_:1}),u(V,{prop:"created",label:"\u521b\u5efa\u65f6\u95f4","min-width":"170"},{default:m((e=>[p("span",null,j(f(L)(e.row.created)),1)])),_:1}),u(V,{fixed:!f(E)&&"right",label:"\u64cd\u4f5c",width:"130"},{default:m((e=>[u(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void M.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.id}\u3011\u955c\u50cf\u5417\uff1f`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{O.loadingInfo.isLoading=!0,O.loadingInfo.content="\u5220\u9664\u4e2d...",q.DockerImageMg({name:a.id,action:"delete"}).then((e=>{O.loadingInfo.isLoading=!1,O.loadingInfo.content="",2e3==e.code?(S.success(e.msg),J()):S.warning(e.msg)}))})).catch((()=>{}));var a}},{default:m((()=>l[10]||(l[10]=[b("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[z,f(K)]]),u(C,{small:!0,"child-msg":f(G),onCallFather:$,border:!1,position:"right"},null,8,["child-msg"]),f(Q)?(s(),v(T,{key:0,ref_key:"modulePullFlag",ref:X,onRefreshData:J,onClosed:l[5]||(l[5]=e=>w(Q)?Q.value=!1:Q=!1)},null,512)):g("",!0)])}}},[["__scopeId","data-v-228357ce"]]);export{J as default};
