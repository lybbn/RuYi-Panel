import{b as e,x as a}from"./@xterm.C7qPmoRH.js";import{_ as t,r as l,s as n}from"./index.FQhv3U_5.js";import{r as o,i as u,W as i,c as s,o as r,n as v}from"./@vue.CQt2tj-6.js";const c=t({__name:"index",props:{apiSuffix:{type:String,default:""},apiArgs:{type:String},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:1.2},scrollback:{type:Number,default:1e3},theme:{type:Object,default:()=>({foreground:"#F8F8F8",background:"black",cursor:"#F8F8F8"})}},emits:["closed"],setup(t,{expose:c,emit:f}){const d=f;let p=o(null),m=new e.FitAddon,w=o(!1),y=o(!1),S=o(null),g=o(null),b=o(""),h=o(null),k=o(0);const $=t;function z(e=!0){return S.value=new a.Terminal({fontFamily:"Monaco, Menlo, Consolas, monospace",rendererType:"canvas",lineHeight:$.lineHeight,fontSize:$.fontSize,scrollback:$.scrollback,convertEol:!0,cursorBlink:!0,disableStdin:!1,cursorStyle:"block",scrollSensitivity:1,rightClickSelectsWord:!0,tabStopWidth:4,theme:$.theme}),e&&S.value.onData((e=>W(e))),p.value&&!S.value.element&&(S.value.open(p.value),S.value.loadAddon(m),m.fit(),window.addEventListener("resize",_),w.value=!0),w.value}function x(){y.value=!0,b.value&&W(b.value),T()&&g.value.send(JSON.stringify({type:"heartBeat",timestamp:`${(new Date).getTime()}`}))}function O(e){const a=JSON.parse(e.data);switch(a.type){case"cmd":{S.value.element&&S.value.focus();let e=a.data;b.value&&(e=e.replace(b.value.trim(),"").trim(),b.value=""),a.data&&S.value.write(e);break}case"heartBeat":{let e=(new Date).getTime();k.value=Math.abs(e-a.data.timestamp);break}}}function F(e){h.value&&clearInterval(h.value);let a=e.reason;S.value.write(a),S.value.write("\r\n\u8fde\u63a5\u5df2\u5173\u95ed\r\n"),d("closed")}function N(e){let a=e.message;a||(a="\u8fde\u63a5\u4e2d\u65ad"),S.value.write(`\x1b[31m${a}\x1b[m\r\n`)}function T(){return 1===(!!g.value&&g.value.readyState)}function W(e){T()&&g.value.send(JSON.stringify({type:"cmd",data:e}))}function _(){m.fit(),T()&&S.value.onResize((e=>{g.value.send(JSON.stringify({type:"resize",cols:e.cols,rows:e.rows}))}))}function D(e){e.ctrlKey&&(e.preventDefault(),e.deltaY>0?S.value.options.fontSize>12&&(S.value.options.fontSize=S.value.options.fontSize-1):S.value.options.fontSize=S.value.options.fontSize+1,_())}function I(e=!0){h.value&&clearInterval(h.value),window.removeEventListener("resize",_);try{g.value&&g.value.close()}catch(a){}if(e)try{S.value&&S.value.dispose(),S.value=null}catch(a){}p.value&&(p.value.innerHTML="")}const A=u((()=>y.value&&w.value),(e=>{e&&(_(),A())}));return c({init:function(e="",a="",t="",o=""){v((()=>{g.value&&(h.value&&clearInterval(h.value),h.value=null,g.value&&g.value.close(),g.value=null);let u=e||$.apiSuffix,i=a||$.apiArgs;var s;0!==o.length?(s=o,z(!1)&&(S.value.write(s),S.value.on("copy",(e=>{navigator.clipboard.writeText(e)})))):(b.value=t||"",z(!0)&&function(e,a){const t=btoa(l());if(-1!=e.indexOf("://"))g.value=new WebSocket(`${e}?cols=${S.value.cols}&rows=${S.value.rows}&token=${t}&${a}`);else{const l="http:"===window.location.href.split("//")[0]?"ws":"wss",o=n.API_HOST,u=e.replace(/^\/+/,"");g.value=new WebSocket(`${l}://${o}/${u}?cols=${S.value.cols}&rows=${S.value.rows}&token=${t}&${a}`)}g.value.onopen=x,g.value.onmessage=O,g.value.onclose=F,g.value.onerror=N,h.value=setInterval((()=>{if(T()){let e=(new Date).getTime();g.value.send(JSON.stringify({type:"heartBeat",timestamp:`${e}`}))}}),2e4)}(u,i))}))},isWebSocketOpen:T,sendMsg:W,onClose:I,getDelay:function(){return k.value},handleXtermResize:_}),i((()=>{I()})),(e,a)=>(r(),s("div",{ref_key:"lyterminal",ref:p,class:"lyterminal",onWheel:D},null,544))}},[["__scopeId","data-v-2f194c5f"]]);export{c as l};
