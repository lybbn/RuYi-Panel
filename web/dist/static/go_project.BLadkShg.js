var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(o,t,a)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[t]=a;import{_ as n,d as i,A as s,i as r}from"./index.9wSm1W-X.js";import{l as d}from"./index.C0GpYgjh.js";import{E as c,a as u}from"./element-plus.C3E-FvSa.js";import{k as p,r as f,h as m,ag as g,G as _,o as j,H as v,P as b,J as h,u as y,a as w,L as I,M as V,D as x,t as L,n as k}from"./@vue.CQt2tj-6.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./vue-router.BmPBvlxi.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";import"./vue-codemirror.k2zwy4VA.js";import"./codemirror.DMTwtLMy.js";import"./@codemirror.BTYdMWAS.js";import"./@lezer.CQ-BhAmV.js";import"./crelt.DSg10-ms.js";import"./@marijn.Df4efayV.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const C={style:{display:"flex","align-items":"center",width:"100%"}},S={style:{display:"flex","align-items":"center",width:"100%"}},O={style:{width:"150px","padding-left":"20px"}},U={class:"statusc"},G={class:"lyflex status"},M={class:"lyflex opbtn"},T=n({__name:"go_project",props:{data:{type:Object}},emits:["refreshStatus"],setup(e,{emit:n}){const T=i(),B=n,P=e;let E=p((()=>"windows"==T.sysConfig.currentOs));p((()=>siteThemeStore.ismobile));let N=f({id:null,name:"",project_log:"",error_log:"",status:!1,loadstatus:{pids:[]},conf:"",oldConf:"",info:{project_cfg:{port:"",allowport:!1}},old_project_cfg:{}}),q=f(!1),z=f(!1);let D=f({name:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0",trigger:"blur"}],path:[{required:!0,message:"\u8bf7\u9009\u62e9\u9879\u76ee\u6839\u76ee\u5f55",trigger:"blur"}],"project_cfg.version":[{required:!0,message:"\u8bf7\u9009\u62e9Python\u7248\u672c",trigger:"blur"}]}),A=f([{required:!0,validator:function(e,o,t){const a=parseInt(o,10);isNaN(a)&&t(new Error("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7aef\u53e3\u53f7")),a<1||a>65534?t(new Error("\u7aef\u53e3\u53f7\u5fc5\u987b\u57280\u523065535\u4e4b\u95f4")):t()},trigger:"blur"}]),J=f("info");function F(e="stop"){let o="\u786e\u5b9a\u542f\u52a8\u5417\uff1f",t="\u542f\u52a8\u4e2d...",a=!0;"stop"==e?(o="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",t="\u505c\u6b62\u4e2d...",a=!1):"restart"==e&&(o="\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f",t="\u91cd\u542f\u4e2d...",a=!0),u.confirm(`${o}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((o=>{T.loadingInfo.isLoading=!0,T.loadingInfo.content=t,s.sysGoSiteMg({id:N.value.id,op:e,action:"set_status"}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3==e.code?(c.success(e.msg),N.value.status=a,B("refreshStatus",{id:N.value.id,status:a})):c.warning(e.msg)}))})).catch((()=>{}))}function R(){let e={id:N.value.id};T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u83b7\u53d6\u4e2d...",s.sysGetGoSiteList(e).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3===e.code?(N.value.info=e.data.data[0],N.value.old_project_cfg=r(e.data.data[0].project_cfg),"uwsgi"==N.value.info.project_cfg.start_method||"gunicorn"==N.value.info.project_cfg.start_method?q.value=!0:q.value=!1,"gunicorn"==N.value.info.project_cfg.start_method?z.value=!0:z.value=!1):c.warning(e.msg)}))}let W=f(null);function $(e){"error_log"==e.props.name?getErrorLog():"project_log"==e.props.name?(T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",s.sysGoSiteMg({id:N.value.id,action:"get_project_log",log_type:"access"}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3==e.code?(N.value.project_log=e.data,k((()=>{W.value&&W.value.scrollToBottom()}))):c.warning(e.msg)}))):"info"==e.props.name?R():"loadstatus"===e.props.name?(T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u8d1f\u8f7d\u72b6\u6001...",s.sysGoSiteMg({id:N.value.id,action:"get_loadstatus"}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",N.value.loadstatus={},2e3==e.code?N.value.loadstatus=e.data:c.warning(e.msg)}))):"edit_conf"===e.props.name?(T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6...",s.sysGoSiteMg({id:N.value.id,action:"get_conf"}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3==e.code?(N.value.conf=e.data,N.value.oldConf=e.data):c.warning(e.msg)}))):"status"==e.props.name&&(T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u83b7\u53d6\u4e2d...",s.sysGetGoSiteList({id:N.value.id,is_simple:!0}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3==e.code?N.status=e.data.data[0].status:c.warning(e.msg)})))}function H(){if(N.value.oldConf==N.value.conf)return void c.warning("\u914d\u7f6e\u6587\u4ef6\u672a\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58!!!");if(""==N.value.conf||null==N.value.conf)return void c.warning("\u914d\u7f6e\u6587\u4ef6\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u914d\u7f6e");u.confirm("\u786e\u5b9a\u8981\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u6b63\u5728\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6...",s.sysGoSiteMg({id:N.value.id,conf:N.value.conf,action:"save_conf"}).then((e=>{T.loadingInfo.isLoading=!1,T.loadingInfo.content="",2e3==e.code?c.success("\u4fdd\u5b58\u6210\u529f"):c.warning(e.msg)}))})).catch((()=>{}))}let K=f(null);function Q(){K.value.validate((e=>{if(e){if(JSON.stringify(N.value.old_project_cfg)==JSON.stringify(N.value.info.project_cfg))return void c.warning("\u914d\u7f6e\u672a\u4fee\u6539\uff0c\u65e0\u9700\u4fdd\u5b58\uff01\uff01\uff01");let e=((e,n)=>{for(var i in n||(n={}))t.call(n,i)&&l(e,i,n[i]);if(o)for(var i of o(n))a.call(n,i)&&l(e,i,n[i]);return e})({},N.value.info);e.action="edit_site";let n="\u786e\u8ba4\u4fdd\u5b58\u5417\uff1f";u.confirm(`${n}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((o=>{T.loadingInfo.isLoading=!0,T.loadingInfo.content="\u4fdd\u5b58\u4e2d...",s.sysGoSiteMg(e).then((e=>{T.loadingInfo.isLoading=!0,T.loadingInfo.content="",2e3==e.code?(c.success(e.msg),R()):c.warning(e.msg)}))})).catch((()=>{}))}}))}return m((()=>{N.value.id=P.data.id,N.value.name=P.data.name,N.value.status=P.data.status,"info"==J.value&&R()})),(e,o)=>{const t=g("el-input"),a=g("el-form-item"),l=g("el-checkbox"),n=g("el-tooltip"),i=g("el-option"),s=g("el-select"),r=g("el-switch"),c=g("el-button"),u=g("el-form"),p=g("el-tab-pane"),f=g("CaretRight"),m=g("el-icon"),k=g("el-descriptions-item"),T=g("el-descriptions"),B=g("el-tabs");return j(),_(B,{"tab-position":"left",modelValue:y(J),"onUpdate:modelValue":o[13]||(o[13]=e=>L(J)?J.value=e:J=e),onTabClick:$},{default:v((()=>[b(p,{label:"\u9879\u76ee\u4fe1\u606f",name:"info"},{default:v((()=>[b(u,{inline:!1,model:y(N).info,rules:y(D),ref_key:"rulesForm",ref:K,"label-position":"right","label-width":"auto"},{default:v((()=>[b(a,{label:"\u6267\u884c\u6587\u4ef6\uff1a",prop:"project_cfg.bin"},{default:v((()=>[b(t,{modelValue:y(N).info.project_cfg.bin,"onUpdate:modelValue":o[0]||(o[0]=e=>y(N).info.project_cfg.bin=e),placeholder:"\u8bf7\u9009\u62e9Go\u9879\u76ee\u7f16\u8bd1\u540e\u7684\u6267\u884c\u6587\u4ef6",class:"selectDirs",disabled:!0},null,8,["modelValue"])])),_:1}),b(a,{label:"\u9879\u76ee\u540d\u79f0\uff1a",prop:"name"},{default:v((()=>[w("div",C,[b(t,{modelValue:y(N).info.name,"onUpdate:modelValue":o[1]||(o[1]=e=>y(N).info.name=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0",maxlength:"50",disabled:!0},null,8,["modelValue"])])])),_:1}),b(a,{label:"\u9879\u76ee\u76ee\u5f55\uff1a",prop:"path"},{default:v((()=>[b(t,{modelValue:y(N).info.path,"onUpdate:modelValue":o[2]||(o[2]=e=>y(N).info.path=e),placeholder:"\u8bf7\u9009\u62e9\u9879\u76ee\u6839\u76ee\u5f55",class:"selectDirs",disabled:!0},null,8,["modelValue"])])),_:1}),b(a,{label:"\u542f\u52a8\u547d\u4ee4\uff1a",prop:"project_cfg.start_command"},{default:v((()=>[b(t,{modelValue:y(N).info.project_cfg.start_command,"onUpdate:modelValue":o[3]||(o[3]=e=>y(N).info.project_cfg.start_command=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u542f\u52a8\u547d\u4ee4",maxlength:"300"},null,8,["modelValue"])])),_:1}),b(a,{label:"\u9879\u76ee\u7aef\u53e3\uff1a",prop:"project_cfg.port",rules:y(A)},{default:v((()=>[w("div",S,[b(t,{ref:"PathInputElement",modelValue:y(N).info.project_cfg.port,"onUpdate:modelValue":o[4]||(o[4]=e=>y(N).info.project_cfg.port=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u7aef\u53e3",type:"number",min:"1",max:"65534"},null,8,["modelValue"]),w("div",O,[b(n,{content:"\u9009\u62e9\u653e\u884c\u7aef\u53e3\uff0c\u8868\u793a\u9632\u706b\u5899\u81ea\u52a8\u653e\u901a\u3010\u9879\u76ee\u7aef\u53e3\u3011"},{default:v((()=>[b(l,{modelValue:y(N).info.project_cfg.allowport,"onUpdate:modelValue":o[5]||(o[5]=e=>y(N).info.project_cfg.allowport=e),label:"\u653e\u901a\u7aef\u53e3"},null,8,["modelValue"])])),_:1})])])])),_:1},8,["rules"]),y(E)?h("",!0):(j(),_(a,{key:0,label:"\u542f\u52a8\u7528\u6237\uff1a",prop:"project_cfg.start_user"},{default:v((()=>[b(s,{modelValue:y(N).info.project_cfg.start_user,"onUpdate:modelValue":o[6]||(o[6]=e=>y(N).info.project_cfg.start_user=e),placeholder:"\u8bf7\u9009\u62e9\u542f\u52a8\u7528\u6237",style:{width:"100%"},clearable:"",filterable:""},{default:v((()=>[b(i,{key:"root",label:"root",value:"root"}),b(i,{key:"www",label:"www",value:"www"})])),_:1},8,["modelValue"])])),_:1})),b(a,{label:"\u5f00\u673a\u542f\u52a8\uff1a"},{default:v((()=>[b(r,{modelValue:y(N).info.project_cfg.autostart,"onUpdate:modelValue":o[7]||(o[7]=e=>y(N).info.project_cfg.autostart=e),"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"\u5f00\u542f","inactive-text":"\u5173\u95ed"},null,8,["modelValue"])])),_:1}),b(a,{label:" "},{default:v((()=>[b(c,{type:"primary",onClick:Q},{default:v((()=>o[14]||(o[14]=[I("\u4fdd\u5b58\u5e76\u91cd\u542f")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),b(p,{label:"\u670d\u52a1\u72b6\u6001",name:"status"},{default:v((()=>[w("div",U,[w("div",G,[w("div",null,"\u5f53\u524d\u72b6\u6001\uff1a"+V(y(N).status?"\u5df2\u542f\u52a8":"\u5df2\u505c\u6b62"),1),b(m,{class:x(y(N).status?"on":"off")},{default:v((()=>[b(f)])),_:1},8,["class"])]),w("div",M,[b(c,{onClick:o[8]||(o[8]=e=>F("start")),disabled:y(N).status},{default:v((()=>o[15]||(o[15]=[I("\u542f\u52a8")]))),_:1},8,["disabled"]),b(c,{onClick:o[9]||(o[9]=e=>F("stop")),disabled:!y(N).status},{default:v((()=>o[16]||(o[16]=[I("\u505c\u6b62")]))),_:1},8,["disabled"]),b(c,{onClick:o[10]||(o[10]=e=>F("restart"))},{default:v((()=>o[17]||(o[17]=[I("\u91cd\u542f")]))),_:1})])])])),_:1}),y(q)?(j(),_(p,{key:0,label:"\u914d\u7f6e\u4fee\u6539",name:"edit_conf"},{default:v((()=>[b(d,{modelValue:y(N).conf,"onUpdate:modelValue":o[11]||(o[11]=e=>y(N).conf=e),fontSize:"13px",placeholder:y(N).conf?"":"\u672a\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6",showLineNums:!0,lineWrapping:!0,mode:"javascript",height:"60vh","read-only":!1,ref:"lyCodemirrorConf"},null,8,["modelValue","placeholder"]),b(c,{type:"primary",style:{"margin-top":"10px","margin-bottom":"10px"},onClick:H},{default:v((()=>o[18]||(o[18]=[I("\u4fdd\u5b58\u5e76\u91cd\u542f")]))),_:1}),o[19]||(o[19]=w("div",{class:"ry-cj-care"},[w("li",null,"\u82e5\u60a8\u4e0d\u4e86\u89e3\u914d\u7f6e\u6587\u4ef6\u89c4\u5219\uff0c\u8bf7\u52ff\u968f\u610f\u4fee\u6539!!!"),w("li",null,"\u5feb\u6377\u952e CTRL+F \u67e5\u627e\u548c\u66ff\u6362\u5185\u5bb9")],-1))])),_:1})):h("",!0),b(p,{label:"\u8d1f\u8f7d\u72b6\u6001",name:"loadstatus"},{default:v((()=>[b(T,{border:!0,column:2,direction:"vertical",title:"\u8fd0\u884c\u8d1f\u8f7d"},{default:v((()=>[b(k,{label:"CPU\u4f7f\u7528\u7387(%)"},{default:v((()=>[I(V(y(N).loadstatus.cpu_p||"-"),1)])),_:1}),b(k,{label:"\u5185\u5b58\u4f7f\u7528\u7387(%)"},{default:v((()=>[I(V(y(N).loadstatus.mem_p||"-"),1)])),_:1}),b(k,{label:"\u4f7f\u7528\u5185\u5b58(USS)"},{default:v((()=>[I(V(y(N).loadstatus.mem_used||"-"),1)])),_:1}),b(k,{label:"\u542f\u52a8\u7528\u6237"},{default:v((()=>[I(V(y(N).loadstatus.user||"-"),1)])),_:1}),b(k,{label:"\u7ebf\u7a0b\u6570"},{default:v((()=>[I(V(y(N).loadstatus.threads||"-"),1)])),_:1}),b(k,{label:"\u8fdb\u7a0bpid\u5217\u8868(pids)"},{default:v((()=>[I(V(y(N).loadstatus.pids.join("\u3001")||"-"),1)])),_:1}),b(k,{label:"\u7236\u8fdb\u7a0bpid/name"},{default:v((()=>[I(V(y(N).loadstatus.fpid?y(N).loadstatus.fpid+"/"+y(N).loadstatus.fpid_name:"-"),1)])),_:1}),b(k,{label:"\u521b\u5efa\u65f6\u95f4(create_time)"},{default:v((()=>[I(V(y(N).loadstatus.create_time||"-"),1)])),_:1}),b(k,{label:"\u547d\u4ee4\u884c(cmdline)"},{default:v((()=>[I(V(y(N).loadstatus.cmdline||"-"),1)])),_:1})])),_:1})])),_:1}),b(p,{label:"\u9879\u76ee\u65e5\u5fd7",name:"project_log"},{default:v((()=>[b(d,{modelValue:y(N).project_log,"onUpdate:modelValue":o[12]||(o[12]=e=>y(N).project_log=e),fontSize:"13px",placeholder:y(N).project_log?"":"\u5f53\u524d\u6ca1\u6709\u65e5\u5fd7\uff01",showLineNums:!0,lineWrapping:!0,mode:"log",height:"68vh","read-only":!0,ref_key:"lyCodemirrorAccessLog",ref:W},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-cac260d3"]]);export{T as default};
