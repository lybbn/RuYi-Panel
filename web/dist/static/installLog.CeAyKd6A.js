import{c as e,j as l,A as a}from"./index.D1mG68-9.js";import{L as o}from"./dialog.DfP35yxJ.js";import{l as t}from"./index.BNOrQDSs.js";import{_ as n}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as s}from"./element-plus.WT5mSVn7.js";import{b as i,j as u,A as r,n as d,aq as f,o as v,c as m,U as c,O as p,P as g,u as h,D as _}from"./@vue.BMBj57q3.js";const j={class:"lysoftLogDialog"},w=n({__name:"installLog",emits:["refreshData","closed"],setup(n,{expose:w,emit:y}){e();const L=y;let x=i(!1),R=i(!1),V=i("\u65e5\u5fd7\u8be6\u60c5"),C=i({id:""}),D={},b=i("\u52a0\u8f7d\u4e2d..."),I=i("55vh"),T=i("log"),U=i(null),z=i("new_lines");function E(){O(),L("refreshData"),L("closed")}function O(){clearInterval(U.value),U.value=null}u((()=>{window.addEventListener("resize",q),q()})),r((()=>{window.removeEventListener("resize",q),O()}));let S=i(null);function k(){R.value=!0;let e={id:C.value.id,action:z.value};a.sysSoftInstallLogs(e).then((e=>{R.value=!1,2e3==e.code?(b.value=e.data.data,d((()=>{S.value&&S.value.scrollToBottom()})),e.data.done&&"all"!=z.value&&setTimeout((()=>{E()}),2e3)):(s.warning(e.msg),setTimeout((()=>{E()}),2e3))}))}let A=i(null),H=i(!1);function q(){d((()=>{const e=A.value.getRef();if(e.dialogContentRef){const l=e.dialogContentRef.$refs.headerRef.offsetHeight||80,a=document.body.offsetHeight;e.dialogContentRef.fullscreen||H.value?I.value=a-l:I.value="55vh"}}))}function B(e){H.value=e,q()}return w({handleOpen:function(e,a){V.value=a,x.value=!0,e&&(D=l(e),C.value.id=D.id,D.action&&(z.value=D.action),"all"!=z.value?U.value=setInterval((()=>{k()}),2e3):k())}}),(e,l)=>{const a=f("loading");return v(),m("div",j,[c(o,{ref_key:"codeMirrorDialogRef",ref:A,modelValue:h(x),"onUpdate:modelValue":l[1]||(l[1]=e=>_(x)?x.value=e:x=e),title:h(V),width:"50%",onOnChangeFullScreen:B,"before-close":E},{default:p((()=>[g(c(t,{modelValue:h(b),"onUpdate:modelValue":l[0]||(l[0]=e=>_(b)?b.value=e:b=e),fontSize:"15px",placeholder:(h(b),""),showLineNums:!0,lineWrapping:!0,mode:h(T),height:h(I),"read-only":!0,ref_key:"lyCodemirror",ref:S},null,8,["modelValue","placeholder","mode","height"]),[[a,"all"==h(z)&&h(R)]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-456feb0c"]]);export{w as i};
