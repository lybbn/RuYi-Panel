import{r as e,h as l,ag as a,aq as o,c as t,o as s,a as i,I as n,P as r,H as d,u as m,O as u,a6 as p,G as c,L as g,a4 as h,k as f,S as y,t as v,D as b,J as _,n as j}from"./@vue.CQt2tj-6.js";import{P as k}from"./Pagination.Nl1ehftE.js";import{_ as w,d as x,A as V,u as L,N as C}from"./index.9wSm1W-X.js";import{a as I,E}from"./element-plus.C3E-FvSa.js";import{l as T}from"./index.C0GpYgjh.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./vue-router.BmPBvlxi.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";import"./vue-codemirror.k2zwy4VA.js";import"./codemirror.DMTwtLMy.js";import"./@codemirror.BTYdMWAS.js";import"./@lezer.CQ-BhAmV.js";import"./crelt.DSg10-ms.js";import"./@marijn.Df4efayV.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const z={class:"handle-top"},A={class:"search-sites-input"},U=w({__name:"operatelog",setup(f){const y=x();let v=e(!1),b=e({search:"",page:1,limit:10}),_=e({page:1,limit:10,total:0}),j=e([]),w=e([{id:"",name:"\u5168\u90e8"},{id:"dbmg",name:"\u6570\u636e\u5e93\u7ba1\u7406"},{id:"login",name:"\u7528\u6237\u767b\u5f55"},{id:"safe",name:"\u5b89\u5168"},{id:"softmg",name:"\u8f6f\u4ef6\u7ba1\u7406"},{id:"filemg",name:"\u6587\u4ef6\u7ba1\u7406"},{id:"sitemg",name:"\u7f51\u7ad9\u7ba1\u7406"},{id:"dellog",name:"\u6e05\u7a7a\u65e5\u5fd7"},{id:"panelst",name:"\u9762\u677f\u8bbe\u7f6e"},{id:"taskmg",name:"\u8ba1\u5212\u4efb\u52a1"},{id:"dockermg",name:"\u5bb9\u5668"},{id:"cmdmg",name:"\u6267\u884c\u547d\u4ee4"}]),L=e([{id:"1",name:"\u6210\u529f"},{id:"0",name:"\u5931\u8d25"}]);function C(e){b.value.page=e.page,b.value.limit=e.limit,T()}function T(){v.value=!0,V.sysOpLogsList(b.value).then((e=>{v.value=!1,2e3==e.code&&(j.value=e.data.data,_.value.page=e.data.page,_.value.limit=e.data.limit,_.value.total=e.data.total)}))}function U(){b.value.page=1,T()}function O(){I.confirm("\u6e05\u7a7a\u540e\uff0c\u5386\u53f2\u64cd\u4f5c\u8bb0\u5f55\u5c06\u65e0\u6cd5\u518d\u67e5\u8be2\uff0c\u786e\u8ba4\u5220\u9664\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{v.value=!0,y.loadingInfo.isLoading=!0,y.loadingInfo.content="\u6b63\u5728\u6e05\u7a7a...",V.sysOpLogsMg({action:"op_del_all"}).then((e=>{v.value=!1,y.loadingInfo.isLoading=!1,y.loadingInfo.content="",2e3==e.code?(E.success(e.msg),T()):E.warning(e.msg)}))})).catch((()=>{}))}return l((()=>{T()})),(e,l)=>{const f=a("el-option"),y=a("el-select"),x=a("el-button"),V=a("el-col"),I=a("el-input"),E=a("el-row"),S=a("el-table-column"),P=a("el-tag"),B=a("el-table"),M=o("loading");return s(),t("div",null,[i("div",z,[r(E,null,{default:d((()=>[r(V,{xs:24,sm:16,md:16,lg:16,xl:16},{default:d((()=>[r(y,{modelValue:m(b).module,"onUpdate:modelValue":l[0]||(l[0]=e=>m(b).module=e),placeholder:"\u8bf7\u9009\u62e9[\u64cd\u4f5c\u7c7b\u578b]",style:{width:"160px","margin-right":"10px"},onChange:l[1]||(l[1]=e=>U()),filterable:"",clearable:""},{default:d((()=>[(s(!0),t(u,null,p(m(w),(e=>(s(),c(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),r(y,{modelValue:m(b).status,"onUpdate:modelValue":l[2]||(l[2]=e=>m(b).status=e),placeholder:"\u8bf7\u9009\u62e9[\u72b6\u6001]",style:{width:"130px","margin-right":"10px"},onChange:l[3]||(l[3]=e=>U()),filterable:"",clearable:""},{default:d((()=>[(s(!0),t(u,null,p(m(L),(e=>(s(),c(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),r(x,{type:"primary",icon:"refresh",circle:"",onClick:T}),r(x,{icon:"Delete",onClick:O},{default:d((()=>l[8]||(l[8]=[g("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1})])),_:1}),r(V,{xs:24,sm:8,md:8,lg:8,xl:8},{default:d((()=>[i("div",A,[r(I,{modelValue:m(b).search,"onUpdate:modelValue":l[4]||(l[4]=e=>m(b).search=e),clearable:"",onClear:l[5]||(l[5]=e=>U()),"suffix-icon":"Search",onKeyup:l[6]||(l[6]=h((e=>U()),["enter"])),onChange:l[7]||(l[7]=e=>U()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),n((s(),c(B,{data:m(j),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:d((()=>[r(S,{prop:"username",label:"\u64cd\u4f5c\u7528\u6237",width:"130"}),r(S,{prop:"module",label:"\u64cd\u4f5c\u7c7b\u578b",width:"130"}),r(S,{prop:"ip",label:"\u8bf7\u6c42IP",width:"135"}),r(S,{prop:"ip_area",label:"IP\u5f52\u5c5e\u5730",width:"160"}),r(S,{prop:"msg",label:"\u8be6\u60c5","min-width":"200","show-overflow-tooltip":""}),r(S,{prop:"status",label:"\u72b6\u6001",width:"100"},{default:d((e=>[e.row.status?(s(),c(P,{key:1,type:"success"},{default:d((()=>l[10]||(l[10]=[g("\u6210\u529f")]))),_:1})):(s(),c(P,{key:0,type:"danger"},{default:d((()=>l[9]||(l[9]=[g("\u5931\u8d25")]))),_:1}))])),_:1}),r(S,{prop:"create_at",label:"\u64cd\u4f5c\u65f6\u95f4",width:"180"})])),_:1},8,["data"])),[[M,m(v)]]),r(k,{small:!0,"child-msg":m(_),onCallFather:C,border:!1,position:"right"},null,8,["child-msg"])])}}},[["__scopeId","data-v-2fe5b846"]]),O={key:0},S={key:0},P={key:0},B={key:0},M=w({__name:"index",setup(i){const u=L(),p=x(),h=C();let k=f((()=>u.ismobile)),w=e("panellog"),z=e("operatelog"),A=e(!1),M=e(""),N=e(300);function H(e){D(e.props.name)}function D(e=""){h.clearAllCancelToken(),M.value="",A.value=!0;let l="";l="syslogServer"==e?"get_runserver_log":"syslogError"==e?"get_runerror_log":"syslogTask"==e?"get_runtask_log":"syslogAccess"==e?"get_runaccess_log":z.value,V.sysOpLogsMg({action:l}).then((e=>{A.value=!1,2e3==e.code&&(M.value=e.data)}))}function q(e=""){I.confirm("\u786e\u5b9a\u8981\u6e05\u7a7a\u65e5\u5fd7\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((l=>{A.value=!0,p.loadingInfo.isLoading=!0,p.loadingInfo.content="\u6b63\u5728\u6e05\u7a7a...",V.sysOpLogsMg({action:"del_given_log",type:e}).then((l=>{A.value=!1,p.loadingInfo.isLoading=!1,p.loadingInfo.content="",2e3==l.code?(E.success(l.msg),D(e)):E.warning(l.msg)}))})).catch((()=>{}))}function F(){N.value=function(e){let l=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-e;var a=navigator.userAgent;return a&&/Android/.test(a)||a&&/iPhone|ipad|ipod|ios/.test(a)?500:l}(212)}function G(){j((()=>{F()}))}return l((()=>{window.addEventListener("resize",G),G()})),y((()=>{window.removeEventListener("resize",G)})),(e,l)=>{const i=a("el-tab-pane"),u=a("el-link"),p=a("el-tabs"),h=a("el-card"),f=a("el-main"),y=o("loading");return s(),c(f,{class:"ruyi-databases"},{default:d((()=>[r(h,{shadow:"never"},{default:d((()=>[r(p,{modelValue:m(w),"onUpdate:modelValue":l[9]||(l[9]=e=>v(w)?w.value=e:w=e)},{default:d((()=>[r(i,{label:"\u9762\u677f\u65e5\u5fd7",name:"panellog"},{default:d((()=>[r(p,{modelValue:m(z),"onUpdate:modelValue":l[8]||(l[8]=e=>v(z)?z.value=e:z=e),type:"card",class:b(m(k)?"":"lyinnertabs"),onTabClick:H},{default:d((()=>[r(i,{label:"\u64cd\u4f5c\u65e5\u5fd7",name:"operatelog"},{default:d((()=>["operatelog"==m(z)?(s(),c(U,{key:0})):_("",!0)])),_:1}),r(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010server\u3011",name:"syslogServer"},{default:d((()=>["syslogServer"==m(z)?n((s(),t("div",O,[r(u,{underline:!1,icon:"delete",onClick:l[0]||(l[0]=e=>q("syslogServer")),disabled:m(A),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:d((()=>l[10]||(l[10]=[g("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),r(T,{modelValue:m(M),"onUpdate:modelValue":l[1]||(l[1]=e=>v(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:m(N),"read-only":!0,bottom:!0,ref:"lyServerLogCodemirror"},null,8,["modelValue","height"])])),[[y,m(A)]]):_("",!0)])),_:1}),r(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010error\u3011",name:"syslogError"},{default:d((()=>["syslogError"==m(z)?n((s(),t("div",S,[r(u,{underline:!1,icon:"delete",onClick:l[2]||(l[2]=e=>q("syslogError")),disabled:m(A),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:d((()=>l[11]||(l[11]=[g("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),r(T,{modelValue:m(M),"onUpdate:modelValue":l[3]||(l[3]=e=>v(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:m(N),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[y,m(A)]]):_("",!0)])),_:1}),r(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010access\u3011",name:"syslogAccess"},{default:d((()=>["syslogAccess"==m(z)?n((s(),t("div",P,[r(u,{underline:!1,icon:"delete",onClick:l[4]||(l[4]=e=>q("syslogAccess")),disabled:m(A),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:d((()=>l[12]||(l[12]=[g("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),r(T,{modelValue:m(M),"onUpdate:modelValue":l[5]||(l[5]=e=>v(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:m(N),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[y,m(A)]]):_("",!0)])),_:1}),r(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010task\u3011",name:"syslogTask"},{default:d((()=>["syslogTask"==m(z)?n((s(),t("div",B,[r(u,{underline:!1,icon:"delete",onClick:l[6]||(l[6]=e=>q("syslogTask")),disabled:m(A),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:d((()=>l[13]||(l[13]=[g("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),r(T,{modelValue:m(M),"onUpdate:modelValue":l[7]||(l[7]=e=>v(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:m(N),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[y,m(A)]]):_("",!0)])),_:1})])),_:1},8,["modelValue","class"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})}}},[["__scopeId","data-v-2d74c8fc"]]);export{M as default};
