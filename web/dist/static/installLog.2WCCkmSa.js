import{_ as e,d as a,i as l,A as o}from"./index.9wSm1W-X.js";import{L as t}from"./dialog.sg3oaGqx.js";import{l as n}from"./index.C0GpYgjh.js";import{E as i}from"./element-plus.C3E-FvSa.js";import{r as s,h as u,W as r,n as d,ag as f,aq as c,c as v,o as m,P as p,H as g,G as h,J as y,I as _,u as w,L as x,M as L,t as V}from"./@vue.CQt2tj-6.js";const C={class:"lysoftLogDialog"},R=e({__name:"installLog",emits:["refreshData","closed"],setup(e,{expose:R,emit:b}){a();const j=b;let k=s(!1),z=s(!1),I=s("\u65e5\u5fd7\u8be6\u60c5"),D=s({id:""}),S={},E=s("\u52a0\u8f7d\u4e2d..."),H=s("55vh"),P=s("log"),T=s(null),q=s("new_lines");function B(){O(),j("refreshData"),j("closed")}function M(){T.value=setInterval((()=>{A()}),2e3)}function O(){clearInterval(T.value),T.value=null}function U(){T.value?O():(A(),M())}u((()=>{window.addEventListener("resize",N),N()})),r((()=>{window.removeEventListener("resize",N),O()}));let W=s(null);function A(){z.value=!0;let e={id:D.value.id,action:q.value};o.sysSoftInstallLogs(e).then((e=>{z.value=!1,2e3==e.code?(E.value=e.data.data,d((()=>{W.value&&W.value.scrollToBottom()})),e.data.done&&"all"!=q.value&&setTimeout((()=>{B()}),2e3)):(i.warning(e.msg),setTimeout((()=>{B()}),2e3))}))}function F(e){}let G=s(null),J=s(!1);function N(){d((()=>{const e=G.value.getRef();if(e.dialogContentRef){const a=e.dialogContentRef.$refs.headerRef.offsetHeight||80,l=document.body.offsetHeight;e.dialogContentRef.fullscreen||J.value?H.value=l-a:H.value="55vh"}}))}function $(e){J.value=e,N()}return R({handleOpen:function(e,a){I.value=a,k.value=!0,e&&(S=l(e),D.value.id=S.id,S.action&&(q.value=S.action),"all"!=q.value?M():A())}}),(e,a)=>{const l=f("el-link"),o=c("loading");return m(),v("div",C,[p(t,{ref_key:"codeMirrorDialogRef",ref:G,modelValue:w(k),"onUpdate:modelValue":a[1]||(a[1]=e=>V(k)?k.value=e:k=e),title:w(I),width:"50%",onOnChangeFullScreen:$,"before-close":B},{default:g((()=>["all"!=w(q)?(m(),h(l,{key:0,underline:!1,icon:w(T)?"VideoPause":"VideoPlay",onClick:U,style:{position:"absolute",top:"14px",right:"6vh","z-index":"2222","font-size":"14px"},type:w(T)?"warning":"primary"},{default:g((()=>[x(L(w(T)?"\u505c\u6b62\u5237\u65b0":"\u5f00\u542f\u5237\u65b0"),1)])),_:1},8,["icon","type"])):y("",!0),_(p(n,{modelValue:w(E),"onUpdate:modelValue":a[0]||(a[0]=e=>V(E)?E.value=e:E=e),fontSize:"13px",placeholder:(w(E),""),showLineNums:!1,lineWrapping:!1,mode:w(P),height:w(H),"read-only":!0,ref_key:"lyCodemirror",ref:W,onScrollBottomChange:F},null,8,["modelValue","placeholder","mode","height"]),[[o,"all"==w(q)&&w(z)]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-835c3b2b"]]);export{R as i};
