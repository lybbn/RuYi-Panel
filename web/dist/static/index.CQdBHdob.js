var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t;import{r as i,ag as n,c as s,o as d,P as u,H as r,u as p,O as c,a6 as m,G as f,L as v,t as g,k as y,h,aq as b,a as _,I as k,J as x,M as w,C as j,a4 as V,n as C}from"./@vue.CQt2tj-6.js";import{P as I}from"./Pagination.Nl1ehftE.js";import{_ as O,i as M,A as S,M as U,j as T,d as z,u as B}from"./index.9wSm1W-X.js";import{L as F}from"./dialog.sg3oaGqx.js";import{s as L}from"./softInfo.B4xrDuUY.js";import{b as P}from"./vue-router.BmPBvlxi.js";import{E as R,a as q}from"./element-plus.C3E-FvSa.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";const D=O({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),y=i(!1),h=i("\u6dfb\u52a0Key"),b=i({id:"",db:0,key:"",value:"",exptime:0}),_=i([]),k=i({db:[{required:!0,message:"\u8bf7\u9009\u62e9\u6570\u636e\u5e93",trigger:"blur"}],key:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u540d",trigger:"blur"}],value:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u503c",trigger:"blur"}]});function x(){t("closed")}let w=i(null);function j(){w.value.validate((e=>{e&&(y.value=!0,b.value.action="redis_set_val",S.sysSoftinfoMg(b.value).then((e=>{y.value=!1,2e3==e.code?(U(e.msg),x(),t("refreshData")):T(e.msg)})))}))}return l({handleOpen:function(e,l,a){h.value=l,o.value=!0,_.value=a,e&&(b.value=M(e))}}),(e,l)=>{const a=n("el-option"),t=n("el-select"),i=n("el-form-item"),V=n("el-input"),C=n("el-input-number"),I=n("el-alert"),O=n("el-form"),M=n("el-button");return d(),s("div",null,[u(F,{modelValue:p(o),"onUpdate:modelValue":l[4]||(l[4]=e=>g(o)?o.value=e:o=e),title:p(h),width:"680px","before-close":x},{footer:r((()=>[u(M,{onClick:x,loading:p(y)},{default:r((()=>l[6]||(l[6]=[v("\u53d6\u6d88")]))),_:1},8,["loading"]),u(M,{type:"primary",onClick:j,loading:p(y)},{default:r((()=>l[7]||(l[7]=[v("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:r((()=>[u(O,{inline:!1,model:p(b),rules:p(k),ref_key:"rulesForm",ref:w,"label-position":"right","label-width":"auto"},{default:r((()=>[u(i,{label:"\u6570\u636e\u5e93\uff1a",prop:"db"},{default:r((()=>[u(t,{modelValue:p(b).db,"onUpdate:modelValue":l[0]||(l[0]=e=>p(b).db=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:r((()=>[(d(!0),s(c,null,m(p(_),(e=>(d(),f(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(i,{label:"\u952e(key)\uff1a",prop:"key"},{default:r((()=>[u(V,{modelValue:p(b).key,"onUpdate:modelValue":l[1]||(l[1]=e=>p(b).key=e),placeholder:"\u8bf7\u8f93\u5165\u952e\u540d",clearable:""},null,8,["modelValue"])])),_:1}),u(i,{prop:"value",label:"\u503c(value)\uff1a"},{default:r((()=>[u(V,{placeholder:"\u8bf7\u8f93\u5165\u952e\u503c",clearable:"",autosize:{minRows:3,maxRows:5},type:"textarea",modelValue:p(b).value,"onUpdate:modelValue":l[2]||(l[2]=e=>p(b).value=e)},null,8,["modelValue"])])),_:1}),u(i,{prop:"exptime",label:"\u6709\u6548\u671f(s)\uff1a"},{default:r((()=>[u(C,{modelValue:p(b).exptime,"onUpdate:modelValue":l[3]||(l[3]=e=>p(b).exptime=e),min:0,style:{width:"100%"},placeholder:"\u5355\u4f4d\u79d2\uff08s\uff09"},null,8,["modelValue"])])),_:1}),u(I,{type:"warning"},{default:r((()=>l[5]||(l[5]=[v("\u6709\u6548\u671f\uff1a0\u8868\u793a\u6c38\u4e45")]))),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-91eae30f"]]),K={class:"ruyi-redis-databases"},A={style:{"margin-bottom":"20px"},class:"lystatuscard"},E={class:"lyflex"},$={class:"lyflex"},G={class:"handle-top"},H={class:"search-sites-input"},J={key:1,class:"softmask"},X={key:2,class:"soft-ins-guide-dialog"},N={class:"checkbox-container"},Q=O({__name:"index",setup(e,{expose:O}){const M=z(),U=B();let T=y((()=>U.ismobile));const Q=P();let W=i(!1),Y=i([]),Z=i(0),ee=i({search:"",page:1,limit:10,action:"get_redis_keylist",db:Z}),le=i({page:1,limit:10,total:0}),ae=i([]);function te(e){ee.value.page=e.page,ee.value.limit=e.limit,pe()}function oe(){ne("redis")}let ie=i({id:"",installed:!1,version:"",status:!1,name:""});function ne(e="redis"){M.loadingInfo.isLoading=!0,M.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",S.sysSoftinfoMg({name:e,action:"get_soft_info"}).then((e=>{M.loadingInfo.isLoading=!1,M.loadingInfo.content="",2e3==e.code?ie.value=e.data:R.warning(e.msg)}))}function se(e="stop"){let l="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",a=!1,t="\u542f\u52a8\u6210\u529f";"stop"==e?(M.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",a=!1,t="\u505c\u6b62\u6210\u529f"):"reload"==e?(M.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",l="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",a=!0,t="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==e&&(M.loadingInfo.content=ie.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",l=ie.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",a=!0,t=ie.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),q.confirm(`${l}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((l=>{M.loadingInfo.isLoading=!0,S.sysSoftManage({id:ie.value.id,status:e,action:"status"}).then((e=>{M.loadingInfo.isLoading=!1,M.loadingInfo.content="",2e3==e.code?(R.success(t),ie.value.status=a):R.warning(e.msg)}))})).catch((()=>{}))}let de=i(!1),ue=i(null);function re(){de.value=!0,C((()=>{ue.value.handleOpen(ie.value,"\u3010"+ie.value.name+"("+ie.value.version+")\u3011\u7ba1\u7406")}))}function pe(){W.value=!0,S.sysSoftinfoMg(ee.value).then((e=>{W.value=!1,2e3===e.code?(ae.value=e.data.list,le.value.page=e.data.page,le.value.limit=e.data.limit,le.value.total=e.data.total):R.warning(e.msg)}))}function ce(){ee.value.page=1,pe()}function me(e){ee.value.page=1,ee.value.db=e.props.name,ae.value=[],ce(),be()}let fe=i(!1),ve=i(null);function ge(){fe.value=!0,C((()=>{ve.value.handleOpen(null,"\u6dfb\u52a0Key",Y.value)}))}function ye(e){let i=((e,i)=>{for(var n in i||(i={}))a.call(i,n)&&o(e,n,i[n]);if(l)for(var n of l(i))t.call(i,n)&&o(e,n,i[n]);return e})({},e);i.db=ee.value.db,fe.value=!0,C((()=>{ve.value.handleOpen(i,"\u7f16\u8f91Key",Y.value)}))}function he(){Q.push({path:"/appstore"})}function be(){S.sysSoftinfoMg({action:"get_redis_dblist"}).then((e=>{2e3==e.code&&(Y.value=e.data)}))}let _e=i(!1),ke=i([]),xe=i(!1),we=i(!1),je=i(!0);function Ve(e){e?(ke.value=[],Y.value.forEach((e=>{ke.value.push(e.id)}))):ke.value=[],je.value=!1}function Ce(){_e.value=!0,ke.value=[]}function Ie(){_e.value=!1,ke.value=[],je.value=!0}function Oe(){q.confirm("\u662f\u5426\u6e05\u7a7a\u9009\u62e9\u7684\u6570\u636e\u5e93\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{we.value=!0,S.sysSoftinfoMg({action:"redis_flashdb",ids:ke.value}).then((e=>{we.value=!1,2e3==e.code?(R.success(e.msg),Se(),Ie()):R.warning(e.msg)}))})).catch((()=>{}))}function Me(e){const l=e.length;xe.value=l===Y.value.length,je.value=l>0&&l<Y.value.length}function Se(){C((()=>{be(),pe()}))}return h((()=>{ne("redis"),Se()})),O({RefreshData:Se}),(e,l)=>{const a=n("el-tag"),t=n("el-button"),o=n("el-divider"),i=n("el-card"),y=n("el-col"),h=n("el-input"),C=n("el-row"),O=n("el-tab-pane"),M=n("el-tabs"),U=n("el-table-column"),z=n("el-table"),B=n("InfoFilled"),P=n("el-icon"),Q=n("el-checkbox"),ne=n("el-checkbox-group"),pe=b("loading");return d(),s("div",K,[_("div",A,[u(i,{shadow:"hover",style:j({overflowX:p(T)?"auto":"none"})},{default:r((()=>[_("div",E,[u(a,{style:{"margin-right":"20px"},effect:"dark",type:"success"},{default:r((()=>l[12]||(l[12]=[v(w("redis"))]))),_:1}),u(a,{style:{"margin-right":"20px"},type:p(ie).installed?"success":"info"},{default:r((()=>[v(w(p(ie).installed?"\u5df2\u5b89\u88c5":"\u672a\u5b89\u88c5"),1)])),_:1},8,["type"]),u(a,{style:{"margin-right":"20px"}},{default:r((()=>[v("\u7248\u672c: "+w(p(ie).version||"\u672a\u77e5"),1)])),_:1}),u(a,{style:{"margin-right":"20px"},type:p(ie).status?"success":"danger"},{default:r((()=>[v("\u72b6\u6001: "+w(p(ie).status?"\u5df2\u542f\u52a8":"\u672a\u542f\u52a8"),1)])),_:1},8,["type"]),_("div",$,[u(t,{type:"primary",link:"",onClick:l[0]||(l[0]=e=>se("stop")),disabled:!p(ie).installed},{default:r((()=>l[13]||(l[13]=[v("\u505c\u6b62")]))),_:1},8,["disabled"]),u(o,{direction:"vertical"}),u(t,{type:"primary",link:"",onClick:l[1]||(l[1]=e=>se("restart")),disabled:!p(ie).installed},{default:r((()=>[v(w(p(ie).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1},8,["disabled"])]),u(o,{direction:"vertical"}),u(t,{type:"primary",link:"",onClick:re,disabled:!p(ie).installed},{default:r((()=>l[14]||(l[14]=[v(w("\u8bbe\u7f6e"))]))),_:1},8,["disabled"])])])),_:1},8,["style"])]),_("div",G,[u(C,null,{default:r((()=>[u(y,{xs:24,sm:16,md:16,lg:16,xl:16},{default:r((()=>[u(t,{type:"primary",onClick:ge,disabled:p(Y).length<1},{default:r((()=>l[15]||(l[15]=[v("\u6dfb\u52a0Key")]))),_:1},8,["disabled"]),u(t,{icon:"delete",onClick:Ce,disabled:!p(ie).status},{default:r((()=>l[16]||(l[16]=[v("\u6e05\u7a7a\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),u(t,{icon:"refresh",onClick:Se})])),_:1}),u(y,{xs:24,sm:8,md:8,lg:8,xl:8},{default:r((()=>[_("div",H,[u(h,{modelValue:p(ee).search,"onUpdate:modelValue":l[2]||(l[2]=e=>p(ee).search=e),clearable:"",onClear:l[3]||(l[3]=e=>ce()),"suffix-icon":"Search",onKeyup:l[4]||(l[4]=V((e=>ce()),["enter"])),onChange:l[5]||(l[5]=e=>ce()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),u(M,{modelValue:p(Z),"onUpdate:modelValue":l[6]||(l[6]=e=>g(Z)?Z.value=e:Z=e),onTabClick:me,type:"card"},{default:r((()=>[(d(!0),s(c,null,m(p(Y),(e=>(d(),f(O,{key:e.id,label:e.name+"("+e.keynum+")",name:e.id},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),k((d(),f(z,{data:p(ae),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:r((()=>[u(U,{prop:"key",label:"\u952e(key)","min-width":"150","show-overflow-tooltip":""}),u(U,{prop:"value",label:"\u503c(value)","min-width":"180"}),u(U,{prop:"type",label:"\u6570\u636e\u7c7b\u578b","min-width":"109"}),u(U,{prop:"len",label:"\u6570\u636e\u957f\u5ea6","min-width":"120"}),u(U,{prop:"exptime",label:"\u6709\u6548\u671f(\u79d2)","min-width":"120"},{default:r((e=>[v(w(0==e.row.exptime?"\u6c38\u4e45":e.row.exptime),1)])),_:1}),u(U,{fixed:!p(T)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:r((e=>[u(t,{link:"",type:"primary",onClick:l=>ye(e.row)},{default:r((()=>l[17]||(l[17]=[v("\u7f16\u8f91")]))),_:2},1032,["onClick"]),u(t,{link:"",type:"primary",onClick:l=>{return a=e.row,void q.confirm(`\u662f\u5426\u5220\u9664\u3010${a.key}\u3011`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{W.value=!0,S.sysSoftinfoMg({action:"redis_del_val",db:Z.value,key:a.key}).then((e=>{W.value=!1,2e3==e.code?(R.success(e.msg),Se()):R.warning(e.msg)}))})).catch((()=>{}));var a}},{default:r((()=>l[18]||(l[18]=[v("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[pe,p(W)]]),u(I,{small:!0,"child-msg":p(le),onCallFather:te,border:!1,position:"right"},null,8,["child-msg"]),p(fe)?(d(),f(D,{key:0,ref_key:"moduleAddFlag",ref:ve,onClosed:l[7]||(l[7]=e=>g(fe)?fe.value=!1:fe=!1),onRefreshData:Se},null,512)):x("",!0),p(ie).installed?x("",!0):(d(),s("div",J)),p(ie).installed?x("",!0):(d(),s("div",X,[u(P,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:r((()=>[u(B)])),_:1}),l[20]||(l[20]=v(" \u5f53\u524d\u672a\u5b89\u88c5Redis\u73af\u5883 ")),u(t,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:he},{default:r((()=>l[19]||(l[19]=[v("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})])),u(F,{modelValue:p(_e),"onUpdate:modelValue":l[10]||(l[10]=e=>g(_e)?_e.value=e:_e=e),top:"30vh",title:"\u6e05\u7a7a\u6570\u636e\u5e93",width:"560px","before-close":Ie,showFullScreen:!1},{footer:r((()=>[u(t,{onClick:Ie,loading:p(we)},{default:r((()=>l[22]||(l[22]=[v("\u53d6\u6d88")]))),_:1},8,["loading"]),u(t,{type:"primary",onClick:Oe,loading:p(we)},{default:r((()=>l[23]||(l[23]=[v("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:r((()=>[u(Q,{modelValue:p(xe),"onUpdate:modelValue":l[8]||(l[8]=e=>g(xe)?xe.value=e:xe=e),indeterminate:p(je),onChange:Ve},{default:r((()=>l[21]||(l[21]=[_("span",{style:{"font-weight":"bold","font-size":"15px"}},"\u5168\u9009",-1),v("(\u4e3a\u7a7a\u6216\u5168\u9009\u8868\u793a\u6e05\u7a7a\u6240\u6709\u6570\u636e\u5e93) ")]))),_:1},8,["modelValue","indeterminate"]),_("div",N,[u(ne,{modelValue:p(ke),"onUpdate:modelValue":l[9]||(l[9]=e=>g(ke)?ke.value=e:ke=e),onChange:Me},{default:r((()=>[(d(!0),s(c,null,m(p(Y),(e=>(d(),f(Q,{key:e.id,label:e.name,value:e.id},{default:r((()=>[v(w(e.name),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"]),p(de)?(d(),f(L,{key:3,ref_key:"softInfoFlag",ref:ue,onClosed:l[11]||(l[11]=e=>g(de)?de.value=!1:de=!1),onRefreshStatus:oe},null,512)):x("",!0)])}}},[["__scopeId","data-v-cd3f57f0"]]);export{Q as default};
