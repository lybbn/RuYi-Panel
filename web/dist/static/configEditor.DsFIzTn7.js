import{L as e}from"./dialog.sg3oaGqx.js";import{l as a}from"./index.C0GpYgjh.js";import"./crypto-js.BjUPrIIl.js";import"./js-cookie.Ch5AnFJE.js";import"./clipboard.BBhAuw9K.js";import{_ as l}from"./index.9wSm1W-X.js";import{E as o,a as t}from"./element-plus.C3E-FvSa.js";import{r as n,h as s,S as i,ag as u,G as d,o as r,H as c,a as f,P as v,u as p,L as h,t as g,n as m}from"./@vue.CQt2tj-6.js";const y=l({__name:"configEditor",props:{apiObj:{type:Function,default:null},saveApiObj:{type:Function,default:null},saveContentKey:{type:String,default:"content"},successCode:{type:Number,default:2e3},fullscreen:{type:Boolean,default:!1},canSave:{type:Boolean,default:!0},width:{type:String,default:"60%"},top:{type:String,default:"10vh"}},emits:["closed"],setup(l,{expose:y,emit:j}){const b=j,C=l;let w=n(null),k=n("55vh"),O=n("javascript"),_=n(!1),F=n(null),R=n(null),S=n(""),x=n(""),z=n("FolderChecked"),H=n(!1),L=n(""),V=n(!1),A=n({}),B=n({});function E(){x.value!=S.value?t.confirm("\u68c0\u6d4b\u5230\u6587\u4ef6\u53d8\u52a8\uff0c\u662f\u5426\u4fdd\u5b58\u66f4\u6539?","\u63d0\u793a",{confirmButtonText:"\u4fdd\u5b58",cancelButtonText:"\u4e0d\u4fdd\u5b58",type:"warning"}).then((()=>{D(!0)})).catch((()=>{b("closed")})):b("closed")}function I(e){e==x.value?z.value="FolderChecked":z.value="InfoFilled"}function K(e){m((()=>{const a=w.value.getRef();if(a.dialogContentRef){const l=a.dialogContentRef.$refs.headerRef.offsetHeight,o=document.body.offsetHeight;k.value=e?o-l-R.value.offsetHeight:"55vh"}}))}function N(){V.value=!0;var e={};Object.assign(e,A.value),C.apiObj&&C.apiObj!={}?C.apiObj(e).then((e=>{V.value=!1,e.code==C.successCode?("json"==O.value?S.value=function(e){try{return JSON.stringify(JSON.parse(e),null,4)}catch(a){return e}}(e.data):S.value=e.data,x.value=S.value):(o.warning(e.msg),_.value=!0)})):V.value=!1}function D(e=!1){if(C.canSave){V.value=!0;var a={};a[C.saveContentKey]=S.value,Object.assign(a,B.value),C.saveApiObj&&C.saveApiObj!={}?C.saveApiObj(a).then((a=>{V.value=!1,a.code==C.successCode?(x.value=S.value,o.success("\u4fdd\u5b58\u6210\u529f"),z.value="FolderChecked",e&&b("closed")):o.warning(a.msg)})):V.value=!1}else o.warning("\u7981\u6b62\u4fdd\u5b58")}function J(){m((()=>{const e=w.value.getRef();if(e.dialogContentRef){const a=e.dialogContentRef.$refs.headerRef.offsetHeight,l=document.body.offsetHeight;e.dialogContentRef.fullscreen?k.value=l-a-R.value.offsetHeight:k.value="55vh"}}))}function T(e){e.ctrlKey&&"s"===e.key.toLowerCase()&&(e.preventDefault(),x.value==S.value?o.warning("\u68c0\u6d4b\u5230\u6587\u4ef6\u672a\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58"):D(!1))}return s((()=>{window.addEventListener("resize",J),J()})),i((()=>{window.removeEventListener("resize",J)})),y({handleOpen:function(e,a,l,o){L.value=o,H.value=!0,l&&(O.value=l),A.value=Object.assign(A.value,e),a&&(B.value=a),m((()=>{N()}))}}),(o,t)=>{const n=u("el-button"),s=u("InfoFilled"),i=u("el-icon"),m=u("FolderChecked");return r(),d(e,{ref_key:"codeMirrorDialogRef",ref:w,loading:p(V),modelValue:p(H),"onUpdate:modelValue":t[2]||(t[2]=e=>g(H)?H.value=e:H=e),title:p(L),width:l.width,top:l.top,"before-close":E,fullscreen:l.fullscreen,onOnChangeFullScreen:K},{default:c((()=>[f("div",{class:"handlecaoz",ref_key:"handlecaozRef",ref:R},[v(n,{disabled:p(V),size:"small",type:"info",color:"#2F3128",dark:"",icon:"Refresh",onClick:N},{default:c((()=>t[3]||(t[3]=[h("\u5237\u65b0")]))),_:1},8,["disabled"]),v(n,{disabled:p(V)||p(_),size:"small",type:"info",color:"#2F3128",dark:"",onClick:t[0]||(t[0]=e=>D(!1))},{icon:c((()=>["InfoFilled"==p(z)?(r(),d(i,{key:0,style:{color:"var(--el-color-warning)"}},{default:c((()=>[v(s)])),_:1})):(r(),d(i,{key:1},{default:c((()=>[v(m)])),_:1}))])),default:c((()=>[t[4]||(t[4]=h(" \u4fdd\u5b58 "))])),_:1},8,["disabled"])],512),v(a,{onKeydown:T,modelValue:p(S),"onUpdate:modelValue":t[1]||(t[1]=e=>g(S)?S.value=e:S=e),onChange:I,fontSize:"15px",placeholder:(p(S),""),showLineNums:!0,lineWrapping:!0,mode:p(O),height:p(k),"read-only":p(_),ref_key:"lyCodemirror",ref:F},null,8,["modelValue","placeholder","mode","height","read-only"])])),_:1},8,["loading","modelValue","title","width","top","fullscreen"])}}},[["__scopeId","data-v-afea48a4"]]);export{y as l};
