var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,n)=>{for(var i in n||(n={}))a.call(n,i)&&o(e,i,n[i]);if(l)for(var i of l(n))t.call(n,i)&&o(e,i,n[i]);return e},i=(e,l,a)=>new Promise(((t,o)=>{var n=e=>{try{s(a.next(e))}catch(l){o(l)}},i=e=>{try{s(a.throw(e))}catch(l){o(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);s((a=a.apply(e,l)).next())}));import{_ as s,l as u,A as d,M as r,j as p,i as c,e as m,k as f,n as v,u as b,d as h}from"./index.FQhv3U_5.js";import{r as g,ag as _,c as y,o as w,P as k,H as x,u as C,G as V,J as D,L as R,O as I,a6 as j,a as S,t as O,aq as P,I as U,M as F,n as B,k as q,a4 as M,h as z,C as T}from"./@vue.CQt2tj-6.js";import{P as $}from"./Pagination.8Er6hDxx.js";import{L as A}from"./dialog.Bsrh65Nu.js";import{b as L}from"./batchOp.C8abNsmc.js";import{a as E,E as H}from"./element-plus.C3E-FvSa.js";import{_ as K}from"./index.C8lU5NoS.js";import{b as J}from"./vue-router.BmPBvlxi.js";import{s as G}from"./softInfo.kcMLyEqL.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";const N=s({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),i=g(!1),s=g("\u6dfb\u52a0\u7f51\u7ad9"),c=g({format:"utf8mb4",db_name:"",remark:"",db_user:"",db_pass:"",accept:"localhost",accept_ips:"",db_type:0,db_host:"127.0.0.1"}),m=g([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),f=g([{id:"127.0.0.1",name:"\u672c\u5730\u670d\u52a1\u5668"}]),v=g([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),b=g({db_name:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u5e93\u540d",trigger:"blur"}],db_user:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",trigger:"blur"}],db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}],accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650",trigger:"blur"}]});function h(){t("closed")}function P(){c.value.db_pass=u(16)}let U=g(null);function F(){U.value.validate((e=>{if(e){i.value=!0;let e=n({},c.value);"ip"!=e.accept&&(e.accept_ips=""),d.sysDatabasesAdd(e).then((e=>{i.value=!1,2e3==e.code?(r(e.msg),h(),t("refreshData")):p(e.msg)}))}}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0,P()}}),(e,l)=>{const a=_("el-option"),t=_("el-select"),n=_("el-input"),u=_("el-form-item"),d=_("el-button"),r=_("el-form");return w(),y("div",null,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[9]||(l[9]=e=>O(o)?o.value=e:o=e),title:C(s),width:"680px","before-close":h},{footer:x((()=>[k(d,{onClick:h,loading:C(i)},{default:x((()=>l[12]||(l[12]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(d,{type:"primary",onClick:F,loading:C(i)},{default:x((()=>l[13]||(l[13]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(r,{inline:!1,model:C(c),rules:C(b),ref_key:"rulesForm",ref:U,"label-position":"right","label-width":"auto"},{default:x((()=>[k(u,{label:"\u6570\u636e\u5e93\u540d\uff1a",prop:"db_name"},{default:x((()=>[k(n,{clearable:"",placeholder:"\u6570\u636e\u5e93\u540d",modelValue:C(c).db_name,"onUpdate:modelValue":l[1]||(l[1]=e=>C(c).db_name=e),modelModifiers:{trim:!0},onInput:l[2]||(l[2]=e=>C(c).db_user=C(c).db_name)},{append:x((()=>[k(t,{modelValue:C(c).format,"onUpdate:modelValue":l[0]||(l[0]=e=>C(c).format=e),style:{width:"140px"}},{default:x((()=>[k(a,{label:"utf8mb4",value:"utf8mb4"}),k(a,{label:"utf-8",value:"utf8"}),k(a,{label:"gbk",value:"gbk"}),k(a,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),k(u,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:x((()=>[k(n,{modelValue:C(c).db_user,"onUpdate:modelValue":l[3]||(l[3]=e=>C(c).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:""},null,8,["modelValue"])])),_:1}),k(u,{label:"\u5bc6\u7801\uff1a",prop:"db_pass"},{default:x((()=>[k(n,{placeholder:"\u5bc6\u7801",modelValue:C(c).db_pass,"onUpdate:modelValue":l[4]||(l[4]=e=>C(c).db_pass=e),modelModifiers:{trim:!0}},{append:x((()=>[k(d,{onClick:P},{default:x((()=>l[10]||(l[10]=[R("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),k(u,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:x((()=>[k(t,{modelValue:C(c).accept,"onUpdate:modelValue":l[5]||(l[5]=e=>C(c).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},clearable:"",filterable:""},{default:x((()=>[(w(!0),y(I,null,j(C(m),(e=>(w(),V(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===C(c).accept?(w(),V(u,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===C(c).accept?C(v):[]},{default:x((()=>[k(n,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:C(c).accept_ips,"onUpdate:modelValue":l[6]||(l[6]=e=>C(c).accept_ips=e)},null,8,["modelValue"]),l[11]||(l[11]=S("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):D("",!0),k(u,{label:"\u5907\u6ce8\uff1a",prop:"remark"},{default:x((()=>[k(n,{modelValue:C(c).remark,"onUpdate:modelValue":l[7]||(l[7]=e=>C(c).remark=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"\u5907\u6ce8\u4fe1\u606f",clearable:""},null,8,["modelValue"])])),_:1}),k(u,{label:"\u6dfb\u52a0\u5230\uff1a",prop:"db_host"},{default:x((()=>[k(t,{modelValue:C(c).db_host,"onUpdate:modelValue":l[8]||(l[8]=e=>C(c).db_host=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:x((()=>[(w(!0),y(I,null,j(C(f),(e=>(w(),V(a,{key:e.id,label:e.name+"("+e.id+")",value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-dca61120"]]),X=s({__name:"modulePass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),n=g(!1),i=g("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),s=g(!1),c=g({name:"mysql",action:"set_db_pass",passwd:""}),m=g({passwd:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function f(){t("closed")}function v(){c.value.passwd=u(16)}let b=g(null);function h(){b.value.validate((e=>{e&&(n.value=!0,d.sysDatabasesPass(c.value).then((e=>{n.value=!1,2e3==e.code?(r(e.msg),f(),t("refreshData")):p(e.msg)})))}))}return l({handleOpen:function(e,l){i.value=l,o.value=!0,s.value=!0,d.sysDatabasesPass({action:"get_db_pass",name:"mysql"}).then((e=>{s.value=!1,2e3==e.code?c.value.passwd=e.data:p(e.msg)}))}}),(e,l)=>{const a=_("el-button"),t=_("el-input"),u=_("el-form-item"),d=_("el-form"),r=P("loading");return U((w(),y("div",null,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[1]||(l[1]=e=>O(o)?o.value=e:o=e),title:C(i),width:"580px","before-close":f,showFullScreen:!1},{footer:x((()=>[k(a,{onClick:f,loading:C(n)},{default:x((()=>l[3]||(l[3]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(a,{type:"primary",onClick:h,loading:C(n)},{default:x((()=>l[4]||(l[4]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(d,{inline:!1,model:C(c),rules:C(m),ref_key:"rulesForm",ref:b,"label-position":"right","label-width":"auto"},{default:x((()=>[k(u,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"passwd"},{default:x((()=>[k(t,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:C(c).passwd,"onUpdate:modelValue":l[0]||(l[0]=e=>C(c).passwd=e),modelModifiers:{trim:!0}},{append:x((()=>[k(a,{onClick:v},{default:x((()=>l[2]||(l[2]=[R("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[r,C(s)]])}}},[["__scopeId","data-v-6e19df75"]]),Q=s({__name:"moduleResetUserPass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),n=g(!1),i=g("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),s=g(!1),m=g({id:"",name:"mysql",action:"set_db_user_pass",db_pass:"",db_user:""}),f=g({db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function v(){t("closed")}function b(){m.value.db_pass=u(16)}let h=g(null);function V(){h.value.validate((e=>{e&&(n.value=!0,d.sysDatabasesPass(m.value).then((e=>{n.value=!1,2e3==e.code?(r(e.msg),v(),t("refreshData")):p(e.msg)})))}))}return l({handleOpen:function(e,l){if(i.value=l,o.value=!0,e){let l=c(e);m.value.id=l.id,m.value.db_user=l.db_user,m.value.db_pass=l.db_pass}}}),(e,l)=>{const a=_("el-input"),t=_("el-form-item"),u=_("el-button"),d=_("el-form"),r=P("loading");return U((w(),y("div",null,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[2]||(l[2]=e=>O(o)?o.value=e:o=e),title:C(i),width:"580px","before-close":v,showFullScreen:!1},{footer:x((()=>[k(u,{onClick:v,loading:C(n)},{default:x((()=>l[4]||(l[4]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(u,{type:"primary",onClick:V,loading:C(n)},{default:x((()=>l[5]||(l[5]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(d,{inline:!1,model:C(m),rules:C(f),ref_key:"rulesForm",ref:h,"label-position":"right","label-width":"auto"},{default:x((()=>[k(t,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:x((()=>[k(a,{modelValue:C(m).db_user,"onUpdate:modelValue":l[0]||(l[0]=e=>C(m).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:"",disabled:!0},null,8,["modelValue"])])),_:1}),k(t,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"db_pass"},{default:x((()=>[k(a,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:C(m).db_pass,"onUpdate:modelValue":l[1]||(l[1]=e=>C(m).db_pass=e),modelModifiers:{trim:!0}},{append:x((()=>[k(u,{onClick:b},{default:x((()=>l[3]||(l[3]=[R("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[r,C(s)]])}}},[["__scopeId","data-v-a614f0ce"]]),W=s({__name:"moduleAccept",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),n=g(!1),i=g("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),s=g(!1),u=g({id:"",name:"mysql",action:"set_db_accept",accept:"localhost",accept_ips:""}),m=g([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),f=g([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),v=g({accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u8bbf\u95ee\u6743\u9650",trigger:"blur"}]});function b(){t("closed")}let h=g(null);function F(){h.value.validate((e=>{e&&(n.value=!0,d.sysDatabasesPass(u.value).then((e=>{n.value=!1,2e3==e.code?(r(e.msg),b(),t("refreshData")):p(e.msg)})))}))}return l({handleOpen:function(e,l){if(i.value=l,o.value=!0,e){let l=c(e);u.value.id=l.id,u.value.accept=l.accept,u.value.accept_ips=l.accept_ips}}}),(e,l)=>{const a=_("el-option"),t=_("el-select"),d=_("el-form-item"),r=_("el-input"),p=_("el-form"),c=_("el-button"),g=P("loading");return U((w(),y("div",null,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[2]||(l[2]=e=>O(o)?o.value=e:o=e),title:C(i),width:"580px","before-close":b,showFullScreen:!1},{footer:x((()=>[k(c,{onClick:b,loading:C(n)},{default:x((()=>l[4]||(l[4]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(c,{type:"primary",onClick:F,loading:C(n)},{default:x((()=>l[5]||(l[5]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(p,{inline:!1,model:C(u),rules:C(v),ref_key:"rulesForm",ref:h,"label-position":"right","label-width":"auto"},{default:x((()=>[k(d,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:x((()=>[k(t,{modelValue:C(u).accept,"onUpdate:modelValue":l[0]||(l[0]=e=>C(u).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:x((()=>[(w(!0),y(I,null,j(C(m),(e=>(w(),V(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===C(u).accept?(w(),V(d,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===C(u).accept?C(f):[]},{default:x((()=>[k(r,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:C(u).accept_ips,"onUpdate:modelValue":l[1]||(l[1]=e=>C(u).accept_ips=e)},null,8,["modelValue"]),l[3]||(l[3]=S("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):D("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[g,C(s)]])}}},[["__scopeId","data-v-51a833d1"]]),Y={class:"lyBackupDialog"},Z={key:3},ee=s({__name:"moduleBackup",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1);g(!1);let n=g("\u6570\u636e\u5e93\u5907\u4efd"),s=g(!1),u=g(!1),v=g(""),b=g({fid:"",type:1,page:1,limit:10}),h=g({page:1,limit:10,total:0}),D=g([]),I=g({});function j(){t("closed"),t("refreshData")}function S(e){b.value.page=e.page,b.value.limit=e.limit,q()}function q(){s.value=!0,d.sysBakBackUpList(b.value).then((e=>{s.value=!1,2e3==e.code?(D.value=e.data.data,h.value.page=e.data.page,h.value.limit=e.data.limit,h.value.total=e.data.total):p(e.msg)}))}function M(){u.value=!0,d.sysDatabasesDbtools({action:"backup_db",id:b.value.fid}).then((e=>{u.value=!1,2e3==e.code?(r(e.msg),q()):p(e.msg)}))}let z=g([]),T=g([]);function K(e){T.value=c(e),z.value=e.map((e=>e.id))}let J=g(null);function G(){B((()=>{J.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let N=g(0),X=g("0%"),Q=g(!1),W=g(1),ee=g("");function le(e){return new Promise((l=>setTimeout(l,e)))}function ae(){return i(this,null,(function*(){W.value=2,Q.value=!0,T.value.forEach((e=>{e.status="wait"}));let e=T.value.length,l=0;for(let a=0;a<e;a++){N.value=a+1==e?100:parseInt((a+1)/e*100),X.value=N.value+"%";let t="del_backup_db",o={id:b.value.fid,bid:T.value[a].id,action:t};d.sysDatabasesDbtools(o).then((e=>{2e3==e.code?T.value[a].status="success":(T.value[a].status="error",l+=1)})),yield le(1e3)}Q.value=!1,W.value=3,ee.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}return l({handleOpen:function(e,l){n.value=l,o.value=!0,b.value.fid=e.id,v.value=e.db_name,q()}}),(e,l)=>{const a=_("el-button"),t=_("el-form-item"),i=_("el-form"),r=_("el-table-column"),p=_("el-table"),c=_("el-tag"),g=P("loading");return w(),y("div",Y,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[0]||(l[0]=e=>O(o)?o.value=e:o=e),title:C(n),width:"60%","before-close":j,loading:C(u)},{default:x((()=>[k(i,{inline:!1,model:C(b),rules:C(I),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:C(u)},{default:x((()=>[k(t,null,{default:x((()=>[k(a,{type:"primary",onClick:M},{default:x((()=>l[1]||(l[1]=[R("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1}),k(a,{onClick:G,disabled:C(z).length<1},{default:x((()=>l[2]||(l[2]=[R("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),U((w(),V(p,{ref:"table",border:"",data:C(D),height:410,onSelectionChange:K},{default:x((()=>[k(r,{type:"selection",width:"55",align:"center"}),k(r,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),k(r,{prop:"size",label:"\u5927\u5c0f","min-width":"100"},{default:x((e=>[R(F(C(m)(e.row.size)),1)])),_:1}),k(r,{prop:"filename",label:"\u4f4d\u7f6e","min-width":"190","show-overflow-tooltip":""}),k(r,{prop:"create_at",label:"\u65f6\u95f4","min-width":"160"}),k(r,{prop:"store_type",label:"\u5b58\u50a8\u5bf9\u8c61","min-width":"90"}),k(r,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:x((e=>[k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${v.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{s.value=!0;let l={id:b.value.fid,bid:a.id,action:"recover_db_sql"};d.sysDatabasesDbtools(l).then((e=>{s.value=!1,2e3==e.code?(H.success(e.msg),q()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>l[3]||(l[3]=[R("\u6062\u590d")]))),_:2},1032,["onClick"]),k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void d.sysBakFileDownload({id:b.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);H.warning(e.msg)}}else f(e.data,a.name)}));var a}},{default:x((()=>l[4]||(l[4]=[R("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{s.value=!0;let l={id:b.value.fid,bid:a.id,action:"del_backup_db"};d.sysDatabasesDbtools(l).then((e=>{s.value=!1,2e3==e.code?(H.success(e.msg),q()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>l[5]||(l[5]=[R("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[g,C(s)]]),k($,{small:!0,"child-msg":C(h),onCallFather:S},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),k(L,{ref_key:"batchOpRef",ref:J,onClosed:q,tip2:C(ee),percentContent:C(X),percentage:C(N),loadingSave:C(Q),stepStatus:C(W)},{table:x((()=>[k(p,{data:C(T),border:"","max-height":500},{default:x((()=>[k(r,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),k(r,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:x((e=>["wait"==e.row.status?(w(),V(c,{key:0,type:"info"},{default:x((()=>l[6]||(l[6]=[R("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(w(),V(c,{key:1,type:"success"},{default:x((()=>l[7]||(l[7]=[R("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(w(),V(c,{key:2,type:"danger"},{default:x((()=>l[8]||(l[8]=[R("\u5220\u9664\u5931\u8d25")]))),_:1})):(w(),y("span",Z))])),_:1})])),_:1},8,["data"])])),footer:x((()=>[k(a,{type:"primary",onClick:ae,loading:C(Q)},{default:x((()=>l[9]||(l[9]=[R("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"])])}}},[["__scopeId","data-v-1e331b57"]]),le={class:"lyuploadimport"},ae={key:1,class:"handle-button"},te={class:"handle-drag"},oe={key:0},ne={key:1},ie={key:0},se={key:1,style:{color:"green"}},ue={key:2},de={key:0},re=s({__name:"moduleUpload",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),n=g(!1),s=g(""),u=g(""),d=g([]),r=g(""),p=g(0),f=g(null),b=g("file"),h=g(null),I=g(null),j=g(!1),P=g(0),U=g("");function q(){t("refreshData"),t("closed")}function M(){j.value=!1,d.value=[],P.value=0,U.value="",T()}function z(e){b.value=e,h.value.webkitdirectory=!1,f.value.$el.querySelector("input").click()}function T(){f.value.clearFiles()}function $(e){e.preventDefault()}function L(e){e.preventDefault();const l=e.dataTransfer.items;if(l)for(let a=0;a<l.length;a++){const e=l[a].webkitGetAsEntry();e&&K(e)}}function E(e){e.preventDefault()}function K(e,l=""){if(l=l||"",e.isFile)e.file((e=>{d.value.push(function(e,l){const a=Date.now(),t=new File([e],e.name,{type:e.type,lastModified:e.lastModified});t.uid=a;let o=e.name;""!=l&&(o=l+e.name);return{name:o,size:e.size,status:"ready",uid:a,raw:t}}(e,l))}));else if(e.isDirectory){e.createReader().readEntries((a=>{for(let t=0;t<a.length;t++)K(a[t],l+e.name+"/")}))}}function J(e,l){const a=l.findIndex((l=>l.name===e.name));if(a!=l.findLastIndex((l=>l.name===e.name))&&e.raw.webkitRelativePath==l[a].raw.webkitRelativePath&&(H.error(e.name+" \u6587\u4ef6\u5df2\u5b58\u5728"),l.pop()),64==e.size||0==e.size){d.value=l;const a=new FileReader;a.readAsDataURL(e.raw),a.onload=()=>i(this,null,(function*(){})),a.onerror=()=>{d.value=d.value.filter((l=>l.uid!==e.uid)),H.error({message:`\u3010${e.name}\u3011\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u4e3a\u7a7a\u6587\u4ef6\u5939`,type:"error",showClose:!0,duration:3e3})}}else d.value=l;!function(){i(this,null,(function*(){B((()=>{let e=I.value.scrollBarRef.wrapRef.offsetHeight;I.value.scrollBarRef.setScrollTop(e)}))}))}()}function G(e){f.value.clearFiles();for(let l=0;l<e.length;l++){const a=e[l];f.value.handleStart(a)}}function N(e,l){l.status="success"}let X=g(0);function Q(e){return i(this,null,(function*(){B((()=>{if(0==(e=e||0))I.value.scrollBarRef.setScrollTop(0);else if(X.value>3){if(e>0){let l=I.value.scrollBarRef.wrapRef.offsetHeight/d.value.length;e=l*X.value}I.value.scrollBarRef.setScrollTop(e)}}))}))}function W(e){return e?e.split("/").slice(0,-1).join("/"):e}function Y(e){let l=0;for(let a=0;a<d.value.length;a++)l+=d.value[a].size;return m(l/e)}function Z(){return i(this,null,(function*(){yield Q(0);const e=new Date;n.value=!0,X.value=0;const l=d.value.slice();for(let a=0;a<l.length;a++){const t=l[a],o=t.size;if(r.value=`\u3010${t.name}\u3011\u5f00\u59cb\u4e0a\u4f20`,o<=5242880){const e=new FormData;e.append("lyfile",t.raw),""!=t.raw.webkitRelativePath?e.append("path",u.value+"/"+W(t.raw.webkitRelativePath)):e.append("path",u.value+"/"+W(t.name)),p.value=0,yield v({url:"/api/sys/fileManage/upload/",formData:e},(e=>{p.value=Math.round(e.loaded/e.total*100)})).then((e=>{2e3===e.code?(X.value++,d.value[a].status="success"):(X.value++,d.value[a].status=e.msg)})).catch((e=>{H({message:e,grouping:!0,type:"warning"}),X.value++,d.value[a].status=e}))}else{const e=5242880,l=Math.ceil(o/e);let n=0;p.value=0;for(let i=0;i<l;i++){const s=i*e,r=Math.min(s+e,o),c=t.raw.slice(s,r),m=new FormData;m.append("lyfilechunk",t.name),""!=t.raw.webkitRelativePath?m.append("path",u.value+"/"+W(t.raw.webkitRelativePath)):m.append("path",u.value+"/"+W(t.name)),m.append("chunkSize",e),m.append("totalSize",o),m.append("chunk",c),m.append("chunkIndex",i.toString()),m.append("chunkCount",l.toString());let f=!0;if(yield v({url:"/api/sys/fileManage/upload/",formData:m},(e=>{p.value=Math.round(100*(n+e.loaded/e.total)/l)})).then((e=>{2e3===e.code?f=!0:(d.value[a].status=e.msg,f=!1)})).catch((e=>{H({message:e,grouping:!0,type:"warning"}),d.value[a].status=e,f=!1})),!f)break;if(n++,n==l){X.value++,d.value[a].status="success";break}}}if(a==l.length-1&&(n.value=!1,r.value="",j.value=!0,X.value==l.length)){const l=(new Date-e)/1e3;P.value=l.toFixed(2),U.value=Y(P.value)}yield Q(30)}n.value=!1}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0;let a=c(e);u.value=a.path,B((()=>{h.value=document.querySelector(".el-upload__input")}))}}),(e,l)=>{const a=_("el-alert"),t=_("el-button"),i=_("upload-filled"),u=_("el-icon"),c=_("el-text"),v=_("el-progress"),b=_("el-upload"),h=_("el-table-column"),g=_("el-table");return w(),y("div",le,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[4]||(l[4]=e=>O(o)?o.value=e:o=e),title:C(s),width:"60%","before-close":q},{footer:x((()=>[k(t,{onClick:q,loading:C(n)},{default:x((()=>l[8]||(l[8]=[R("\u5173\u95ed")]))),_:1},8,["loading"]),C(j)?D("",!0):(w(),V(t,{key:0,type:"primary",onClick:Z,loading:C(n),disabled:C(d).length<1},{default:x((()=>l[9]||(l[9]=[R("\u786e\u8ba4\u4e0a\u4f20")]))),_:1},8,["loading","disabled"]))])),default:x((()=>[C(j)?(w(),V(a,{key:0,style:{"margin-bottom":"10px"},title:"\u4e0a\u4f20\u6210\u529f"+C(X)+"\u4e2a\uff0c\u8017\u65f6"+C(P)+"\u79d2\uff0c\u5e73\u5747\u901f\u5ea6"+C(U),type:"success",onClick:M},null,8,["title"])):D("",!0),C(j)?D("",!0):(w(),y("div",ae,[S("div",null,[k(t,{type:"primary",onClick:l[0]||(l[0]=e=>z("file"))},{default:x((()=>l[5]||(l[5]=[R("\u4e0a\u4f20\u6587\u4ef6")]))),_:1})]),S("div",null,[k(t,{onClick:T},{default:x((()=>l[6]||(l[6]=[R("\u6e05\u7a7a\u5217\u8868")]))),_:1})])])),S("div",null,[S("div",{class:"el-upload-dragger",onDragover:$,onDrop:L,onDragleave:E},[S("div",te,[S("div",{onClick:l[1]||(l[1]=e=>z("file"))},[k(u,{class:"el-icon--upload"},{default:x((()=>[k(i)])),_:1}),l[7]||(l[7]=S("div",{class:"el-upload__text"}," \u8bf7\u62d6\u62fd\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u5230\u6b64\u5904\uff08\u4ec5\u652f\u6301.sql\u3001.zip\u3001.tar.gz\uff09 ",-1))])])],32)]),k(b,{ref_key:"lyUploadRef",ref:f,accept:".sql,.zip,.tar.gz","show-file-list":!1,multiple:"","file-list":C(d),"onUpdate:fileList":l[2]||(l[2]=e=>O(d)?d.value=e:d=e),action:"#","auto-upload":!1,"on-change":J,"on-exceed":G,"on-success":N},{tip:x((()=>[k(c,null,{default:x((()=>[R(F(C(r)),1)])),_:1}),C(n)?(w(),V(v,{key:0,"text-inside":"","stroke-width":20,percentage:C(p)},null,8,["percentage"])):D("",!0)])),_:1},8,["file-list"]),k(g,{ref_key:"tableContainer",ref:I,data:C(d),"table-layout":"auto","max-height":"300px","scrollbar-always-on":!0},{default:x((()=>[k(h,{prop:"name","min-width":"200",label:"\u6587\u4ef6\u540d","show-overflow-tooltip":""},{default:x((e=>[""!=e.row.raw.webkitRelativePath?(w(),y("span",oe,F(e.row.raw.webkitRelativePath),1)):(w(),y("span",ne,F(e.row.name),1))])),_:1}),k(h,{prop:"size","min-width":"100",label:"\u5927\u5c0f","show-overflow-tooltip":""},{default:x((e=>[R(F(C(m)(e.row.size)),1)])),_:1}),k(h,{prop:"status","min-width":"90",label:"\u72b6\u6001","show-overflow-tooltip":""},{default:x((e=>["ready"==e.row.status?(w(),y("span",ie,"\u7b49\u5f85\u4e0a\u4f20")):"success"==e.row.status?(w(),y("span",se,"\u4e0a\u4f20\u6210\u529f")):(w(),y("span",ue,F(e.row.status),1))])),_:1}),k(h,{width:"45",fixed:"right"},{default:x((a=>["success"==a.row.status||C(n)?D("",!0):(w(),y("span",de,[k(t,{type:"primary",link:"",onClick:l[3]||(l[3]=l=>{return a=e.index,void d.value.splice(a,1);var a}),icon:"Close"})]))])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-b642ba8c"]]),pe={class:"lyBackupDialog"},ce={key:3},me=s({__name:"moduleImport",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1);g(!1);let s=g("\u6570\u636e\u5e93\u5907\u4efd"),u=g(!1),r=g(!1),v=g(""),b=g({fid:"",type:1,page:1,limit:10}),h=g({page:1,limit:10,total:0}),I=g([]),j=g({});function S(){t("closed"),t("refreshData")}function q(e){b.value.page=e.page,b.value.limit=e.limit,M()}function M(){u.value=!0;let e=n({},b.value);e.fid="",d.sysBakBackUpList(e).then((e=>{u.value=!1,2e3==e.code?(I.value=e.data.data,h.value.page=e.data.page,h.value.limit=e.data.limit,h.value.total=e.data.total):p(e.msg)}))}let z=g([]),T=g([]);function K(e){T.value=c(e),z.value=e.map((e=>e.id))}let J=g(null);function G(){B((()=>{J.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let N=g(0),X=g("0%"),Q=g(!1),W=g(1),Y=g("");function Z(e){return new Promise((l=>setTimeout(l,e)))}function ee(){return i(this,null,(function*(){W.value=2,Q.value=!0,T.value.forEach((e=>{e.status="wait"}));let e=T.value.length,l=0;for(let a=0;a<e;a++){N.value=a+1==e?100:parseInt((a+1)/e*100),X.value=N.value+"%";let t="del_backup_db",o={id:b.value.fid,bid:T.value[a].id,action:t};d.sysDatabasesDbtools(o).then((e=>{2e3==e.code?T.value[a].status="success":(T.value[a].status="error",l+=1)})),yield Z(1e3)}Q.value=!1,W.value=3,Y.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let le=g(null),ae=g(!1);function te(){ae.value=!0,B((()=>{le.value.handleOpen({path:"backup_datebase_path"},"\u4e0a\u4f20\u6587\u4ef6\u5230")}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0,b.value.fid=e.id,v.value=e.db_name,M()}}),(e,l)=>{const a=_("el-button"),t=_("el-form-item"),n=_("el-form"),i=_("el-table-column"),p=_("el-table"),c=_("el-tag"),g=P("loading");return w(),y("div",pe,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[0]||(l[0]=e=>O(o)?o.value=e:o=e),title:C(s),width:"60%","before-close":S,loading:C(r)},{default:x((()=>[k(n,{inline:!1,model:C(b),rules:C(j),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:C(r)},{default:x((()=>[k(t,null,{default:x((()=>[k(a,{type:"primary",onClick:te},{default:x((()=>l[2]||(l[2]=[R("\u70b9\u51fb\u4e0a\u4f20")]))),_:1}),k(a,{onClick:G,disabled:C(z).length<1},{default:x((()=>l[3]||(l[3]=[R("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),U((w(),V(p,{ref:"table",border:"",data:C(I),height:410,onSelectionChange:K},{default:x((()=>[k(i,{type:"selection",width:"55",align:"center"}),k(i,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),k(i,{prop:"size",label:"\u5927\u5c0f",width:"120"},{default:x((e=>[R(F(C(m)(e.row.size)),1)])),_:1}),k(i,{prop:"create_at",label:"\u65f6\u95f4",width:"170"}),k(i,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:x((e=>[k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${v.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{u.value=!0;let l={id:b.value.fid,bid:a.id,action:"recover_db_sql"};d.sysDatabasesDbtools(l).then((e=>{u.value=!1,2e3==e.code?(H.success(e.msg),M()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>l[4]||(l[4]=[R("\u5bfc\u5165")]))),_:2},1032,["onClick"]),k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void d.sysBakFileDownload({id:b.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);H.warning(e.msg)}}else f(e.data,a.name)}));var a}},{default:x((()=>l[5]||(l[5]=[R("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),k(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{u.value=!0;let l={id:b.value.fid,bid:a.id,action:"del_backup_db"};d.sysDatabasesDbtools(l).then((e=>{u.value=!1,2e3==e.code?(H.success(e.msg),M()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>l[6]||(l[6]=[R("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[g,C(u)]]),k($,{small:!0,"child-msg":C(h),onCallFather:q},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),k(L,{ref_key:"batchOpRef",ref:J,onClosed:M,tip2:C(Y),percentContent:C(X),percentage:C(N),loadingSave:C(Q),stepStatus:C(W)},{table:x((()=>[k(p,{data:C(T),border:"","max-height":500},{default:x((()=>[k(i,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),k(i,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:x((e=>["wait"==e.row.status?(w(),V(c,{key:0,type:"info"},{default:x((()=>l[7]||(l[7]=[R("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(w(),V(c,{key:1,type:"success"},{default:x((()=>l[8]||(l[8]=[R("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(w(),V(c,{key:2,type:"danger"},{default:x((()=>l[9]||(l[9]=[R("\u5220\u9664\u5931\u8d25")]))),_:1})):(w(),y("span",ce))])),_:1})])),_:1},8,["data"])])),footer:x((()=>[k(a,{type:"primary",onClick:ee,loading:C(Q)},{default:x((()=>l[10]||(l[10]=[R("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"]),C(ae)?(w(),V(re,{key:0,ref_key:"moduleUploadFlag",ref:le,onRefreshData:M,onClosed:l[1]||(l[1]=e=>O(ae)?ae.value=!1:ae=!1)},null,512)):D("",!0)])}}},[["__scopeId","data-v-8b70903f"]]),fe={class:"handle-top"},ve={class:"search-sites-input"},be={key:0},he={key:1,class:"lyflex"},ge={key:0,class:"pass-item",style:{"margin-right":"8px"}},_e={key:1,style:{"margin-right":"8px"}},ye={key:0},we={key:1},ke={key:2},xe={key:0},Ce={key:1},Ve={key:0},De={key:3},Re={key:6,class:"softmask"},Ie={key:7,class:"soft-ins-guide-dialog"},je=s({__name:"index",props:{installed:{type:Boolean,default:!1},status:{type:Boolean,default:!1}},setup(e,{expose:l}){const a=b();let t=q((()=>a.ismobile)),o=g(!1);const n=J();let s=g({search:"",db_type:0,page:1,limit:10}),u=g({page:1,limit:10,total:0}),r=g([]),p=g([]),c=g([]);function m(e){c.value=e,p.value=e.map((e=>e.id))}function f(e){s.value.page=e.page,s.value.limit=e.limit,v()}function v(){o.value=!0,d.sysDatabases(s.value).then((e=>{if(o.value=!1,2e3===e.code){let l=e.data.data;l.length>0&&l.forEach((e=>{e.showPassword=!1})),r.value=l,u.value.page=e.data.page,u.value.limit=e.data.limit,u.value.total=e.data.total}}))}function h(){s.value.page=1,v()}let I=g(!1),j=g(null);function z(){I.value=!0,B((()=>{j.value.handleOpen(null,"\u6dfb\u52a0\u6570\u636e\u5e93")}))}let T=g(!1),A=g(null);function G(){T.value=!0,B((()=>{A.value.handleOpen(null,"\u4fee\u6539root\u5bc6\u7801")}))}let Y=g(!1),Z=g(null);let le=g(!1),ae=g(null);let te=g(!1),oe=g(null);function ne(){n.push({path:"/appstore"})}let ie=g(0),se=g("0%"),ue=g(!1),de=g(1),re=g(""),pe=g(""),ce=g(""),je=g(null);function Se(e){ce.value=e;let l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93";"del"==e&&(pe.value="\u662f\u5426\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93"),"backup"==e&&(pe.value="\u662f\u5426\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93"),B((()=>{je.value.handleOpen(null,l)}))}function Oe(e){return new Promise((l=>setTimeout(l,e)))}function Pe(){return i(this,null,(function*(){de.value=2,ue.value=!0,c.value.forEach((e=>{e.status="wait","del"==ce.value?e.statusname="\u7b49\u5f85\u5220\u9664":"backup"==ce.value&&(e.statusname="\u7b49\u5f85\u5907\u4efd")}));let e=c.value.length,l=0;for(let t=0;t<e;t++){if(ie.value=t+1==e?100:parseInt((t+1)/e*100),se.value=ie.value+"%","del"==ce.value)d.sysDatabasesDelete({id:c.value[t].id}).then((e=>{2e3==e.code?(c.value[t].status="success","del"==ce.value?c.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u6210\u529f")):(c.value[t].status="error",l+=1,"del"==ce.value?c.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}));else if("backup"==ce.value){let e={id:c.value[t].id,action:"backup_db"};d.sysDatabasesDbtools(e).then((e=>{2e3==e.code?(c.value[t].status="success","del"==ce.value?c.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u6210\u529f")):(c.value[t].status="error",l+=1,"del"==ce.value?c.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}))}yield Oe(1e3)}ue.value=!1,de.value=3;let a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210";"del"==ce.value?a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210":"backup"==ce.value&&(a="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\u5df2\u5b8c\u6210"),re.value=`${a}\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let Ue=g(!1),Fe=g(null);return l({RefreshData:function(){B((()=>{v()}))}}),(l,a)=>{const n=_("el-button"),i=_("arrow-down"),b=_("el-icon"),g=_("el-dropdown-item"),q=_("el-dropdown-menu"),J=_("el-dropdown"),ce=_("el-col"),Oe=_("el-input"),Be=_("el-row"),qe=_("el-table-column"),Me=_("el-text"),ze=_("el-divider"),Te=_("el-table"),$e=_("el-tag"),Ae=_("InfoFilled"),Le=P("loading");return w(),y("div",null,[S("div",fe,[k(Be,null,{default:x((()=>[k(ce,{xs:24,sm:16,md:16,lg:16,xl:16},{default:x((()=>[k(n,{type:"primary",onClick:z,disabled:!e.status},{default:x((()=>a[12]||(a[12]=[R("\u6dfb\u52a0\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),k(n,{onClick:G,disabled:!e.status},{default:x((()=>a[13]||(a[13]=[R("root\u5bc6\u7801")]))),_:1},8,["disabled"]),k(n,{icon:"refresh",circle:"",onClick:h}),k(J,{disabled:C(p).length<1},{dropdown:x((()=>[k(q,null,{default:x((()=>[k(g,{onClick:a[0]||(a[0]=e=>Se("del"))},{default:x((()=>a[15]||(a[15]=[R("\u5220\u9664\u6570\u636e\u5e93")]))),_:1}),k(g,{onClick:a[1]||(a[1]=e=>Se("backup"))},{default:x((()=>a[16]||(a[16]=[R("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1})])),_:1})])),default:x((()=>[k(n,{plain:"",disabled:C(p).length<1},{default:x((()=>[a[14]||(a[14]=R(" \u6279\u91cf\u64cd\u4f5c")),k(b,{class:"el-icon--right"},{default:x((()=>[k(i)])),_:1})])),_:1},8,["disabled"])])),_:1},8,["disabled"])])),_:1}),k(ce,{xs:24,sm:8,md:8,lg:8,xl:8},{default:x((()=>[S("div",ve,[k(Oe,{modelValue:C(s).search,"onUpdate:modelValue":a[2]||(a[2]=e=>C(s).search=e),clearable:"",onClear:a[3]||(a[3]=e=>h()),"suffix-icon":"Search",onKeyup:a[4]||(a[4]=M((e=>h()),["enter"])),onChange:a[5]||(a[5]=e=>h()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),U((w(),V(Te,{data:C(r),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style",onSelectionChange:m},{default:x((()=>[k(qe,{type:"selection",width:"55",align:"center"}),k(qe,{prop:"db_name",label:"\u6570\u636e\u5e93\u540d","min-width":"150","show-overflow-tooltip":""}),k(qe,{prop:"db_user",label:"\u7528\u6237\u540d","min-width":"100","show-overflow-tooltip":""}),k(qe,{prop:"db_pass",label:"\u5bc6\u7801","min-width":"150"},{default:x((e=>[""===e.row.db_user?(w(),y("span",be,"-")):D("",!0),e.row.db_pass&&e.row.db_user?(w(),y("div",he,[e.row.showPassword?D("",!0):(w(),y("div",ge,a[17]||(a[17]=[S("span",null,"*********",-1)]))),e.row.showPassword?(w(),y("span",_e,F(e.row.db_pass),1)):D("",!0),e.row.showPassword?D("",!0):(w(),V(n,{key:2,link:"",onClick:l=>e.row.showPassword=!0,icon:"View",style:{"margin-right":"5px"}},null,8,["onClick"])),e.row.showPassword?(w(),V(n,{key:3,link:"",onClick:l=>e.row.showPassword=!1,icon:"Hide"},null,8,["onClick"])):D("",!0),S("div",null,[k(K,{content:e.row.db_pass,type:"icon"},null,8,["content"])])])):D("",!0)])),_:1}),k(qe,{prop:"remark",label:"\u8bbf\u95ee\u6743\u9650",width:"130"},{default:x((e=>["ip"==e.row.accept?(w(),y("span",ye,"\u6307\u5b9aIP")):"localhost"==e.row.accept?(w(),y("span",we,"\u672c\u5730\u670d\u52a1\u5668")):(w(),y("span",ke,"\u6240\u6709\u4eba"))])),_:1}),k(qe,{prop:"remark",label:"\u4f4d\u7f6e",width:"130"},{default:x((e=>["127.0.0.1"==e.row.db_host||"locahost"==e.row.db_host?(w(),y("span",xe,"\u672c\u5730")):(w(),y("span",Ce,F("\u8fdc\u7a0b["+e.row.db_host+"]"),1))])),_:1}),k(qe,{prop:"remark",label:"\u5907\u6ce8","min-width":"130","show-overflow-tooltip":""}),k(qe,{prop:"remark",label:"\u5907\u4efd | \u5bfc\u5165","min-width":"130"},{default:x((e=>[k(Me,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,te.value=!0,void B((()=>{oe.value.handleOpen(a,"\u3010"+a.db_name+"\u3011\u6570\u636e\u5e93\u5907\u4efd")}));var a}},{default:x((()=>[a[18]||(a[18]=R("\u5907\u4efd")),e.row.bak_nums>0?(w(),y("span",Ve,F("("+e.row.bak_nums+")"),1)):D("",!0)])),_:2},1032,["onClick"]),k(ze,{direction:"vertical"}),k(Me,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,Ue.value=!0,void B((()=>{Fe.value.handleOpen(a,"\u5bfc\u5165\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5b57\u7b26\u96c6\uff1a"+a.format)}));var a}},{default:x((()=>a[19]||(a[19]=[R("\u5bfc\u5165")]))),_:2},1032,["onClick"])])),_:1}),k(qe,{fixed:!C(t)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:x((e=>[k(n,{link:"",type:"primary",onClick:l=>{return a=e.row,le.value=!0,void B((()=>{ae.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u6743\u9650")}));var a}},{default:x((()=>a[20]||(a[20]=[R("\u6743\u9650")]))),_:2},1032,["onClick"]),k(n,{link:"",type:"primary",onClick:l=>{return a=e.row,Y.value=!0,void B((()=>{Z.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5bc6\u7801")}));var a}},{default:x((()=>a[21]||(a[21]=[R("\u6539\u5bc6")]))),_:2},1032,["onClick"]),k(n,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm("\u3010\u5f7b\u5e95\u5220\u9664\u3011\u6570\u636e\u5e93\u540e\uff0c\u8be5\u6570\u636e\u5e93\u5185\u7684\u6240\u6709\u6570\u636e\u5c06\u88ab\u5220\u9664\uff0c\u4e14\u4e0d\u53ef\u6062\u590d\uff01\uff01\uff01","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{o.value=!0,d.sysDatabasesDelete({id:a.id}).then((e=>{o.value=!1,2e3==e.code?(H.success(e.msg),v()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>a[22]||(a[22]=[R("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[Le,C(o)]]),k($,{small:!0,"child-msg":C(u),onCallFather:f,border:!1,position:"right"},null,8,["child-msg"]),C(I)?(w(),V(N,{key:0,ref_key:"moduleAddFlag",ref:j,onRefreshData:v,onClosed:a[6]||(a[6]=e=>O(I)?I.value=!1:I=!1)},null,512)):D("",!0),C(T)?(w(),V(X,{key:1,ref_key:"modulePassFlag",ref:A,onClosed:a[7]||(a[7]=e=>O(T)?T.value=!1:T=!1)},null,512)):D("",!0),C(Y)?(w(),V(Q,{key:2,ref_key:"moduleResetUserPassFlag",ref:Z,onRefreshData:v,onClosed:a[8]||(a[8]=e=>O(Y)?Y.value=!1:Y=!1)},null,512)):D("",!0),C(le)?(w(),V(W,{key:3,ref_key:"moduleAcceptFlag",ref:ae,onRefreshData:v,onClosed:a[9]||(a[9]=e=>O(le)?le.value=!1:le=!1)},null,512)):D("",!0),C(te)?(w(),V(ee,{key:4,ref_key:"moduleBackupFlag",ref:oe,onRefreshData:v,onClosed:a[10]||(a[10]=e=>O(te)?te.value=!1:te=!1)},null,512)):D("",!0),C(Ue)?(w(),V(me,{key:5,ref_key:"moduleImportFlag",ref:Fe,onRefreshData:v,onClosed:a[11]||(a[11]=e=>O(Ue)?Ue.value=!1:Ue=!1)},null,512)):D("",!0),k(L,{ref_key:"batchOpRef",ref:je,width:"680px",onClosed:v,tip1:C(pe),tip2:C(re),percentContent:C(se),percentage:C(ie),loadingSave:C(ue),stepStatus:C(de)},{table:x((()=>[k(Te,{data:C(c),border:"","max-height":500},{default:x((()=>[k(qe,{prop:"db_name",label:"\u6570\u636e\u5e93","min-width":"280","show-overflow-tooltip":""}),k(qe,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:x((e=>["wait"==e.row.status?(w(),V($e,{key:0,type:"info"},{default:x((()=>[R(F(e.row.statusname),1)])),_:2},1024)):"success"==e.row.status?(w(),V($e,{key:1,type:"success"},{default:x((()=>[R(F(e.row.statusname),1)])),_:2},1024)):"error"==e.row.status?(w(),V($e,{key:2,type:"danger"},{default:x((()=>[R(F(e.row.statusname),1)])),_:2},1024)):(w(),y("span",De))])),_:1})])),_:1},8,["data"])])),footer:x((()=>[k(n,{type:"primary",onClick:Pe,loading:C(ue)},{default:x((()=>a[23]||(a[23]=[R("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip1","tip2","percentContent","percentage","loadingSave","stepStatus"]),e.installed?D("",!0):(w(),y("div",Re)),e.installed?D("",!0):(w(),y("div",Ie,[k(b,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:x((()=>[k(Ae)])),_:1}),a[25]||(a[25]=R(" \u5f53\u524d\u672a\u5b89\u88c5Mysql\u73af\u5883 ")),k(n,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:ne},{default:x((()=>a[24]||(a[24]=[R("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})]))])}}},[["__scopeId","data-v-b4e48f00"]]),Se=s({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=g(!1),n=g(!1),i=g("\u6dfb\u52a0Key"),s=g({id:"",db:0,key:"",value:"",exptime:0}),u=g([]),m=g({db:[{required:!0,message:"\u8bf7\u9009\u62e9\u6570\u636e\u5e93",trigger:"blur"}],key:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u540d",trigger:"blur"}],value:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u503c",trigger:"blur"}]});function f(){t("closed")}let v=g(null);function b(){v.value.validate((e=>{e&&(n.value=!0,s.value.action="redis_set_val",d.sysSoftinfoMg(s.value).then((e=>{n.value=!1,2e3==e.code?(r(e.msg),f(),t("refreshData")):p(e.msg)})))}))}return l({handleOpen:function(e,l,a){i.value=l,o.value=!0,u.value=a,e&&(s.value=c(e))}}),(e,l)=>{const a=_("el-option"),t=_("el-select"),d=_("el-form-item"),r=_("el-input"),p=_("el-input-number"),c=_("el-alert"),h=_("el-form"),g=_("el-button");return w(),y("div",null,[k(A,{modelValue:C(o),"onUpdate:modelValue":l[4]||(l[4]=e=>O(o)?o.value=e:o=e),title:C(i),width:"680px","before-close":f},{footer:x((()=>[k(g,{onClick:f,loading:C(n)},{default:x((()=>l[6]||(l[6]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(g,{type:"primary",onClick:b,loading:C(n)},{default:x((()=>l[7]||(l[7]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(h,{inline:!1,model:C(s),rules:C(m),ref_key:"rulesForm",ref:v,"label-position":"right","label-width":"auto"},{default:x((()=>[k(d,{label:"\u6570\u636e\u5e93\uff1a",prop:"db"},{default:x((()=>[k(t,{modelValue:C(s).db,"onUpdate:modelValue":l[0]||(l[0]=e=>C(s).db=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:x((()=>[(w(!0),y(I,null,j(C(u),(e=>(w(),V(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(d,{label:"\u952e(key)\uff1a",prop:"key"},{default:x((()=>[k(r,{modelValue:C(s).key,"onUpdate:modelValue":l[1]||(l[1]=e=>C(s).key=e),placeholder:"\u8bf7\u8f93\u5165\u952e\u540d",clearable:""},null,8,["modelValue"])])),_:1}),k(d,{prop:"value",label:"\u503c(value)\uff1a"},{default:x((()=>[k(r,{placeholder:"\u8bf7\u8f93\u5165\u952e\u503c",clearable:"",autosize:{minRows:3,maxRows:5},type:"textarea",modelValue:C(s).value,"onUpdate:modelValue":l[2]||(l[2]=e=>C(s).value=e)},null,8,["modelValue"])])),_:1}),k(d,{prop:"exptime",label:"\u6709\u6548\u671f(s)\uff1a"},{default:x((()=>[k(p,{modelValue:C(s).exptime,"onUpdate:modelValue":l[3]||(l[3]=e=>C(s).exptime=e),min:0,style:{width:"100%"},placeholder:"\u5355\u4f4d\u79d2\uff08s\uff09"},null,8,["modelValue"])])),_:1}),k(c,{type:"warning"},{default:x((()=>l[5]||(l[5]=[R("\u6709\u6548\u671f\uff1a0\u8868\u793a\u6c38\u4e45")]))),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-91eae30f"]]),Oe={class:"handle-top"},Pe={class:"search-sites-input"},Ue={key:1,class:"softmask"},Fe={key:2,class:"soft-ins-guide-dialog"},Be={class:"checkbox-container"},qe=s({__name:"index",props:{installed:{type:Boolean,default:!1},status:{type:Boolean,default:!1}},setup(e,{expose:l}){const a=b();let t=q((()=>a.ismobile));const o=J();let i=g(!1),s=g([]),u=g(0),r=g({search:"",page:1,limit:10,action:"get_redis_keylist",db:u}),p=g({page:1,limit:10,total:0}),c=g([]);function m(e){r.value.page=e.page,r.value.limit=e.limit,f()}function f(){i.value=!0,d.sysSoftinfoMg(r.value).then((e=>{i.value=!1,2e3===e.code?(c.value=e.data.list,p.value.page=e.data.page,p.value.limit=e.data.limit,p.value.total=e.data.total):H.warning(e.msg)}))}function v(){r.value.page=1,f()}function h(e){r.value.page=1,r.value.db=e.props.name,c.value=[],v(),G()}let z=g(!1),T=g(null);function L(){z.value=!0,B((()=>{T.value.handleOpen(null,"\u6dfb\u52a0Key",s.value)}))}function K(){o.push({path:"/appstore"})}function G(){d.sysSoftinfoMg({action:"get_redis_dblist"}).then((e=>{2e3==e.code&&(s.value=e.data)}))}let N=g(!1),X=g([]),Q=g(!1),W=g(!1),Y=g(!0);function Z(e){e?(X.value=[],s.value.forEach((e=>{X.value.push(e.id)}))):X.value=[],Y.value=!1}function ee(){N.value=!0,X.value=[]}function le(){N.value=!1,X.value=[],Y.value=!0}function ae(){E.confirm("\u662f\u5426\u6e05\u7a7a\u9009\u62e9\u7684\u6570\u636e\u5e93\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{W.value=!0,d.sysSoftinfoMg({action:"redis_flashdb",ids:X.value}).then((e=>{W.value=!1,2e3==e.code?(H.success(e.msg),oe(),le()):H.warning(e.msg)}))})).catch((()=>{}))}function te(e){const l=e.length;Q.value=l===s.value.length,Y.value=l>0&&l<s.value.length}function oe(){B((()=>{G(),f()}))}return l({RefreshData:oe}),(l,a)=>{const o=_("el-button"),f=_("el-col"),b=_("el-input"),g=_("el-row"),q=_("el-tab-pane"),J=_("el-tabs"),G=_("el-table-column"),ne=_("el-table"),ie=_("InfoFilled"),se=_("el-icon"),ue=_("el-checkbox"),de=_("el-checkbox-group"),re=P("loading");return w(),y("div",null,[S("div",Oe,[k(g,null,{default:x((()=>[k(f,{xs:24,sm:16,md:16,lg:16,xl:16},{default:x((()=>[k(o,{type:"primary",onClick:L,disabled:C(s).length<1},{default:x((()=>a[9]||(a[9]=[R("\u6dfb\u52a0Key")]))),_:1},8,["disabled"]),k(o,{icon:"delete",onClick:ee,disabled:!e.status},{default:x((()=>a[10]||(a[10]=[R("\u6e05\u7a7a\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),k(o,{icon:"refresh",onClick:oe})])),_:1}),k(f,{xs:24,sm:8,md:8,lg:8,xl:8},{default:x((()=>[S("div",Pe,[k(b,{modelValue:C(r).search,"onUpdate:modelValue":a[0]||(a[0]=e=>C(r).search=e),clearable:"",onClear:a[1]||(a[1]=e=>v()),"suffix-icon":"Search",onKeyup:a[2]||(a[2]=M((e=>v()),["enter"])),onChange:a[3]||(a[3]=e=>v()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),k(J,{modelValue:C(u),"onUpdate:modelValue":a[4]||(a[4]=e=>O(u)?u.value=e:u=e),onTabClick:h,type:"card"},{default:x((()=>[(w(!0),y(I,null,j(C(s),(e=>(w(),V(q,{key:e.id,label:e.name+"("+e.keynum+")",name:e.id},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),U((w(),V(ne,{data:C(c),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:x((()=>[k(G,{prop:"key",label:"\u952e(key)","min-width":"150","show-overflow-tooltip":""}),k(G,{prop:"value",label:"\u503c(value)","min-width":"180"}),k(G,{prop:"type",label:"\u6570\u636e\u7c7b\u578b","min-width":"109"}),k(G,{prop:"len",label:"\u6570\u636e\u957f\u5ea6","min-width":"120"}),k(G,{prop:"exptime",label:"\u6709\u6548\u671f(\u79d2)","min-width":"120"},{default:x((e=>[R(F(0==e.row.exptime?"\u6c38\u4e45":e.row.exptime),1)])),_:1}),k(G,{fixed:!C(t)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:x((e=>[k(o,{link:"",type:"primary",onClick:l=>function(e){let l=n({},e);l.db=r.value.db,z.value=!0,B((()=>{T.value.handleOpen(l,"\u7f16\u8f91Key",s.value)}))}(e.row)},{default:x((()=>a[11]||(a[11]=[R("\u7f16\u8f91")]))),_:2},1032,["onClick"]),k(o,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u662f\u5426\u5220\u9664\u3010${a.key}\u3011`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{i.value=!0,d.sysSoftinfoMg({action:"redis_del_val",db:u.value,key:a.key}).then((e=>{i.value=!1,2e3==e.code?(H.success(e.msg),oe()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:x((()=>a[12]||(a[12]=[R("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[re,C(i)]]),k($,{small:!0,"child-msg":C(p),onCallFather:m,border:!1,position:"right"},null,8,["child-msg"]),C(z)?(w(),V(Se,{key:0,ref_key:"moduleAddFlag",ref:T,onClosed:a[5]||(a[5]=e=>O(z)?z.value=!1:z=!1),onRefreshData:oe},null,512)):D("",!0),e.installed?D("",!0):(w(),y("div",Ue)),e.installed?D("",!0):(w(),y("div",Fe,[k(se,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:x((()=>[k(ie)])),_:1}),a[14]||(a[14]=R(" \u5f53\u524d\u672a\u5b89\u88c5Redis\u73af\u5883 ")),k(o,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:K},{default:x((()=>a[13]||(a[13]=[R("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})])),k(A,{modelValue:C(N),"onUpdate:modelValue":a[8]||(a[8]=e=>O(N)?N.value=e:N=e),top:"30vh",title:"\u6e05\u7a7a\u6570\u636e\u5e93",width:"560px","before-close":le,showFullScreen:!1},{footer:x((()=>[k(o,{onClick:le,loading:C(W)},{default:x((()=>a[16]||(a[16]=[R("\u53d6\u6d88")]))),_:1},8,["loading"]),k(o,{type:"primary",onClick:ae,loading:C(W)},{default:x((()=>a[17]||(a[17]=[R("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:x((()=>[k(ue,{modelValue:C(Q),"onUpdate:modelValue":a[6]||(a[6]=e=>O(Q)?Q.value=e:Q=e),indeterminate:C(Y),onChange:Z},{default:x((()=>a[15]||(a[15]=[S("span",{style:{"font-weight":"bold","font-size":"15px"}},"\u5168\u9009",-1),R("(\u4e3a\u7a7a\u6216\u5168\u9009\u8868\u793a\u6e05\u7a7a\u6240\u6709\u6570\u636e\u5e93) ")]))),_:1},8,["modelValue","indeterminate"]),S("div",Be,[k(de,{modelValue:C(X),"onUpdate:modelValue":a[7]||(a[7]=e=>O(X)?X.value=e:X=e),onChange:te},{default:x((()=>[(w(!0),y(I,null,j(C(s),(e=>(w(),V(ue,{key:e.id,label:e.name,value:e.id},{default:x((()=>[R(F(e.name),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-be7ab640"]]),Me={style:{"margin-bottom":"20px"},class:"lystatuscard"},ze={class:"lyflex"},Te={class:"lyflex"},$e={key:0,class:"lyflex"},Ae=s({__name:"index",setup(e){const l=h(),a=b();let t=q((()=>a.ismobile)),o=g("mysql");function n(e){let l=e.props.name;s.value.id="",s.value.installed=!1,s.value.version="",s.value.status=!1,u(l)}function i(){u(o.value)}let s=g({id:"",installed:!1,version:"",status:!1,name:""});function u(e="mysql"){l.loadingInfo.isLoading=!0,l.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",d.sysSoftinfoMg({name:e,action:"get_soft_info"}).then((a=>{l.loadingInfo.isLoading=!1,l.loadingInfo.content="",2e3==a.code?(s.value=a.data,s.value.installed&&("redis"!=e||s.value.status)&&function(e="mysql"){B((()=>{"mysql"==e?f.value.RefreshData():"redis"==e&&v.value.RefreshData()}))}(e)):H.warning(a.msg)}))}function r(e="stop"){let a="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",t=!1,o="\u542f\u52a8\u6210\u529f";"stop"==e?(l.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",t=!1,o="\u505c\u6b62\u6210\u529f"):"reload"==e?(l.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",a="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",t=!0,o="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==e&&(l.loadingInfo.content=s.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",a=s.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",t=!0,o=s.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),E.confirm(`${a}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((a=>{l.loadingInfo.isLoading=!0,d.sysSoftManage({id:s.value.id,status:e,action:"status"}).then((e=>{l.loadingInfo.isLoading=!1,l.loadingInfo.content="",2e3==e.code?(H.success(o),s.value.status=t):H.warning(e.msg)}))})).catch((()=>{}))}let p=g(!1),c=g(null);function m(){p.value=!0,B((()=>{c.value.handleOpen(s.value,"\u3010"+s.value.name+"("+s.value.version+")\u3011\u7ba1\u7406")}))}let f=g(null),v=g(null);return z((()=>{u(o.value)})),(e,l)=>{const a=_("el-tag"),u=_("el-button"),d=_("el-divider"),b=_("el-card"),h=_("el-tab-pane"),g=_("el-tabs"),I=_("el-main");return w(),V(I,{class:"ruyi-databases"},{default:x((()=>[k(b,{shadow:"never"},{default:x((()=>[k(g,{modelValue:C(o),"onUpdate:modelValue":l[3]||(l[3]=e=>O(o)?o.value=e:o=e),onTabClick:n},{default:x((()=>[S("div",Me,[k(b,{shadow:"hover",style:T({overflowX:C(t)?"auto":"none"})},{default:x((()=>[S("div",ze,[k(a,{style:{"margin-right":"20px"},effect:"dark",type:"success"},{default:x((()=>[R(F(C(o)),1)])),_:1}),k(a,{style:{"margin-right":"20px"},type:C(s).installed?"success":"info"},{default:x((()=>[R(F(C(s).installed?"\u5df2\u5b89\u88c5":"\u672a\u5b89\u88c5"),1)])),_:1},8,["type"]),k(a,{style:{"margin-right":"20px"}},{default:x((()=>[R("\u7248\u672c: "+F(C(s).version||"\u672a\u77e5"),1)])),_:1}),k(a,{style:{"margin-right":"20px"},type:C(s).status?"success":"danger"},{default:x((()=>[R("\u72b6\u6001: "+F(C(s).status?"\u5df2\u542f\u52a8":"\u672a\u542f\u52a8"),1)])),_:1},8,["type"]),S("div",Te,[k(u,{type:"primary",link:"",onClick:l[0]||(l[0]=e=>r("stop")),disabled:!C(s).installed},{default:x((()=>l[5]||(l[5]=[R("\u505c\u6b62")]))),_:1},8,["disabled"]),k(d,{direction:"vertical"}),k(u,{type:"primary",link:"",onClick:l[1]||(l[1]=e=>r("restart")),disabled:!C(s).installed},{default:x((()=>[R(F(C(s).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1},8,["disabled"])]),"mysql"==C(o)?(w(),y("div",$e,[k(d,{direction:"vertical"}),k(u,{type:"primary",link:"",onClick:l[2]||(l[2]=e=>r("reload")),disabled:!C(s).installed},{default:x((()=>l[6]||(l[6]=[R(F("\u91cd\u8f7d"))]))),_:1},8,["disabled"])])):D("",!0),k(d,{direction:"vertical"}),k(u,{type:"primary",link:"",onClick:m,disabled:!C(s).installed},{default:x((()=>l[7]||(l[7]=[R(F("\u8bbe\u7f6e"))]))),_:1},8,["disabled"])])])),_:1},8,["style"])]),k(h,{label:"MySql",name:"mysql"},{default:x((()=>["mysql"==C(o)?(w(),V(je,{key:0,installed:C(s).installed,status:C(s).status,ref_key:"mysqlRef",ref:f},null,8,["installed","status"])):D("",!0)])),_:1}),k(h,{label:"Redis",name:"redis"},{default:x((()=>["redis"==C(o)?(w(),V(qe,{key:0,installed:C(s).installed,status:C(s).status,ref_key:"redisRef",ref:v},null,8,["installed","status"])):D("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),C(p)?(w(),V(G,{key:0,ref_key:"softInfoFlag",ref:c,onClosed:l[4]||(l[4]=e=>O(p)?p.value=!1:p=!1),onRefreshStatus:i},null,512)):D("",!0)])),_:1})}}},[["__scopeId","data-v-d39c5422"]]);export{Ae as default};
