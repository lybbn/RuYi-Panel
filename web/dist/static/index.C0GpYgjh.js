import{T as e}from"./vue-codemirror.k2zwy4VA.js";import{H as a,I as l,J as t,K as s,L as o,M as n,N as u,O as r,P as i,Q as c,R as d,T as v,U as m,F as p,V as h,W as f,X as g,Y as y,Z as b,E as L,G as S,d as w,a as E,_ as x,m as O,h as B,r as V,k as j,z as D}from"./@codemirror.BTYdMWAS.js";import{_ as M}from"./index.9wSm1W-X.js";import{r as C,k as W,s as _,i as N,h as T,n as k,W as z,G as q,o as A,C as H,D as I,u as R}from"./@vue.CQt2tj-6.js";const F=M({__name:"index",props:{modelValue:{type:String,default:""},mode:{type:String,default:"javascript"},height:{type:[String,Number],default:"auto"},placeholder:{type:String,default:""},theme:{type:String,default:"dark"},readOnly:{type:Boolean,default:!1},bottom:{type:Boolean,default:!1},lineWrapping:{type:Boolean,default:!1},showLineNums:{type:Boolean,default:!0},fontSize:{type:String,default:"14px"}},emits:["update:modelValue","change","scrollBottomChange"],setup(M,{expose:F,emit:G}){const U=G,J=M;let K=C(null),P=W((()=>Number(J.height)?Number(J.height)+"px":J.height));const Q=W({get:()=>J.modelValue,set(e){U("change",e),U("update:modelValue",e)}});function X(e,a){if(null==e||null==e.state)return!1;if(!/^\d+$/.test(a)||+a<=0||+a>e.state.doc.lines)return!1;let l=e.state.doc.line(+a).from;return e.dispatch({selection:{anchor:l},userEvent:"select",scrollIntoView:!0}),!0}let Y=C(null);const Z=e=>{Y.value=e.view,Y.value.contentDOM.addEventListener("mousedown",(()=>{const e=()=>{if("log"==J.mode)return;const e=!Y.value.state.selection.main.empty;Y.value.dom.querySelectorAll(".cm-highlightSpace").forEach((a=>{e?a.classList.add("show-ryspace"):a.classList.remove("show-ryspace")}));Y.value.dom.querySelectorAll(".cm-highlightTab").forEach((a=>{e?a.classList.add("show-rytab"):a.classList.remove("show-rytab")}))},a=()=>{Y.value.contentDOM.removeEventListener("selectionchange",e),Y.value.contentDOM.removeEventListener("mouseup",a),e()};Y.value.contentDOM.addEventListener("selectionchange",e),Y.value.contentDOM.addEventListener("mouseup",a)}))},$=()=>Y.value?Y.value.state.doc.lines:0;C($());let ee=W((()=>{var e;const L={javascript:p,json:m,css:v,python:d,vue:c,php:i,java:r,go:u,yaml:n,xml:o,markdown:s,html:t,sql:l,shell:()=>a.define(b),ruby:()=>a.define(y),nginx:()=>a.define(g),lua:()=>a.define(f),properties:()=>a.define(h)};return(null==(e=L[J.mode])?void 0:e.call(L))||null})),ae=W((()=>L.readOnly.of(J.readOnly))),le=_([S,ae.value,w(),E(),x(),O(),B(),V(),j()]);function te(){const e=[S,ae.value,w(),E(),x(),O(),B(),V(),j()];ee.value&&null!==ee.value&&e.push(ee.value),J.lineWrapping&&e.push(D.lineWrapping),le.value=e}N(J,function(e,a=300){let l;return function(...t){clearTimeout(l),l=setTimeout((()=>{e.apply(this,t)}),a)}}(((e,a)=>{te()}),300),{deep:!0,flush:"post"});let se=C(null),oe=C(!1);function ne(e){requestAnimationFrame((()=>{const{scrollHeight:e,scrollTop:a,clientHeight:l}=se.value,t=Math.abs(e-a-l)<1;oe.value!==t&&(oe.value=t,U("scrollBottomChange",t))}))}return T((()=>{if(J.bottom&&Y.value&&k((()=>{X(Y.value,$())})),ee.value&&null!==ee.value&&!le.value.some((e=>e===ee.value))){le.value.push(ee.value);const e=[...le.value];le.value=[],le.value=e}J.lineWrapping&&le.value.push(D.lineWrapping),Y.value&&(se.value=Y.value.scrollDOM,se.value.addEventListener("scroll",ne))})),N((()=>Q.value),(e=>{J.bottom&&Y.value&&k((()=>{X(Y.value,$())}))})),z((()=>{se.value&&se.value.removeEventListener("scroll",ne),Y.value=null,se.value=null})),F({scrollToBottom:function(){Y.value&&X(Y.value,$())},reloadConfig:te,isScrollAtBottom:function(){return oe.value}}),(a,l)=>(A(),q(R(e),{ref_key:"lyCodemirrorRef",ref:K,class:I(["lyCodemirror",M.showLineNums?"":"lyCodemirrorDynamic"]),modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value=e),placeholder:M.placeholder,style:H({height:R(P),fontSize:M.fontSize}),autofocus:!0,"indent-with-tab":!0,"tab-size":4,extensions:R(le),onReady:Z},null,8,["class","modelValue","placeholder","style","extensions"]))}},[["__scopeId","data-v-6c0b4978"]]);export{F as l};
