import{_ as e,r as a,s as t}from"./index.9wSm1W-X.js";import{l as n}from"./index.C0GpYgjh.js";import{r as l,i as o,W as s,aq as u,I as i,G as r,o as c,t as d,u as p,n as m}from"./@vue.CQt2tj-6.js";const v=e({__name:"wslogs",props:{modelValue:String,mode:{type:String,default:"log"},height:{type:[String,Number],default:"350px"},fontSize:{type:String,default:"13px"},lineWrapping:{type:Boolean,default:!1},showLineNums:{type:Boolean,default:!1},placeholder:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["closed","update:modelValue","onerror","onsuccess"],setup(e,{expose:v,emit:f}){const g=f,h=e;let S=l(null),y=l(!1),w=l(null),$=l(h.modelValue),k=l(null),N=l(""),W=l("");function b(e){$.value=$.value+e,S.value&&S.value.scrollToBottom()}function V(){y.value=!0,N.value&&I(N.value,W.value),B()&&w.value.send(JSON.stringify({action:"heartBeat",timestamp:`${(new Date).getTime()}`}))}function x(e){const a=JSON.parse(e.data);switch(a.action){case"output":b(a.data+"\n");break;case"error":b(a.data+"\n"),g("onerror");break;case"success":b(a.data+"\n"),g("onsuccess");break}}function O(e){k.value&&clearInterval(k.value),b(e.reason+"\n"),g("closed")}function _(e){let a=e.message;a||(a="WS\u8fde\u63a5\u4e2d\u65ad"),b(`${a}`)}function B(){return 1===(!!w.value&&w.value.readyState)}function I(e={},a=""){B()&&w.value.send(JSON.stringify({action:a,data:e}))}function T(e=!0){k.value&&clearInterval(k.value);try{w.value&&w.value.close()}catch(a){}if(e)try{$.value=""}catch(a){}}o($,(e=>{g("update:modelValue",e)})),o((()=>h.modelValue),(e=>{$.value=e}));const z=o((()=>y.value),(e=>{e&&z()}));return v({init:function(e="",n="",l="",o=""){m((()=>{N.value=n||"",W.value=l||"",function(e,n){n&&""!=n||(n=`t=${(new Date).getTime()}`);const l=btoa(a());if(-1!=e.indexOf("://"))w.value=new WebSocket(`${e}?token=${l}&${n}`);else{const a="http:"===window.location.href.split("//")[0]?"ws":"wss",o=t.API_HOST,s=e.replace(/^\/+/,"");w.value=new WebSocket(`${a}://${o}/${s}?token=${l}&${n}`)}w.value.onopen=V,w.value.onmessage=x,w.value.onclose=O,w.value.onerror=_,k.value=setInterval((()=>{if(B()){let e=(new Date).getTime();w.value.send(JSON.stringify({action:"heartBeat",timestamp:`${e}`}))}}),3e4)}(e,o)}))},isWebSocketOpen:B,sendMsg:I,onClose:T}),s((()=>{T()})),(a,t)=>{const l=u("loading");return i((c(),r(n,{modelValue:p($),"onUpdate:modelValue":t[0]||(t[0]=e=>d($)?$.value=e:$=e),fontSize:e.fontSize,placeholder:e.placeholder,showLineNums:e.showLineNums,lineWrapping:e.lineWrapping,mode:e.mode,height:e.height,"read-only":!0,ref_key:"lyCodemirror",ref:S},null,8,["modelValue","fontSize","placeholder","showLineNums","lineWrapping","mode","height"])),[[l,e.loading]])}}},[["__scopeId","data-v-f2ac6694"]]);export{v as l};
