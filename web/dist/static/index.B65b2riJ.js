var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,n)=>{for(var i in n||(n={}))a.call(n,i)&&o(e,i,n[i]);if(l)for(var i of l(n))t.call(n,i)&&o(e,i,n[i]);return e},i=(e,l,a)=>new Promise(((t,o)=>{var n=e=>{try{s(a.next(e))}catch(l){o(l)}},i=e=>{try{s(a.throw(e))}catch(l){o(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);s((a=a.apply(e,l)).next())}));import{l as s,A as u,j as d,M as r,i as p,e as c,k as m,n as f,u as v,c as b}from"./index.DdU3pFbI.js";import{b as h,ag as g,o as _,c as y,P as w,H as k,u as x,L as C,O as V,a4 as D,G as R,a as I,K as j,t as S,aq as O,I as P,M as U,n as F,k as B,a5 as q,j as M,D as z}from"./@vue.BluSRtaz.js";import{P as T}from"./Pagination.DhOoI1te.js";import{L as $}from"./dialog.BvK2-1BY.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{b as L}from"./batchOp.Jf61eufF.js";import{E,a as K}from"./element-plus.CMBwCou9.js";import{_ as H}from"./index.BtSuCC0u.js";import{b as G}from"./vue-router.CjawWhbh.js";import{s as J}from"./softInfo.CiCEVXig.js";import"./axios.3Xbkft1r.js";import"./crypto-js.CCePG2on.js";import"./@xterm.8vZnc5Va.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.CjTOZN0C.js";import"./clipboard.55ERAcYO.js";import"./pinia.DhJalR8o.js";import"./@element-plus.sBVz1STF.js";import"./nprogress.B5M_jmCc.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.BccSst5e.js";import"./@vueuse.l0Dx-5Bl.js";import"./@popperjs.CpAfbxx4.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.9DdhAVak.js";import"./async-validator.Cuo4gI4y.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.CUoAWVRo.js";import"./@floating-ui.yzr8CaSr.js";const N=A({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),i=h(!1),p=h("\u6dfb\u52a0\u7f51\u7ad9"),c=h({format:"utf8mb4",db_name:"",remark:"",db_user:"",db_pass:"",accept:"localhost",accept_ips:"",db_type:0,db_host:"127.0.0.1"}),m=h([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),f=h([{id:"127.0.0.1",name:"\u672c\u5730\u670d\u52a1\u5668"}]),v=h([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),b=h({db_name:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u5e93\u540d",trigger:"blur"}],db_user:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",trigger:"blur"}],db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}],accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650",trigger:"blur"}]});function O(){t("closed")}function P(){c.value.db_pass=s(16)}let U=h(null);function F(){U.value.validate((e=>{if(e){i.value=!0;let e=n({},c.value);"ip"!=e.accept&&(e.accept_ips=""),u.sysDatabasesAdd(e).then((e=>{i.value=!1,2e3==e.code?(d(e.msg),O(),t("refreshData")):r(e.msg)}))}}))}return l({handleOpen:function(e,l){p.value=l,o.value=!0,P()}}),(e,l)=>{const a=g("el-option"),t=g("el-select"),n=g("el-input"),s=g("el-form-item"),u=g("el-button"),d=g("el-form");return _(),y("div",null,[w($,{modelValue:x(o),"onUpdate:modelValue":l[9]||(l[9]=e=>S(o)?o.value=e:o=e),title:x(p),width:"680px","before-close":O},{footer:k((()=>[w(u,{onClick:O,loading:x(i)},{default:k((()=>l[12]||(l[12]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(u,{type:"primary",onClick:F,loading:x(i)},{default:k((()=>l[13]||(l[13]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(d,{inline:!1,model:x(c),rules:x(b),ref_key:"rulesForm",ref:U,"label-position":"right","label-width":"auto"},{default:k((()=>[w(s,{label:"\u6570\u636e\u5e93\u540d\uff1a",prop:"db_name"},{default:k((()=>[w(n,{clearable:"",placeholder:"\u6570\u636e\u5e93\u540d",modelValue:x(c).db_name,"onUpdate:modelValue":l[1]||(l[1]=e=>x(c).db_name=e),modelModifiers:{trim:!0},onInput:l[2]||(l[2]=e=>x(c).db_user=x(c).db_name)},{append:k((()=>[w(t,{modelValue:x(c).format,"onUpdate:modelValue":l[0]||(l[0]=e=>x(c).format=e),style:{width:"140px"}},{default:k((()=>[w(a,{label:"utf8mb4",value:"utf8mb4"}),w(a,{label:"utf-8",value:"utf8"}),w(a,{label:"gbk",value:"gbk"}),w(a,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:k((()=>[w(n,{modelValue:x(c).db_user,"onUpdate:modelValue":l[3]||(l[3]=e=>x(c).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:""},null,8,["modelValue"])])),_:1}),w(s,{label:"\u5bc6\u7801\uff1a",prop:"db_pass"},{default:k((()=>[w(n,{placeholder:"\u5bc6\u7801",modelValue:x(c).db_pass,"onUpdate:modelValue":l[4]||(l[4]=e=>x(c).db_pass=e),modelModifiers:{trim:!0}},{append:k((()=>[w(u,{onClick:P},{default:k((()=>l[10]||(l[10]=[C("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:k((()=>[w(t,{modelValue:x(c).accept,"onUpdate:modelValue":l[5]||(l[5]=e=>x(c).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},clearable:"",filterable:""},{default:k((()=>[(_(!0),y(V,null,D(x(m),(e=>(_(),R(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===x(c).accept?(_(),R(s,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===x(c).accept?x(v):[]},{default:k((()=>[w(n,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:x(c).accept_ips,"onUpdate:modelValue":l[6]||(l[6]=e=>x(c).accept_ips=e)},null,8,["modelValue"]),l[11]||(l[11]=I("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):j("",!0),w(s,{label:"\u5907\u6ce8\uff1a",prop:"remark"},{default:k((()=>[w(n,{modelValue:x(c).remark,"onUpdate:modelValue":l[7]||(l[7]=e=>x(c).remark=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"\u5907\u6ce8\u4fe1\u606f",clearable:""},null,8,["modelValue"])])),_:1}),w(s,{label:"\u6dfb\u52a0\u5230\uff1a",prop:"db_host"},{default:k((()=>[w(t,{modelValue:x(c).db_host,"onUpdate:modelValue":l[8]||(l[8]=e=>x(c).db_host=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:k((()=>[(_(!0),y(V,null,D(x(f),(e=>(_(),R(a,{key:e.id,label:e.name+"("+e.id+")",value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-dca61120"]]),X=A({__name:"modulePass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),n=h(!1),i=h("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),p=h(!1),c=h({name:"mysql",action:"set_db_pass",passwd:""}),m=h({passwd:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function f(){t("closed")}function v(){c.value.passwd=s(16)}let b=h(null);function V(){b.value.validate((e=>{e&&(n.value=!0,u.sysDatabasesPass(c.value).then((e=>{n.value=!1,2e3==e.code?(d(e.msg),f(),t("refreshData")):r(e.msg)})))}))}return l({handleOpen:function(e,l){i.value=l,o.value=!0,p.value=!0,u.sysDatabasesPass({action:"get_db_pass",name:"mysql"}).then((e=>{p.value=!1,2e3==e.code?c.value.passwd=e.data:r(e.msg)}))}}),(e,l)=>{const a=g("el-button"),t=g("el-input"),s=g("el-form-item"),u=g("el-form"),d=O("loading");return P((_(),y("div",null,[w($,{modelValue:x(o),"onUpdate:modelValue":l[1]||(l[1]=e=>S(o)?o.value=e:o=e),title:x(i),width:"580px","before-close":f,showFullScreen:!1},{footer:k((()=>[w(a,{onClick:f,loading:x(n)},{default:k((()=>l[3]||(l[3]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(a,{type:"primary",onClick:V,loading:x(n)},{default:k((()=>l[4]||(l[4]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(u,{inline:!1,model:x(c),rules:x(m),ref_key:"rulesForm",ref:b,"label-position":"right","label-width":"auto"},{default:k((()=>[w(s,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"passwd"},{default:k((()=>[w(t,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:x(c).passwd,"onUpdate:modelValue":l[0]||(l[0]=e=>x(c).passwd=e),modelModifiers:{trim:!0}},{append:k((()=>[w(a,{onClick:v},{default:k((()=>l[2]||(l[2]=[C("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[d,x(p)]])}}},[["__scopeId","data-v-6e19df75"]]),Q=A({__name:"moduleResetUserPass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),n=h(!1),i=h("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),c=h(!1),m=h({id:"",name:"mysql",action:"set_db_user_pass",db_pass:"",db_user:""}),f=h({db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function v(){t("closed")}function b(){m.value.db_pass=s(16)}let V=h(null);function D(){V.value.validate((e=>{e&&(n.value=!0,u.sysDatabasesPass(m.value).then((e=>{n.value=!1,2e3==e.code?(d(e.msg),v(),t("refreshData")):r(e.msg)})))}))}return l({handleOpen:function(e,l){if(i.value=l,o.value=!0,e){let l=p(e);m.value.id=l.id,m.value.db_user=l.db_user,m.value.db_pass=l.db_pass}}}),(e,l)=>{const a=g("el-input"),t=g("el-form-item"),s=g("el-button"),u=g("el-form"),d=O("loading");return P((_(),y("div",null,[w($,{modelValue:x(o),"onUpdate:modelValue":l[2]||(l[2]=e=>S(o)?o.value=e:o=e),title:x(i),width:"580px","before-close":v,showFullScreen:!1},{footer:k((()=>[w(s,{onClick:v,loading:x(n)},{default:k((()=>l[4]||(l[4]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(s,{type:"primary",onClick:D,loading:x(n)},{default:k((()=>l[5]||(l[5]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(u,{inline:!1,model:x(m),rules:x(f),ref_key:"rulesForm",ref:V,"label-position":"right","label-width":"auto"},{default:k((()=>[w(t,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:k((()=>[w(a,{modelValue:x(m).db_user,"onUpdate:modelValue":l[0]||(l[0]=e=>x(m).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:"",disabled:!0},null,8,["modelValue"])])),_:1}),w(t,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"db_pass"},{default:k((()=>[w(a,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:x(m).db_pass,"onUpdate:modelValue":l[1]||(l[1]=e=>x(m).db_pass=e),modelModifiers:{trim:!0}},{append:k((()=>[w(s,{onClick:b},{default:k((()=>l[3]||(l[3]=[C("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[d,x(c)]])}}},[["__scopeId","data-v-a614f0ce"]]),W=A({__name:"moduleAccept",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),n=h(!1),i=h("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),s=h(!1),c=h({id:"",name:"mysql",action:"set_db_accept",accept:"localhost",accept_ips:""}),m=h([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),f=h([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),v=h({accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u8bbf\u95ee\u6743\u9650",trigger:"blur"}]});function b(){t("closed")}let U=h(null);function F(){U.value.validate((e=>{e&&(n.value=!0,u.sysDatabasesPass(c.value).then((e=>{n.value=!1,2e3==e.code?(d(e.msg),b(),t("refreshData")):r(e.msg)})))}))}return l({handleOpen:function(e,l){if(i.value=l,o.value=!0,e){let l=p(e);c.value.id=l.id,c.value.accept=l.accept,c.value.accept_ips=l.accept_ips}}}),(e,l)=>{const a=g("el-option"),t=g("el-select"),u=g("el-form-item"),d=g("el-input"),r=g("el-form"),p=g("el-button"),h=O("loading");return P((_(),y("div",null,[w($,{modelValue:x(o),"onUpdate:modelValue":l[2]||(l[2]=e=>S(o)?o.value=e:o=e),title:x(i),width:"580px","before-close":b,showFullScreen:!1},{footer:k((()=>[w(p,{onClick:b,loading:x(n)},{default:k((()=>l[4]||(l[4]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(p,{type:"primary",onClick:F,loading:x(n)},{default:k((()=>l[5]||(l[5]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(r,{inline:!1,model:x(c),rules:x(v),ref_key:"rulesForm",ref:U,"label-position":"right","label-width":"auto"},{default:k((()=>[w(u,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:k((()=>[w(t,{modelValue:x(c).accept,"onUpdate:modelValue":l[0]||(l[0]=e=>x(c).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:k((()=>[(_(!0),y(V,null,D(x(m),(e=>(_(),R(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===x(c).accept?(_(),R(u,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===x(c).accept?x(f):[]},{default:k((()=>[w(d,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:x(c).accept_ips,"onUpdate:modelValue":l[1]||(l[1]=e=>x(c).accept_ips=e)},null,8,["modelValue"]),l[3]||(l[3]=I("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):j("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[h,x(s)]])}}},[["__scopeId","data-v-51a833d1"]]),Y={class:"lyBackupDialog"},Z={key:3},ee=A({__name:"moduleBackup",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1);h(!1);let n=h("\u6570\u636e\u5e93\u5907\u4efd"),s=h(!1),f=h(!1),v=h(""),b=h({fid:"",type:1,page:1,limit:10}),V=h({page:1,limit:10,total:0}),D=h([]),I=h({});function j(){t("closed"),t("refreshData")}function B(e){b.value.page=e.page,b.value.limit=e.limit,q()}function q(){s.value=!0,u.sysBakBackUpList(b.value).then((e=>{s.value=!1,2e3==e.code?(D.value=e.data.data,V.value.page=e.data.page,V.value.limit=e.data.limit,V.value.total=e.data.total):r(e.msg)}))}function M(){f.value=!0,u.sysDatabasesDbtools({action:"backup_db",id:b.value.fid}).then((e=>{f.value=!1,2e3==e.code?(d(e.msg),q()):r(e.msg)}))}let z=h([]),A=h([]);function H(e){A.value=p(e),z.value=e.map((e=>e.id))}let G=h(null);function J(){F((()=>{G.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let N=h(0),X=h("0%"),Q=h(!1),W=h(1),ee=h("");function le(e){return new Promise((l=>setTimeout(l,e)))}function ae(){return i(this,null,(function*(){W.value=2,Q.value=!0,A.value.forEach((e=>{e.status="wait"}));let e=A.value.length,l=0;for(let a=0;a<e;a++){N.value=a+1==e?100:parseInt((a+1)/e*100),X.value=N.value+"%";let t="del_backup_db",o={id:b.value.fid,bid:A.value[a].id,action:t};u.sysDatabasesDbtools(o).then((e=>{2e3==e.code?A.value[a].status="success":(A.value[a].status="error",l+=1)})),yield le(1e3)}Q.value=!1,W.value=3,ee.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}return l({handleOpen:function(e,l){n.value=l,o.value=!0,b.value.fid=e.id,v.value=e.db_name,q()}}),(e,l)=>{const a=g("el-button"),t=g("el-form-item"),i=g("el-form"),d=g("el-table-column"),r=g("el-table"),p=g("el-tag"),h=O("loading");return _(),y("div",Y,[w($,{modelValue:x(o),"onUpdate:modelValue":l[0]||(l[0]=e=>S(o)?o.value=e:o=e),title:x(n),width:"60%","before-close":j,loading:x(f)},{default:k((()=>[w(i,{inline:!1,model:x(b),rules:x(I),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:x(f)},{default:k((()=>[w(t,null,{default:k((()=>[w(a,{type:"primary",onClick:M},{default:k((()=>l[1]||(l[1]=[C("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1}),w(a,{onClick:J,disabled:x(z).length<1},{default:k((()=>l[2]||(l[2]=[C("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),P((_(),R(r,{ref:"table",border:"",data:x(D),height:410,onSelectionChange:H},{default:k((()=>[w(d,{type:"selection",width:"55",align:"center"}),w(d,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),w(d,{prop:"size",label:"\u5927\u5c0f","min-width":"100"},{default:k((e=>[C(U(x(c)(e.row.size)),1)])),_:1}),w(d,{prop:"filename",label:"\u4f4d\u7f6e","min-width":"190","show-overflow-tooltip":""}),w(d,{prop:"create_at",label:"\u65f6\u95f4","min-width":"160"}),w(d,{prop:"store_type",label:"\u5b58\u50a8\u5bf9\u8c61","min-width":"90"}),w(d,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:k((e=>[w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${v.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{s.value=!0;let l={id:b.value.fid,bid:a.id,action:"recover_db_sql"};u.sysDatabasesDbtools(l).then((e=>{s.value=!1,2e3==e.code?(E.success(e.msg),q()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>l[3]||(l[3]=[C("\u6062\u590d")]))),_:2},1032,["onClick"]),w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void u.sysBakFileDownload({id:b.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);E.warning(e.msg)}}else m(e.data,a.name)}));var a}},{default:k((()=>l[4]||(l[4]=[C("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{s.value=!0;let l={id:b.value.fid,bid:a.id,action:"del_backup_db"};u.sysDatabasesDbtools(l).then((e=>{s.value=!1,2e3==e.code?(E.success(e.msg),q()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>l[5]||(l[5]=[C("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[h,x(s)]]),w(T,{small:!0,"child-msg":x(V),onCallFather:B},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),w(L,{ref_key:"batchOpRef",ref:G,onClosed:q,tip2:x(ee),percentContent:x(X),percentage:x(N),loadingSave:x(Q),stepStatus:x(W)},{table:k((()=>[w(r,{data:x(A),border:"","max-height":500},{default:k((()=>[w(d,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),w(d,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:k((e=>["wait"==e.row.status?(_(),R(p,{key:0,type:"info"},{default:k((()=>l[6]||(l[6]=[C("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(_(),R(p,{key:1,type:"success"},{default:k((()=>l[7]||(l[7]=[C("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(_(),R(p,{key:2,type:"danger"},{default:k((()=>l[8]||(l[8]=[C("\u5220\u9664\u5931\u8d25")]))),_:1})):(_(),y("span",Z))])),_:1})])),_:1},8,["data"])])),footer:k((()=>[w(a,{type:"primary",onClick:ae,loading:x(Q)},{default:k((()=>l[9]||(l[9]=[C("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"])])}}},[["__scopeId","data-v-1e331b57"]]),le={class:"lyuploadimport"},ae={key:1,class:"handle-button"},te={class:"handle-drag"},oe={key:0},ne={key:1},ie={key:0},se={key:1,style:{color:"green"}},ue={key:2},de={key:0},re=A({__name:"moduleUpload",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),n=h(!1),s=h(""),u=h(""),d=h([]),r=h(""),m=h(0),v=h(null),b=h("file"),V=h(null),D=h(null),O=h(!1),P=h(0),B=h("");function q(){t("refreshData"),t("closed")}function M(){O.value=!1,d.value=[],P.value=0,B.value="",T()}function z(e){b.value=e,V.value.webkitdirectory=!1,v.value.$el.querySelector("input").click()}function T(){v.value.clearFiles()}function A(e){e.preventDefault()}function L(e){e.preventDefault();const l=e.dataTransfer.items;if(l)for(let a=0;a<l.length;a++){const e=l[a].webkitGetAsEntry();e&&H(e)}}function K(e){e.preventDefault()}function H(e,l=""){if(l=l||"",e.isFile)e.file((e=>{d.value.push(function(e,l){const a=Date.now(),t=new File([e],e.name,{type:e.type,lastModified:e.lastModified});t.uid=a;let o=e.name;""!=l&&(o=l+e.name);return{name:o,size:e.size,status:"ready",uid:a,raw:t}}(e,l))}));else if(e.isDirectory){e.createReader().readEntries((a=>{for(let t=0;t<a.length;t++)H(a[t],l+e.name+"/")}))}}function G(e,l){const a=l.findIndex((l=>l.name===e.name));if(a!=l.findLastIndex((l=>l.name===e.name))&&e.raw.webkitRelativePath==l[a].raw.webkitRelativePath&&(E.error(e.name+" \u6587\u4ef6\u5df2\u5b58\u5728"),l.pop()),64==e.size||0==e.size){d.value=l;const a=new FileReader;a.readAsDataURL(e.raw),a.onload=()=>i(this,null,(function*(){})),a.onerror=()=>{d.value=d.value.filter((l=>l.uid!==e.uid)),E.error({message:`\u3010${e.name}\u3011\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u4e3a\u7a7a\u6587\u4ef6\u5939`,type:"error",showClose:!0,duration:3e3})}}else d.value=l;!function(){i(this,null,(function*(){F((()=>{let e=D.value.scrollBarRef.wrapRef.offsetHeight;D.value.scrollBarRef.setScrollTop(e)}))}))}()}function J(e){v.value.clearFiles();for(let l=0;l<e.length;l++){const a=e[l];v.value.handleStart(a)}}function N(e,l){l.status="success"}let X=h(0);function Q(e){return i(this,null,(function*(){F((()=>{if(0==(e=e||0))D.value.scrollBarRef.setScrollTop(0);else if(X.value>3){if(e>0){let l=D.value.scrollBarRef.wrapRef.offsetHeight/d.value.length;e=l*X.value}D.value.scrollBarRef.setScrollTop(e)}}))}))}function W(e){return e?e.split("/").slice(0,-1).join("/"):e}function Y(e){let l=0;for(let a=0;a<d.value.length;a++)l+=d.value[a].size;return c(l/e)}function Z(){return i(this,null,(function*(){yield Q(0);const e=new Date;n.value=!0,X.value=0;const l=d.value.slice();for(let a=0;a<l.length;a++){const t=l[a],o=t.size;if(r.value=`\u3010${t.name}\u3011\u5f00\u59cb\u4e0a\u4f20`,o<=5242880){const e=new FormData;e.append("lyfile",t.raw),""!=t.raw.webkitRelativePath?e.append("path",u.value+"/"+W(t.raw.webkitRelativePath)):e.append("path",u.value+"/"+W(t.name)),m.value=0,yield f({url:"/api/sys/fileManage/upload/",formData:e},(e=>{m.value=Math.round(e.loaded/e.total*100)})).then((e=>{2e3===e.code?(X.value++,d.value[a].status="success"):(X.value++,d.value[a].status=e.msg)})).catch((e=>{E({message:e,grouping:!0,type:"warning"}),X.value++,d.value[a].status=e}))}else{const e=5242880,l=Math.ceil(o/e);let n=0;m.value=0;for(let i=0;i<l;i++){const s=i*e,r=Math.min(s+e,o),p=t.raw.slice(s,r),c=new FormData;c.append("lyfilechunk",t.name),""!=t.raw.webkitRelativePath?c.append("path",u.value+"/"+W(t.raw.webkitRelativePath)):c.append("path",u.value+"/"+W(t.name)),c.append("chunkSize",e),c.append("totalSize",o),c.append("chunk",p),c.append("chunkIndex",i.toString()),c.append("chunkCount",l.toString());let v=!0;if(yield f({url:"/api/sys/fileManage/upload/",formData:c},(e=>{m.value=Math.round(100*(n+e.loaded/e.total)/l)})).then((e=>{2e3===e.code?v=!0:(d.value[a].status=e.msg,v=!1)})).catch((e=>{E({message:e,grouping:!0,type:"warning"}),d.value[a].status=e,v=!1})),!v)break;if(n++,n==l){X.value++,d.value[a].status="success";break}}}if(a==l.length-1&&(n.value=!1,r.value="",O.value=!0,X.value==l.length)){const l=(new Date-e)/1e3;P.value=l.toFixed(2),B.value=Y(P.value)}yield Q(30)}n.value=!1}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0;let a=p(e);u.value=a.path,F((()=>{V.value=document.querySelector(".el-upload__input")}))}}),(e,l)=>{const a=g("el-alert"),t=g("el-button"),i=g("upload-filled"),u=g("el-icon"),p=g("el-text"),f=g("el-progress"),b=g("el-upload"),h=g("el-table-column"),V=g("el-table");return _(),y("div",le,[w($,{modelValue:x(o),"onUpdate:modelValue":l[4]||(l[4]=e=>S(o)?o.value=e:o=e),title:x(s),width:"60%","before-close":q},{footer:k((()=>[w(t,{onClick:q,loading:x(n)},{default:k((()=>l[8]||(l[8]=[C("\u5173\u95ed")]))),_:1},8,["loading"]),x(O)?j("",!0):(_(),R(t,{key:0,type:"primary",onClick:Z,loading:x(n),disabled:x(d).length<1},{default:k((()=>l[9]||(l[9]=[C("\u786e\u8ba4\u4e0a\u4f20")]))),_:1},8,["loading","disabled"]))])),default:k((()=>[x(O)?(_(),R(a,{key:0,style:{"margin-bottom":"10px"},title:"\u4e0a\u4f20\u6210\u529f"+x(X)+"\u4e2a\uff0c\u8017\u65f6"+x(P)+"\u79d2\uff0c\u5e73\u5747\u901f\u5ea6"+x(B),type:"success",onClick:M},null,8,["title"])):j("",!0),x(O)?j("",!0):(_(),y("div",ae,[I("div",null,[w(t,{type:"primary",onClick:l[0]||(l[0]=e=>z("file"))},{default:k((()=>l[5]||(l[5]=[C("\u4e0a\u4f20\u6587\u4ef6")]))),_:1})]),I("div",null,[w(t,{onClick:T},{default:k((()=>l[6]||(l[6]=[C("\u6e05\u7a7a\u5217\u8868")]))),_:1})])])),I("div",null,[I("div",{class:"el-upload-dragger",onDragover:A,onDrop:L,onDragleave:K},[I("div",te,[I("div",{onClick:l[1]||(l[1]=e=>z("file"))},[w(u,{class:"el-icon--upload"},{default:k((()=>[w(i)])),_:1}),l[7]||(l[7]=I("div",{class:"el-upload__text"}," \u8bf7\u62d6\u62fd\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u5230\u6b64\u5904\uff08\u4ec5\u652f\u6301.sql\u3001.zip\u3001.tar.gz\uff09 ",-1))])])],32)]),w(b,{ref_key:"lyUploadRef",ref:v,accept:".sql,.zip,.tar.gz","show-file-list":!1,multiple:"","file-list":x(d),"onUpdate:fileList":l[2]||(l[2]=e=>S(d)?d.value=e:d=e),action:"#","auto-upload":!1,"on-change":G,"on-exceed":J,"on-success":N},{tip:k((()=>[w(p,null,{default:k((()=>[C(U(x(r)),1)])),_:1}),x(n)?(_(),R(f,{key:0,"text-inside":"","stroke-width":20,percentage:x(m)},null,8,["percentage"])):j("",!0)])),_:1},8,["file-list"]),w(V,{ref_key:"tableContainer",ref:D,data:x(d),"table-layout":"auto","max-height":"300px","scrollbar-always-on":!0},{default:k((()=>[w(h,{prop:"name","min-width":"200",label:"\u6587\u4ef6\u540d","show-overflow-tooltip":""},{default:k((e=>[""!=e.row.raw.webkitRelativePath?(_(),y("span",oe,U(e.row.raw.webkitRelativePath),1)):(_(),y("span",ne,U(e.row.name),1))])),_:1}),w(h,{prop:"size","min-width":"100",label:"\u5927\u5c0f","show-overflow-tooltip":""},{default:k((e=>[C(U(x(c)(e.row.size)),1)])),_:1}),w(h,{prop:"status","min-width":"90",label:"\u72b6\u6001","show-overflow-tooltip":""},{default:k((e=>["ready"==e.row.status?(_(),y("span",ie,"\u7b49\u5f85\u4e0a\u4f20")):"success"==e.row.status?(_(),y("span",se,"\u4e0a\u4f20\u6210\u529f")):(_(),y("span",ue,U(e.row.status),1))])),_:1}),w(h,{width:"45",fixed:"right"},{default:k((a=>["success"==a.row.status||x(n)?j("",!0):(_(),y("span",de,[w(t,{type:"primary",link:"",onClick:l[3]||(l[3]=l=>{return a=e.index,void d.value.splice(a,1);var a}),icon:"Close"})]))])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-b642ba8c"]]),pe={class:"lyBackupDialog"},ce={key:3},me=A({__name:"moduleImport",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1);h(!1);let s=h("\u6570\u636e\u5e93\u5907\u4efd"),d=h(!1),f=h(!1),v=h(""),b=h({fid:"",type:1,page:1,limit:10}),V=h({page:1,limit:10,total:0}),D=h([]),I=h({});function B(){t("closed"),t("refreshData")}function q(e){b.value.page=e.page,b.value.limit=e.limit,M()}function M(){d.value=!0;let e=n({},b.value);e.fid="",u.sysBakBackUpList(e).then((e=>{d.value=!1,2e3==e.code?(D.value=e.data.data,V.value.page=e.data.page,V.value.limit=e.data.limit,V.value.total=e.data.total):r(e.msg)}))}let z=h([]),A=h([]);function H(e){A.value=p(e),z.value=e.map((e=>e.id))}let G=h(null);function J(){F((()=>{G.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let N=h(0),X=h("0%"),Q=h(!1),W=h(1),Y=h("");function Z(e){return new Promise((l=>setTimeout(l,e)))}function ee(){return i(this,null,(function*(){W.value=2,Q.value=!0,A.value.forEach((e=>{e.status="wait"}));let e=A.value.length,l=0;for(let a=0;a<e;a++){N.value=a+1==e?100:parseInt((a+1)/e*100),X.value=N.value+"%";let t="del_backup_db",o={id:b.value.fid,bid:A.value[a].id,action:t};u.sysDatabasesDbtools(o).then((e=>{2e3==e.code?A.value[a].status="success":(A.value[a].status="error",l+=1)})),yield Z(1e3)}Q.value=!1,W.value=3,Y.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let le=h(null),ae=h(!1);function te(){ae.value=!0,F((()=>{le.value.handleOpen({path:"backup_datebase_path"},"\u4e0a\u4f20\u6587\u4ef6\u5230")}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0,b.value.fid=e.id,v.value=e.db_name,M()}}),(e,l)=>{const a=g("el-button"),t=g("el-form-item"),n=g("el-form"),i=g("el-table-column"),r=g("el-table"),p=g("el-tag"),h=O("loading");return _(),y("div",pe,[w($,{modelValue:x(o),"onUpdate:modelValue":l[0]||(l[0]=e=>S(o)?o.value=e:o=e),title:x(s),width:"60%","before-close":B,loading:x(f)},{default:k((()=>[w(n,{inline:!1,model:x(b),rules:x(I),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:x(f)},{default:k((()=>[w(t,null,{default:k((()=>[w(a,{type:"primary",onClick:te},{default:k((()=>l[2]||(l[2]=[C("\u70b9\u51fb\u4e0a\u4f20")]))),_:1}),w(a,{onClick:J,disabled:x(z).length<1},{default:k((()=>l[3]||(l[3]=[C("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),P((_(),R(r,{ref:"table",border:"",data:x(D),height:410,onSelectionChange:H},{default:k((()=>[w(i,{type:"selection",width:"55",align:"center"}),w(i,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),w(i,{prop:"size",label:"\u5927\u5c0f",width:"120"},{default:k((e=>[C(U(x(c)(e.row.size)),1)])),_:1}),w(i,{prop:"create_at",label:"\u65f6\u95f4",width:"170"}),w(i,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:k((e=>[w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${v.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{d.value=!0;let l={id:b.value.fid,bid:a.id,action:"recover_db_sql"};u.sysDatabasesDbtools(l).then((e=>{d.value=!1,2e3==e.code?(E.success(e.msg),M()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>l[4]||(l[4]=[C("\u5bfc\u5165")]))),_:2},1032,["onClick"]),w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void u.sysBakFileDownload({id:b.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);E.warning(e.msg)}}else m(e.data,a.name)}));var a}},{default:k((()=>l[5]||(l[5]=[C("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),w(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{d.value=!0;let l={id:b.value.fid,bid:a.id,action:"del_backup_db"};u.sysDatabasesDbtools(l).then((e=>{d.value=!1,2e3==e.code?(E.success(e.msg),M()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>l[6]||(l[6]=[C("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[h,x(d)]]),w(T,{small:!0,"child-msg":x(V),onCallFather:q},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),w(L,{ref_key:"batchOpRef",ref:G,onClosed:M,tip2:x(Y),percentContent:x(X),percentage:x(N),loadingSave:x(Q),stepStatus:x(W)},{table:k((()=>[w(r,{data:x(A),border:"","max-height":500},{default:k((()=>[w(i,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),w(i,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:k((e=>["wait"==e.row.status?(_(),R(p,{key:0,type:"info"},{default:k((()=>l[7]||(l[7]=[C("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(_(),R(p,{key:1,type:"success"},{default:k((()=>l[8]||(l[8]=[C("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(_(),R(p,{key:2,type:"danger"},{default:k((()=>l[9]||(l[9]=[C("\u5220\u9664\u5931\u8d25")]))),_:1})):(_(),y("span",ce))])),_:1})])),_:1},8,["data"])])),footer:k((()=>[w(a,{type:"primary",onClick:ee,loading:x(Q)},{default:k((()=>l[10]||(l[10]=[C("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"]),x(ae)?(_(),R(re,{key:0,ref_key:"moduleUploadFlag",ref:le,onRefreshData:M,onClosed:l[1]||(l[1]=e=>S(ae)?ae.value=!1:ae=!1)},null,512)):j("",!0)])}}},[["__scopeId","data-v-8b70903f"]]),fe={class:"handle-top"},ve={class:"search-sites-input"},be={key:0},he={key:1,class:"lyflex"},ge={key:0,class:"pass-item",style:{"margin-right":"8px"}},_e={key:1,style:{"margin-right":"8px"}},ye={key:0},we={key:1},ke={key:2},xe={key:0},Ce={key:1},Ve={key:0},De={key:3},Re={key:6,class:"softmask"},Ie={key:7,class:"soft-ins-guide-dialog"},je=A({__name:"index",props:{installed:{type:Boolean,default:!1},status:{type:Boolean,default:!1}},setup(e,{expose:l}){const a=v();let t=B((()=>a.ismobile)),o=h(!1);const n=G();let s=h({search:"",db_type:0,page:1,limit:10}),d=h({page:1,limit:10,total:0}),r=h([]),p=h([]),c=h([]);function m(e){c.value=e,p.value=e.map((e=>e.id))}function f(e){s.value.page=e.page,s.value.limit=e.limit,b()}function b(){o.value=!0,u.sysDatabases(s.value).then((e=>{if(o.value=!1,2e3===e.code){let l=e.data.data;l.length>0&&l.forEach((e=>{e.showPassword=!1})),r.value=l,d.value.page=e.data.page,d.value.limit=e.data.limit,d.value.total=e.data.total}}))}function V(){s.value.page=1,b()}let D=h(!1),M=h(null);function z(){D.value=!0,F((()=>{M.value.handleOpen(null,"\u6dfb\u52a0\u6570\u636e\u5e93")}))}let $=h(!1),A=h(null);function J(){$.value=!0,F((()=>{A.value.handleOpen(null,"\u4fee\u6539root\u5bc6\u7801")}))}let Y=h(!1),Z=h(null);let le=h(!1),ae=h(null);let te=h(!1),oe=h(null);function ne(){n.push({path:"/appstore"})}let ie=h(0),se=h("0%"),ue=h(!1),de=h(1),re=h(""),pe=h(""),ce=h(""),je=h(null);function Se(e){ce.value=e;let l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93";"del"==e&&(pe.value="\u662f\u5426\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93"),"backup"==e&&(pe.value="\u662f\u5426\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93"),F((()=>{je.value.handleOpen(null,l)}))}function Oe(e){return new Promise((l=>setTimeout(l,e)))}function Pe(){return i(this,null,(function*(){de.value=2,ue.value=!0,c.value.forEach((e=>{e.status="wait","del"==ce.value?e.statusname="\u7b49\u5f85\u5220\u9664":"backup"==ce.value&&(e.statusname="\u7b49\u5f85\u5907\u4efd")}));let e=c.value.length,l=0;for(let t=0;t<e;t++){if(ie.value=t+1==e?100:parseInt((t+1)/e*100),se.value=ie.value+"%","del"==ce.value)u.sysDatabasesDelete({id:c.value[t].id}).then((e=>{2e3==e.code?(c.value[t].status="success","del"==ce.value?c.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u6210\u529f")):(c.value[t].status="error",l+=1,"del"==ce.value?c.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}));else if("backup"==ce.value){let e={id:c.value[t].id,action:"backup_db"};u.sysDatabasesDbtools(e).then((e=>{2e3==e.code?(c.value[t].status="success","del"==ce.value?c.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u6210\u529f")):(c.value[t].status="error",l+=1,"del"==ce.value?c.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==ce.value&&(c.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}))}yield Oe(1e3)}ue.value=!1,de.value=3;let a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210";"del"==ce.value?a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210":"backup"==ce.value&&(a="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\u5df2\u5b8c\u6210"),re.value=`${a}\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let Ue=h(!1),Fe=h(null);return l({RefreshData:function(){F((()=>{b()}))}}),(l,a)=>{const n=g("el-button"),i=g("arrow-down"),v=g("el-icon"),h=g("el-dropdown-item"),B=g("el-dropdown-menu"),G=g("el-dropdown"),ce=g("el-col"),Oe=g("el-input"),Be=g("el-row"),qe=g("el-table-column"),Me=g("el-text"),ze=g("el-divider"),Te=g("el-table"),$e=g("el-tag"),Ae=g("InfoFilled"),Le=O("loading");return _(),y("div",null,[I("div",fe,[w(Be,null,{default:k((()=>[w(ce,{xs:24,sm:16,md:16,lg:16,xl:16},{default:k((()=>[w(n,{type:"primary",onClick:z,disabled:!e.status},{default:k((()=>a[12]||(a[12]=[C("\u6dfb\u52a0\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),w(n,{onClick:J,disabled:!e.status},{default:k((()=>a[13]||(a[13]=[C("root\u5bc6\u7801")]))),_:1},8,["disabled"]),w(n,{icon:"refresh",circle:"",onClick:V}),w(G,{disabled:x(p).length<1},{dropdown:k((()=>[w(B,null,{default:k((()=>[w(h,{onClick:a[0]||(a[0]=e=>Se("del"))},{default:k((()=>a[15]||(a[15]=[C("\u5220\u9664\u6570\u636e\u5e93")]))),_:1}),w(h,{onClick:a[1]||(a[1]=e=>Se("backup"))},{default:k((()=>a[16]||(a[16]=[C("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1})])),_:1})])),default:k((()=>[w(n,{plain:"",disabled:x(p).length<1},{default:k((()=>[a[14]||(a[14]=C(" \u6279\u91cf\u64cd\u4f5c")),w(v,{class:"el-icon--right"},{default:k((()=>[w(i)])),_:1})])),_:1},8,["disabled"])])),_:1},8,["disabled"])])),_:1}),w(ce,{xs:24,sm:8,md:8,lg:8,xl:8},{default:k((()=>[I("div",ve,[w(Oe,{modelValue:x(s).search,"onUpdate:modelValue":a[2]||(a[2]=e=>x(s).search=e),clearable:"",onClear:a[3]||(a[3]=e=>V()),"suffix-icon":"Search",onKeyup:a[4]||(a[4]=q((e=>V()),["enter"])),onChange:a[5]||(a[5]=e=>V()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),P((_(),R(Te,{data:x(r),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style",onSelectionChange:m},{default:k((()=>[w(qe,{type:"selection",width:"55",align:"center"}),w(qe,{prop:"db_name",label:"\u6570\u636e\u5e93\u540d","min-width":"150","show-overflow-tooltip":""}),w(qe,{prop:"db_user",label:"\u7528\u6237\u540d","min-width":"100","show-overflow-tooltip":""}),w(qe,{prop:"db_pass",label:"\u5bc6\u7801","min-width":"150"},{default:k((e=>[""===e.row.db_user?(_(),y("span",be,"-")):j("",!0),e.row.db_pass&&e.row.db_user?(_(),y("div",he,[e.row.showPassword?j("",!0):(_(),y("div",ge,a[17]||(a[17]=[I("span",null,"*********",-1)]))),e.row.showPassword?(_(),y("span",_e,U(e.row.db_pass),1)):j("",!0),e.row.showPassword?j("",!0):(_(),R(n,{key:2,link:"",onClick:l=>e.row.showPassword=!0,icon:"View",style:{"margin-right":"5px"}},null,8,["onClick"])),e.row.showPassword?(_(),R(n,{key:3,link:"",onClick:l=>e.row.showPassword=!1,icon:"Hide"},null,8,["onClick"])):j("",!0),I("div",null,[w(H,{content:e.row.db_pass,type:"icon"},null,8,["content"])])])):j("",!0)])),_:1}),w(qe,{prop:"remark",label:"\u8bbf\u95ee\u6743\u9650",width:"130"},{default:k((e=>["ip"==e.row.accept?(_(),y("span",ye,"\u6307\u5b9aIP")):"localhost"==e.row.accept?(_(),y("span",we,"\u672c\u5730\u670d\u52a1\u5668")):(_(),y("span",ke,"\u6240\u6709\u4eba"))])),_:1}),w(qe,{prop:"remark",label:"\u4f4d\u7f6e",width:"130"},{default:k((e=>["127.0.0.1"==e.row.db_host||"locahost"==e.row.db_host?(_(),y("span",xe,"\u672c\u5730")):(_(),y("span",Ce,U("\u8fdc\u7a0b["+e.row.db_host+"]"),1))])),_:1}),w(qe,{prop:"remark",label:"\u5907\u6ce8","min-width":"130","show-overflow-tooltip":""}),w(qe,{prop:"remark",label:"\u5907\u4efd | \u5bfc\u5165","min-width":"130"},{default:k((e=>[w(Me,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,te.value=!0,void F((()=>{oe.value.handleOpen(a,"\u3010"+a.db_name+"\u3011\u6570\u636e\u5e93\u5907\u4efd")}));var a}},{default:k((()=>[a[18]||(a[18]=C("\u5907\u4efd")),e.row.bak_nums>0?(_(),y("span",Ve,U("("+e.row.bak_nums+")"),1)):j("",!0)])),_:2},1032,["onClick"]),w(ze,{direction:"vertical"}),w(Me,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,Ue.value=!0,void F((()=>{Fe.value.handleOpen(a,"\u5bfc\u5165\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5b57\u7b26\u96c6\uff1a"+a.format)}));var a}},{default:k((()=>a[19]||(a[19]=[C("\u5bfc\u5165")]))),_:2},1032,["onClick"])])),_:1}),w(qe,{fixed:!x(t)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:k((e=>[w(n,{link:"",type:"primary",onClick:l=>{return a=e.row,le.value=!0,void F((()=>{ae.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u6743\u9650")}));var a}},{default:k((()=>a[20]||(a[20]=[C("\u6743\u9650")]))),_:2},1032,["onClick"]),w(n,{link:"",type:"primary",onClick:l=>{return a=e.row,Y.value=!0,void F((()=>{Z.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5bc6\u7801")}));var a}},{default:k((()=>a[21]||(a[21]=[C("\u6539\u5bc6")]))),_:2},1032,["onClick"]),w(n,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm("\u3010\u5f7b\u5e95\u5220\u9664\u3011\u6570\u636e\u5e93\u540e\uff0c\u8be5\u6570\u636e\u5e93\u5185\u7684\u6240\u6709\u6570\u636e\u5c06\u88ab\u5220\u9664\uff0c\u4e14\u4e0d\u53ef\u6062\u590d\uff01\uff01\uff01","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{o.value=!0,u.sysDatabasesDelete({id:a.id}).then((e=>{o.value=!1,2e3==e.code?(E.success(e.msg),b()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>a[22]||(a[22]=[C("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[Le,x(o)]]),w(T,{small:!0,"child-msg":x(d),onCallFather:f,border:!1,position:"right"},null,8,["child-msg"]),x(D)?(_(),R(N,{key:0,ref_key:"moduleAddFlag",ref:M,onRefreshData:b,onClosed:a[6]||(a[6]=e=>S(D)?D.value=!1:D=!1)},null,512)):j("",!0),x($)?(_(),R(X,{key:1,ref_key:"modulePassFlag",ref:A,onClosed:a[7]||(a[7]=e=>S($)?$.value=!1:$=!1)},null,512)):j("",!0),x(Y)?(_(),R(Q,{key:2,ref_key:"moduleResetUserPassFlag",ref:Z,onRefreshData:b,onClosed:a[8]||(a[8]=e=>S(Y)?Y.value=!1:Y=!1)},null,512)):j("",!0),x(le)?(_(),R(W,{key:3,ref_key:"moduleAcceptFlag",ref:ae,onRefreshData:b,onClosed:a[9]||(a[9]=e=>S(le)?le.value=!1:le=!1)},null,512)):j("",!0),x(te)?(_(),R(ee,{key:4,ref_key:"moduleBackupFlag",ref:oe,onRefreshData:b,onClosed:a[10]||(a[10]=e=>S(te)?te.value=!1:te=!1)},null,512)):j("",!0),x(Ue)?(_(),R(me,{key:5,ref_key:"moduleImportFlag",ref:Fe,onRefreshData:b,onClosed:a[11]||(a[11]=e=>S(Ue)?Ue.value=!1:Ue=!1)},null,512)):j("",!0),w(L,{ref_key:"batchOpRef",ref:je,width:"680px",onClosed:b,tip1:x(pe),tip2:x(re),percentContent:x(se),percentage:x(ie),loadingSave:x(ue),stepStatus:x(de)},{table:k((()=>[w(Te,{data:x(c),border:"","max-height":500},{default:k((()=>[w(qe,{prop:"db_name",label:"\u6570\u636e\u5e93","min-width":"280","show-overflow-tooltip":""}),w(qe,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:k((e=>["wait"==e.row.status?(_(),R($e,{key:0,type:"info"},{default:k((()=>[C(U(e.row.statusname),1)])),_:2},1024)):"success"==e.row.status?(_(),R($e,{key:1,type:"success"},{default:k((()=>[C(U(e.row.statusname),1)])),_:2},1024)):"error"==e.row.status?(_(),R($e,{key:2,type:"danger"},{default:k((()=>[C(U(e.row.statusname),1)])),_:2},1024)):(_(),y("span",De))])),_:1})])),_:1},8,["data"])])),footer:k((()=>[w(n,{type:"primary",onClick:Pe,loading:x(ue)},{default:k((()=>a[23]||(a[23]=[C("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip1","tip2","percentContent","percentage","loadingSave","stepStatus"]),e.installed?j("",!0):(_(),y("div",Re)),e.installed?j("",!0):(_(),y("div",Ie,[w(v,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:k((()=>[w(Ae)])),_:1}),a[25]||(a[25]=C(" \u5f53\u524d\u672a\u5b89\u88c5Mysql\u73af\u5883 ")),w(n,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:ne},{default:k((()=>a[24]||(a[24]=[C("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})]))])}}},[["__scopeId","data-v-b4e48f00"]]),Se=A({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=h(!1),n=h(!1),i=h("\u6dfb\u52a0Key"),s=h({id:"",db:0,key:"",value:"",exptime:0}),c=h([]),m=h({db:[{required:!0,message:"\u8bf7\u9009\u62e9\u6570\u636e\u5e93",trigger:"blur"}],key:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u540d",trigger:"blur"}],value:[{required:!0,message:"\u8bf7\u8f93\u5165\u952e\u503c",trigger:"blur"}]});function f(){t("closed")}let v=h(null);function b(){v.value.validate((e=>{e&&(n.value=!0,s.value.action="redis_set_val",u.sysSoftinfoMg(s.value).then((e=>{n.value=!1,2e3==e.code?(d(e.msg),f(),t("refreshData")):r(e.msg)})))}))}return l({handleOpen:function(e,l,a){i.value=l,o.value=!0,c.value=a,e&&(s.value=p(e))}}),(e,l)=>{const a=g("el-option"),t=g("el-select"),u=g("el-form-item"),d=g("el-input"),r=g("el-input-number"),p=g("el-alert"),h=g("el-form"),I=g("el-button");return _(),y("div",null,[w($,{modelValue:x(o),"onUpdate:modelValue":l[4]||(l[4]=e=>S(o)?o.value=e:o=e),title:x(i),width:"680px","before-close":f},{footer:k((()=>[w(I,{onClick:f,loading:x(n)},{default:k((()=>l[6]||(l[6]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(I,{type:"primary",onClick:b,loading:x(n)},{default:k((()=>l[7]||(l[7]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(h,{inline:!1,model:x(s),rules:x(m),ref_key:"rulesForm",ref:v,"label-position":"right","label-width":"auto"},{default:k((()=>[w(u,{label:"\u6570\u636e\u5e93\uff1a",prop:"db"},{default:k((()=>[w(t,{modelValue:x(s).db,"onUpdate:modelValue":l[0]||(l[0]=e=>x(s).db=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:k((()=>[(_(!0),y(V,null,D(x(c),(e=>(_(),R(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(u,{label:"\u952e(key)\uff1a",prop:"key"},{default:k((()=>[w(d,{modelValue:x(s).key,"onUpdate:modelValue":l[1]||(l[1]=e=>x(s).key=e),placeholder:"\u8bf7\u8f93\u5165\u952e\u540d",clearable:""},null,8,["modelValue"])])),_:1}),w(u,{prop:"value",label:"\u503c(value)\uff1a"},{default:k((()=>[w(d,{placeholder:"\u8bf7\u8f93\u5165\u952e\u503c",clearable:"",autosize:{minRows:3,maxRows:5},type:"textarea",modelValue:x(s).value,"onUpdate:modelValue":l[2]||(l[2]=e=>x(s).value=e)},null,8,["modelValue"])])),_:1}),w(u,{prop:"exptime",label:"\u6709\u6548\u671f(s)\uff1a"},{default:k((()=>[w(r,{modelValue:x(s).exptime,"onUpdate:modelValue":l[3]||(l[3]=e=>x(s).exptime=e),min:0,style:{width:"100%"},placeholder:"\u5355\u4f4d\u79d2\uff08s\uff09"},null,8,["modelValue"])])),_:1}),w(p,{type:"warning"},{default:k((()=>l[5]||(l[5]=[C("\u6709\u6548\u671f\uff1a0\u8868\u793a\u6c38\u4e45")]))),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-91eae30f"]]),Oe={class:"handle-top"},Pe={class:"search-sites-input"},Ue={key:1,class:"softmask"},Fe={key:2,class:"soft-ins-guide-dialog"},Be={class:"checkbox-container"},qe=A({__name:"index",props:{installed:{type:Boolean,default:!1},status:{type:Boolean,default:!1}},setup(e,{expose:l}){const a=v();let t=B((()=>a.ismobile));const o=G();let i=h(!1),s=h([]),d=h(0),r=h({search:"",page:1,limit:10,action:"get_redis_keylist",db:d}),p=h({page:1,limit:10,total:0}),c=h([]);function m(e){r.value.page=e.page,r.value.limit=e.limit,f()}function f(){i.value=!0,u.sysSoftinfoMg(r.value).then((e=>{i.value=!1,2e3===e.code?(c.value=e.data.list,p.value.page=e.data.page,p.value.limit=e.data.limit,p.value.total=e.data.total):E.warning(e.msg)}))}function b(){r.value.page=1,f()}function M(e){r.value.page=1,r.value.db=e.props.name,c.value=[],b(),J()}let z=h(!1),A=h(null);function L(){z.value=!0,F((()=>{A.value.handleOpen(null,"\u6dfb\u52a0Key",s.value)}))}function H(){o.push({path:"/appstore"})}function J(){u.sysSoftinfoMg({action:"get_redis_dblist"}).then((e=>{2e3==e.code&&(s.value=e.data)}))}let N=h(!1),X=h([]),Q=h(!1),W=h(!1),Y=h(!0);function Z(e){e?(X.value=[],s.value.forEach((e=>{X.value.push(e.id)}))):X.value=[],Y.value=!1}function ee(){N.value=!0,X.value=[]}function le(){N.value=!1,X.value=[],Y.value=!0}function ae(){K.confirm("\u662f\u5426\u6e05\u7a7a\u9009\u62e9\u7684\u6570\u636e\u5e93\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{W.value=!0,u.sysSoftinfoMg({action:"redis_flashdb",ids:X.value}).then((e=>{W.value=!1,2e3==e.code?(E.success(e.msg),oe(),le()):E.warning(e.msg)}))})).catch((()=>{}))}function te(e){const l=e.length;Q.value=l===s.value.length,Y.value=l>0&&l<s.value.length}function oe(){F((()=>{J(),f()}))}return l({RefreshData:oe}),(l,a)=>{const o=g("el-button"),f=g("el-col"),v=g("el-input"),h=g("el-row"),B=g("el-tab-pane"),G=g("el-tabs"),J=g("el-table-column"),ne=g("el-table"),ie=g("InfoFilled"),se=g("el-icon"),ue=g("el-checkbox"),de=g("el-checkbox-group"),re=O("loading");return _(),y("div",null,[I("div",Oe,[w(h,null,{default:k((()=>[w(f,{xs:24,sm:16,md:16,lg:16,xl:16},{default:k((()=>[w(o,{type:"primary",onClick:L,disabled:x(s).length<1},{default:k((()=>a[9]||(a[9]=[C("\u6dfb\u52a0Key")]))),_:1},8,["disabled"]),w(o,{icon:"delete",onClick:ee,disabled:!e.status},{default:k((()=>a[10]||(a[10]=[C("\u6e05\u7a7a\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),w(o,{icon:"refresh",onClick:oe})])),_:1}),w(f,{xs:24,sm:8,md:8,lg:8,xl:8},{default:k((()=>[I("div",Pe,[w(v,{modelValue:x(r).search,"onUpdate:modelValue":a[0]||(a[0]=e=>x(r).search=e),clearable:"",onClear:a[1]||(a[1]=e=>b()),"suffix-icon":"Search",onKeyup:a[2]||(a[2]=q((e=>b()),["enter"])),onChange:a[3]||(a[3]=e=>b()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),w(G,{modelValue:x(d),"onUpdate:modelValue":a[4]||(a[4]=e=>S(d)?d.value=e:d=e),onTabClick:M,type:"card"},{default:k((()=>[(_(!0),y(V,null,D(x(s),(e=>(_(),R(B,{key:e.id,label:e.name+"("+e.keynum+")",name:e.id},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),P((_(),R(ne,{data:x(c),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:k((()=>[w(J,{prop:"key",label:"\u952e(key)","min-width":"150","show-overflow-tooltip":""}),w(J,{prop:"value",label:"\u503c(value)","min-width":"180"}),w(J,{prop:"type",label:"\u6570\u636e\u7c7b\u578b","min-width":"109"}),w(J,{prop:"len",label:"\u6570\u636e\u957f\u5ea6","min-width":"120"}),w(J,{prop:"exptime",label:"\u6709\u6548\u671f(\u79d2)","min-width":"120"},{default:k((e=>[C(U(0==e.row.exptime?"\u6c38\u4e45":e.row.exptime),1)])),_:1}),w(J,{fixed:!x(t)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:k((e=>[w(o,{link:"",type:"primary",onClick:l=>function(e){let l=n({},e);l.db=r.value.db,z.value=!0,F((()=>{A.value.handleOpen(l,"\u7f16\u8f91Key",s.value)}))}(e.row)},{default:k((()=>a[11]||(a[11]=[C("\u7f16\u8f91")]))),_:2},1032,["onClick"]),w(o,{link:"",type:"primary",onClick:l=>{return a=e.row,void K.confirm(`\u662f\u5426\u5220\u9664\u3010${a.key}\u3011`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{i.value=!0,u.sysSoftinfoMg({action:"redis_del_val",db:d.value,key:a.key}).then((e=>{i.value=!1,2e3==e.code?(E.success(e.msg),oe()):E.warning(e.msg)}))})).catch((()=>{}));var a}},{default:k((()=>a[12]||(a[12]=[C("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[re,x(i)]]),w(T,{small:!0,"child-msg":x(p),onCallFather:m,border:!1,position:"right"},null,8,["child-msg"]),x(z)?(_(),R(Se,{key:0,ref_key:"moduleAddFlag",ref:A,onClosed:a[5]||(a[5]=e=>S(z)?z.value=!1:z=!1),onRefreshData:oe},null,512)):j("",!0),e.installed?j("",!0):(_(),y("div",Ue)),e.installed?j("",!0):(_(),y("div",Fe,[w(se,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:k((()=>[w(ie)])),_:1}),a[14]||(a[14]=C(" \u5f53\u524d\u672a\u5b89\u88c5Redis\u73af\u5883 ")),w(o,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:H},{default:k((()=>a[13]||(a[13]=[C("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})])),w($,{modelValue:x(N),"onUpdate:modelValue":a[8]||(a[8]=e=>S(N)?N.value=e:N=e),top:"30vh",title:"\u6e05\u7a7a\u6570\u636e\u5e93",width:"560px","before-close":le,showFullScreen:!1},{footer:k((()=>[w(o,{onClick:le,loading:x(W)},{default:k((()=>a[16]||(a[16]=[C("\u53d6\u6d88")]))),_:1},8,["loading"]),w(o,{type:"primary",onClick:ae,loading:x(W)},{default:k((()=>a[17]||(a[17]=[C("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:k((()=>[w(ue,{modelValue:x(Q),"onUpdate:modelValue":a[6]||(a[6]=e=>S(Q)?Q.value=e:Q=e),indeterminate:x(Y),onChange:Z},{default:k((()=>a[15]||(a[15]=[I("span",{style:{"font-weight":"bold","font-size":"15px"}},"\u5168\u9009",-1),C("(\u4e3a\u7a7a\u6216\u5168\u9009\u8868\u793a\u6e05\u7a7a\u6240\u6709\u6570\u636e\u5e93) ")]))),_:1},8,["modelValue","indeterminate"]),I("div",Be,[w(de,{modelValue:x(X),"onUpdate:modelValue":a[7]||(a[7]=e=>S(X)?X.value=e:X=e),onChange:te},{default:k((()=>[(_(!0),y(V,null,D(x(s),(e=>(_(),R(ue,{key:e.id,label:e.name,value:e.id},{default:k((()=>[C(U(e.name),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-23a718f6"]]),Me={style:{"margin-bottom":"20px"},class:"lystatuscard"},ze={class:"lyflex"},Te={class:"lyflex"},$e={key:0,class:"lyflex"},Ae=A({__name:"index",setup(e){const l=b(),a=v();let t=B((()=>a.ismobile)),o=h("mysql");function n(e){let l=e.props.name;s.value.id="",s.value.installed=!1,s.value.version="",s.value.status=!1,d(l)}function i(){d(o.value)}let s=h({id:"",installed:!1,version:"",status:!1,name:""});function d(e="mysql"){l.loadingInfo.isLoading=!0,l.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",u.sysSoftinfoMg({name:e,action:"get_soft_info"}).then((a=>{l.loadingInfo.isLoading=!1,l.loadingInfo.content="",2e3==a.code?(s.value=a.data,s.value.installed&&("redis"!=e||s.value.status)&&function(e="mysql"){F((()=>{"mysql"==e?f.value.RefreshData():"redis"==e&&V.value.RefreshData()}))}(e)):E.warning(a.msg)}))}function r(e="stop"){let a="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",t=!1,o="\u542f\u52a8\u6210\u529f";"stop"==e?(l.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",t=!1,o="\u505c\u6b62\u6210\u529f"):"reload"==e?(l.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",a="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",t=!0,o="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==e&&(l.loadingInfo.content=s.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",a=s.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",t=!0,o=s.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),K.confirm(`${a}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((a=>{l.loadingInfo.isLoading=!0,u.sysSoftManage({id:s.value.id,status:e,action:"status"}).then((e=>{l.loadingInfo.isLoading=!1,l.loadingInfo.content="",2e3==e.code?(E.success(o),s.value.status=t):E.warning(e.msg)}))})).catch((()=>{}))}let p=h(!1),c=h(null);function m(){p.value=!0,F((()=>{c.value.handleOpen(s.value,"\u3010"+s.value.name+"("+s.value.version+")\u3011\u7ba1\u7406")}))}let f=h(null),V=h(null);return M((()=>{d(o.value)})),(e,l)=>{const a=g("el-tag"),u=g("el-button"),d=g("el-divider"),v=g("el-card"),b=g("el-tab-pane"),h=g("el-tabs"),D=g("el-main");return _(),R(D,{class:"ruyi-databases"},{default:k((()=>[w(v,{shadow:"never"},{default:k((()=>[w(h,{modelValue:x(o),"onUpdate:modelValue":l[3]||(l[3]=e=>S(o)?o.value=e:o=e),onTabClick:n},{default:k((()=>[I("div",Me,[w(v,{shadow:"hover",style:z({overflowX:x(t)?"auto":"none"})},{default:k((()=>[I("div",ze,[w(a,{style:{"margin-right":"20px"},effect:"dark",type:"success"},{default:k((()=>[C(U(x(o)),1)])),_:1}),w(a,{style:{"margin-right":"20px"},type:x(s).installed?"success":"info"},{default:k((()=>[C(U(x(s).installed?"\u5df2\u5b89\u88c5":"\u672a\u5b89\u88c5"),1)])),_:1},8,["type"]),w(a,{style:{"margin-right":"20px"}},{default:k((()=>[C("\u7248\u672c: "+U(x(s).version||"\u672a\u77e5"),1)])),_:1}),w(a,{style:{"margin-right":"20px"},type:x(s).status?"success":"danger"},{default:k((()=>[C("\u72b6\u6001: "+U(x(s).status?"\u5df2\u542f\u52a8":"\u672a\u542f\u52a8"),1)])),_:1},8,["type"]),I("div",Te,[w(u,{type:"primary",link:"",onClick:l[0]||(l[0]=e=>r("stop")),disabled:!x(s).installed},{default:k((()=>l[5]||(l[5]=[C("\u505c\u6b62")]))),_:1},8,["disabled"]),w(d,{direction:"vertical"}),w(u,{type:"primary",link:"",onClick:l[1]||(l[1]=e=>r("restart")),disabled:!x(s).installed},{default:k((()=>[C(U(x(s).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1},8,["disabled"])]),"mysql"==x(o)?(_(),y("div",$e,[w(d,{direction:"vertical"}),w(u,{type:"primary",link:"",onClick:l[2]||(l[2]=e=>r("reload")),disabled:!x(s).installed},{default:k((()=>l[6]||(l[6]=[C(U("\u91cd\u8f7d"))]))),_:1},8,["disabled"])])):j("",!0),w(d,{direction:"vertical"}),w(u,{type:"primary",link:"",onClick:m,disabled:!x(s).installed},{default:k((()=>l[7]||(l[7]=[C(U("\u8bbe\u7f6e"))]))),_:1},8,["disabled"])])])),_:1},8,["style"])]),w(b,{label:"MySql",name:"mysql"},{default:k((()=>["mysql"==x(o)?(_(),R(je,{key:0,installed:x(s).installed,status:x(s).status,ref_key:"mysqlRef",ref:f},null,8,["installed","status"])):j("",!0)])),_:1}),w(b,{label:"Redis",name:"redis"},{default:k((()=>["redis"==x(o)?(_(),R(qe,{key:0,installed:x(s).installed,status:x(s).status,ref_key:"redisRef",ref:V},null,8,["installed","status"])):j("",!0)])),_:1})])),_:1},8,["modelValue"])])),_:1}),x(p)?(_(),R(J,{key:0,ref_key:"softInfoFlag",ref:c,onClosed:l[4]||(l[4]=e=>S(p)?p.value=!1:p=!1),onRefreshStatus:i},null,512)):j("",!0)])),_:1})}}},[["__scopeId","data-v-d39c5422"]]);export{Ae as default};
