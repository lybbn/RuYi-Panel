import{_ as o,d as a,A as e}from"./index.9wSm1W-X.js";import{l as t}from"./index.C0GpYgjh.js";import{a as s,E as n}from"./element-plus.C3E-FvSa.js";import{r as l,h as i,ag as r,G as d,o as c,H as u,P as m,a as p,M as f,u as g,D as j,L as v,t as _,n as h}from"./@vue.CQt2tj-6.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./vue-router.BmPBvlxi.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";import"./vue-codemirror.k2zwy4VA.js";import"./codemirror.DMTwtLMy.js";import"./@codemirror.BTYdMWAS.js";import"./@lezer.CQ-BhAmV.js";import"./crelt.DSg10-ms.js";import"./@marijn.Df4efayV.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const y={class:"statusc"},I={class:"lyflex status"},b={class:"lyflex opbtn"},x=o({__name:"supervisor",props:{data:{type:Object}},emits:["refreshStatus"],setup(o,{emit:x}){const C=a(),w=x,L=o;let k=l("status"),S=l({id:null,name:"",error_log:"",status:!1,conf:"",oldConf:""});function V(o="stop"){let a="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",t=!1,l="\u542f\u52a8\u6210\u529f";"stop"==o?(C.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",t=!1,l="\u505c\u6b62\u6210\u529f"):"reload"==o?(C.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",a="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",t=!0,l="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==o&&(C.loadingInfo.content=S.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",a=S.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",t=!0,l=S.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),s.confirm(`${a}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((a=>{C.loadingInfo.isLoading=!0,e.sysSoftManage({id:S.value.id,status:o,action:"status"}).then((o=>{C.loadingInfo.isLoading=!1,C.loadingInfo.content="",2e3==o.code?(n.success(l),S.value.status=t,w("refreshStatus",{id:S.value.id,status:t})):n.warning(o.msg)}))})).catch((()=>{}))}let M=l(null);function T(o){"access_log"==o.props.name?(C.loadingInfo.isLoading=!0,C.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",e.sysSoftManage({id:S.value.id,action:"get_access_log"}).then((o=>{C.loadingInfo.isLoading=!1,C.loadingInfo.content="",2e3==o.code?(S.value.access_log=o.data,h((()=>{M.value&&M.value.scrollToBottom()}))):n.warning(o.msg)}))):"edit_conf"===o.props.name&&(C.loadingInfo.isLoading=!0,C.loadingInfo.content="\u6b63\u5728\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6...",e.sysSoftManage({id:S.value.id,action:"get_conf"}).then((o=>{C.loadingInfo.isLoading=!1,C.loadingInfo.content="",2e3==o.code?(S.value.conf=o.data,S.value.oldConf=o.data):n.warning(o.msg)})))}function B(){if(S.value.oldConf==S.value.conf)return void n.warning("\u914d\u7f6e\u6587\u4ef6\u672a\u53d8\u52a8\uff0c\u65e0\u9700\u4fdd\u5b58!!!");if(""==S.value.conf||null==S.value.conf)return void n.warning("\u914d\u7f6e\u6587\u4ef6\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u914d\u7f6e");s.confirm("\u786e\u5b9a\u8981\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((o=>{C.loadingInfo.isLoading=!0,C.loadingInfo.content="\u6b63\u5728\u4fdd\u5b58\u914d\u7f6e\u6587\u4ef6...",e.sysSoftManage({id:S.value.id,conf:S.value.conf,action:"save_conf"}).then((o=>{C.loadingInfo.isLoading=!1,C.loadingInfo.content="",2e3==o.code?n.success("\u4fdd\u5b58\u6210\u529f"):n.warning(o.msg)}))})).catch((()=>{}))}return i((()=>{S.value.id=L.data.id,S.value.name=L.data.name,S.value.status=L.data.status})),(o,a)=>{const e=r("CaretRight"),s=r("el-icon"),n=r("el-button"),l=r("el-tab-pane"),i=r("el-tabs");return c(),d(i,{"tab-position":"left",modelValue:g(k),"onUpdate:modelValue":a[5]||(a[5]=o=>_(k)?k.value=o:k=o),onTabClick:T},{default:u((()=>[m(l,{label:"\u670d\u52a1\u72b6\u6001",name:"status"},{default:u((()=>[p("div",y,[p("div",I,[p("div",null,"\u5f53\u524d\u72b6\u6001\uff1a"+f(g(S).status?"\u542f\u52a8":"\u505c\u6b62"),1),m(s,{class:j(g(S).status?"on":"off")},{default:u((()=>[m(e)])),_:1},8,["class"])]),p("div",b,[m(n,{onClick:a[0]||(a[0]=o=>V("restart"))},{default:u((()=>[v(f(g(S).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1}),m(n,{onClick:a[1]||(a[1]=o=>V("stop")),disabled:!g(S).status},{default:u((()=>a[6]||(a[6]=[v("\u505c\u6b62")]))),_:1},8,["disabled"]),m(n,{onClick:a[2]||(a[2]=o=>V("reload")),disabled:!g(S).status},{default:u((()=>a[7]||(a[7]=[v("\u91cd\u8f7d\u914d\u7f6e")]))),_:1},8,["disabled"])])])])),_:1}),m(l,{label:"\u914d\u7f6e\u4fee\u6539",name:"edit_conf"},{default:u((()=>[m(t,{modelValue:g(S).conf,"onUpdate:modelValue":a[3]||(a[3]=o=>g(S).conf=o),fontSize:"13px",placeholder:g(S).conf?"":"\u672a\u83b7\u53d6\u914d\u7f6e\u6587\u4ef6",showLineNums:!0,lineWrapping:!0,mode:"javascript",height:"60vh","read-only":!1,ref:"lyCodemirrorConf"},null,8,["modelValue","placeholder"]),m(n,{type:"primary",style:{"margin-top":"10px","margin-bottom":"10px"},onClick:B},{default:u((()=>a[8]||(a[8]=[v("\u4fdd\u5b58\u5e76\u91cd\u8f7d")]))),_:1}),a[9]||(a[9]=p("div",{class:"ry-cj-care"},[p("li",null,"\u82e5\u60a8\u4e0d\u4e86\u89e3Supervisor\u7684\u914d\u7f6e\u6587\u4ef6\u89c4\u5219\uff0c\u8bf7\u52ff\u968f\u610f\u4fee\u6539!!!"),p("li",null,"\u5feb\u6377\u952e CTRL+F \u67e5\u627e\u548c\u66ff\u6362\u5185\u5bb9")],-1))])),_:1}),m(l,{label:"\u8fd0\u884c\u65e5\u5fd7",name:"access_log"},{default:u((()=>[m(t,{modelValue:g(S).access_log,"onUpdate:modelValue":a[4]||(a[4]=o=>g(S).access_log=o),fontSize:"13px",placeholder:g(S).access_log?"":"\u5f53\u524d\u6ca1\u6709\u8fd0\u884c\u65e5\u5fd7\uff01",showLineNums:!1,lineWrapping:!1,mode:"log",height:"68vh","read-only":!0,ref_key:"lyCodemirrorAccessLog",ref:M},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-df8afa16"]]);export{x as default};
