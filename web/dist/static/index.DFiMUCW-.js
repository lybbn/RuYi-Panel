import{b as e,j as l,ag as a,aq as o,o as t,c as s,a as i,P as n,H as r,u as d,O as u,a4 as m,G as p,L as c,a5 as g,I as h,k as f,S as v,t as y,C as b,K as _,n as j}from"./@vue.BluSRtaz.js";import{P as w}from"./Pagination.DhOoI1te.js";import{c as k,A as x,u as V,G as C}from"./index.CzVJI0jJ.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{a as I,E}from"./element-plus.CMBwCou9.js";import{l as z}from"./index.GhyFdw6y.js";import"./axios.3Xbkft1r.js";import"./crypto-js.CCePG2on.js";import"./@xterm.8vZnc5Va.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.CjTOZN0C.js";import"./clipboard.55ERAcYO.js";import"./pinia.DhJalR8o.js";import"./@element-plus.sBVz1STF.js";import"./vue-router.CjawWhbh.js";import"./nprogress.B5M_jmCc.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.BccSst5e.js";import"./@vueuse.l0Dx-5Bl.js";import"./@popperjs.CpAfbxx4.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.9DdhAVak.js";import"./async-validator.Cuo4gI4y.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.CUoAWVRo.js";import"./@floating-ui.yzr8CaSr.js";import"./vue-codemirror.DFdUdG36.js";import"./codemirror.BJSsQESG.js";import"./@codemirror.BkM7iGym.js";import"./@lezer.CzslrRCj.js";import"./crelt.DSg10-ms.js";import"./style-mod.Dj2YSJ7-.js";import"./w3c-keyname.f-y9tSbI.js";const T={class:"handle-top"},U={class:"search-sites-input"},A=L({__name:"operatelog",setup(f){const v=k();let y=e(!1),b=e({search:"",page:1,limit:10}),_=e({page:1,limit:10,total:0}),j=e([]),V=e([{id:"",name:"\u5168\u90e8"},{id:"dbmg",name:"\u6570\u636e\u5e93\u7ba1\u7406"},{id:"login",name:"\u7528\u6237\u767b\u5f55"},{id:"safe",name:"\u5b89\u5168"},{id:"softmg",name:"\u8f6f\u4ef6\u7ba1\u7406"},{id:"filemg",name:"\u6587\u4ef6\u7ba1\u7406"},{id:"sitemg",name:"\u7f51\u7ad9\u7ba1\u7406"},{id:"dellog",name:"\u6e05\u7a7a\u65e5\u5fd7"}]),C=e([{id:"1",name:"\u6210\u529f"},{id:"0",name:"\u5931\u8d25"}]);function L(e){b.value.page=e.page,b.value.limit=e.limit,z()}function z(){y.value=!0,x.sysOpLogsList(b.value).then((e=>{y.value=!1,2e3==e.code&&(j.value=e.data.data,_.value.page=e.data.page,_.value.limit=e.data.limit,_.value.total=e.data.total)}))}function A(){b.value.page=1,z()}function S(){I.confirm("\u6e05\u7a7a\u540e\uff0c\u5386\u53f2\u64cd\u4f5c\u8bb0\u5f55\u5c06\u65e0\u6cd5\u518d\u67e5\u8be2\uff0c\u786e\u8ba4\u5220\u9664\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{y.value=!0,v.loadingInfo.isLoading=!0,v.loadingInfo.content="\u6b63\u5728\u6e05\u7a7a...",x.sysOpLogsMg({action:"op_del_all"}).then((e=>{y.value=!1,v.loadingInfo.isLoading=!1,v.loadingInfo.content="",2e3==e.code?(E.success(e.msg),z()):E.warning(e.msg)}))})).catch((()=>{}))}return l((()=>{z()})),(e,l)=>{const f=a("el-option"),v=a("el-select"),k=a("el-button"),x=a("el-col"),I=a("el-input"),E=a("el-row"),O=a("el-table-column"),P=a("el-tag"),B=a("el-table"),M=o("loading");return t(),s("div",null,[i("div",T,[n(E,null,{default:r((()=>[n(x,{xs:24,sm:16,md:16,lg:16,xl:16},{default:r((()=>[n(v,{modelValue:d(b).module,"onUpdate:modelValue":l[0]||(l[0]=e=>d(b).module=e),placeholder:"\u8bf7\u9009\u62e9[\u64cd\u4f5c\u7c7b\u578b]",style:{width:"160px","margin-right":"10px"},onChange:l[1]||(l[1]=e=>A()),filterable:"",clearable:""},{default:r((()=>[(t(!0),s(u,null,m(d(V),(e=>(t(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),n(v,{modelValue:d(b).status,"onUpdate:modelValue":l[2]||(l[2]=e=>d(b).status=e),placeholder:"\u8bf7\u9009\u62e9[\u72b6\u6001]",style:{width:"130px","margin-right":"10px"},onChange:l[3]||(l[3]=e=>A()),filterable:"",clearable:""},{default:r((()=>[(t(!0),s(u,null,m(d(C),(e=>(t(),p(f,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),n(k,{type:"primary",icon:"refresh",circle:"",onClick:z}),n(k,{icon:"Delete",onClick:S},{default:r((()=>l[8]||(l[8]=[c("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1})])),_:1}),n(x,{xs:24,sm:8,md:8,lg:8,xl:8},{default:r((()=>[i("div",U,[n(I,{modelValue:d(b).search,"onUpdate:modelValue":l[4]||(l[4]=e=>d(b).search=e),clearable:"",onClear:l[5]||(l[5]=e=>A()),"suffix-icon":"Search",onKeyup:l[6]||(l[6]=g((e=>A()),["enter"])),onChange:l[7]||(l[7]=e=>A()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),h((t(),p(B,{data:d(j),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:r((()=>[n(O,{prop:"username",label:"\u64cd\u4f5c\u7528\u6237",width:"130"}),n(O,{prop:"module",label:"\u64cd\u4f5c\u7c7b\u578b",width:"130"}),n(O,{prop:"ip",label:"\u8bf7\u6c42IP",width:"135"}),n(O,{prop:"ip_area",label:"IP\u5f52\u5c5e\u5730",width:"160"}),n(O,{prop:"msg",label:"\u8be6\u60c5","min-width":"200","show-overflow-tooltip":""}),n(O,{prop:"status",label:"\u72b6\u6001",width:"100"},{default:r((e=>[e.row.status?(t(),p(P,{key:1,type:"success"},{default:r((()=>l[10]||(l[10]=[c("\u6210\u529f")]))),_:1})):(t(),p(P,{key:0,type:"danger"},{default:r((()=>l[9]||(l[9]=[c("\u5931\u8d25")]))),_:1}))])),_:1}),n(O,{prop:"create_at",label:"\u64cd\u4f5c\u65f6\u95f4",width:"180"})])),_:1},8,["data"])),[[M,d(y)]]),n(w,{small:!0,"child-msg":d(_),onCallFather:L,border:!1,position:"right"},null,8,["child-msg"])])}}},[["__scopeId","data-v-1866d8f9"]]),S={key:0},O={key:0},P={key:0},B={key:0},M=L({__name:"index",setup(i){const u=V(),m=k(),g=C();let w=f((()=>u.ismobile)),L=e("panellog"),T=e("operatelog"),U=e(!1),M=e(""),H=e(300);function N(e){q(e.props.name)}function q(e=""){g.clearAllCancelToken(),M.value="",U.value=!0;let l="";l="syslogServer"==e?"get_runserver_log":"syslogError"==e?"get_runerror_log":"syslogTask"==e?"get_runtask_log":"syslogAccess"==e?"get_runaccess_log":T.value,x.sysOpLogsMg({action:l}).then((e=>{U.value=!1,2e3==e.code&&(M.value=e.data)}))}function G(e=""){I.confirm("\u786e\u5b9a\u8981\u6e05\u7a7a\u65e5\u5fd7\u5417\uff1f","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((l=>{U.value=!0,m.loadingInfo.isLoading=!0,m.loadingInfo.content="\u6b63\u5728\u6e05\u7a7a...",x.sysOpLogsMg({action:"del_given_log",type:e}).then((l=>{U.value=!1,m.loadingInfo.isLoading=!1,m.loadingInfo.content="",2e3==l.code?(E.success(l.msg),q(e)):E.warning(l.msg)}))})).catch((()=>{}))}function K(){H.value=function(e){let l=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-e;var a=navigator.userAgent;return a&&/Android/.test(a)||a&&/iPhone|ipad|ipod|ios/.test(a)?500:l}(212)}function D(){j((()=>{K()}))}return l((()=>{window.addEventListener("resize",D),D()})),v((()=>{window.removeEventListener("resize",D)})),(e,l)=>{const i=a("el-tab-pane"),u=a("el-link"),m=a("el-tabs"),g=a("el-card"),f=a("el-main"),v=o("loading");return t(),p(f,{class:"ruyi-databases"},{default:r((()=>[n(g,{shadow:"never"},{default:r((()=>[n(m,{modelValue:d(L),"onUpdate:modelValue":l[9]||(l[9]=e=>y(L)?L.value=e:L=e)},{default:r((()=>[n(i,{label:"\u9762\u677f\u65e5\u5fd7",name:"panellog"},{default:r((()=>[n(m,{modelValue:d(T),"onUpdate:modelValue":l[8]||(l[8]=e=>y(T)?T.value=e:T=e),type:"card",class:b(d(w)?"":"lyinnertabs"),onTabClick:N},{default:r((()=>[n(i,{label:"\u64cd\u4f5c\u65e5\u5fd7",name:"operatelog"},{default:r((()=>["operatelog"==d(T)?(t(),p(A,{key:0})):_("",!0)])),_:1}),n(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010server\u3011",name:"syslogServer"},{default:r((()=>["syslogServer"==d(T)?h((t(),s("div",S,[n(u,{underline:!1,icon:"delete",onClick:l[0]||(l[0]=e=>G("syslogServer")),disabled:d(U),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:r((()=>l[10]||(l[10]=[c("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),n(z,{modelValue:d(M),"onUpdate:modelValue":l[1]||(l[1]=e=>y(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:d(H),"read-only":!0,bottom:!0,ref:"lyServerLogCodemirror"},null,8,["modelValue","height"])])),[[v,d(U)]]):_("",!0)])),_:1}),n(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010error\u3011",name:"syslogError"},{default:r((()=>["syslogError"==d(T)?h((t(),s("div",O,[n(u,{underline:!1,icon:"delete",onClick:l[2]||(l[2]=e=>G("syslogError")),disabled:d(U),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:r((()=>l[11]||(l[11]=[c("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),n(z,{modelValue:d(M),"onUpdate:modelValue":l[3]||(l[3]=e=>y(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:d(H),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[v,d(U)]]):_("",!0)])),_:1}),n(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010access\u3011",name:"syslogAccess"},{default:r((()=>["syslogAccess"==d(T)?h((t(),s("div",P,[n(u,{underline:!1,icon:"delete",onClick:l[4]||(l[4]=e=>G("syslogAccess")),disabled:d(U),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:r((()=>l[12]||(l[12]=[c("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),n(z,{modelValue:d(M),"onUpdate:modelValue":l[5]||(l[5]=e=>y(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:d(H),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[v,d(U)]]):_("",!0)])),_:1}),n(i,{label:"\u7cfb\u7edf\u65e5\u5fd7\u3010task\u3011",name:"syslogTask"},{default:r((()=>["syslogTask"==d(T)?h((t(),s("div",B,[n(u,{underline:!1,icon:"delete",onClick:l[6]||(l[6]=e=>G("syslogTask")),disabled:d(U),style:{position:"absolute",top:"10px",right:"2vh","z-index":"2222"},type:"danger"},{default:r((()=>l[13]||(l[13]=[c("\u6e05\u7a7a\u65e5\u5fd7")]))),_:1},8,["disabled"]),n(z,{modelValue:d(M),"onUpdate:modelValue":l[7]||(l[7]=e=>y(M)?M.value=e:M=e),mode:"log",showLineNums:!1,height:d(H),"read-only":!0,bottom:!0,ref:"lyErrorLogCodemirror"},null,8,["modelValue","height"])])),[[v,d(U)]]):_("",!0)])),_:1})])),_:1},8,["modelValue","class"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})}}},[["__scopeId","data-v-2d74c8fc"]]);export{M as default};
