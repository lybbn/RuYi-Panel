import{b as e,x as t}from"./@xterm.8vZnc5Va.js";import{E as a,d as l}from"./index.DdU3pFbI.js";import{_ as n}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{b as o,e as i,W as s,o as r,c as u,n as v}from"./@vue.BluSRtaz.js";const c=n({__name:"index",props:{apiSuffix:{type:String,default:""},apiArgs:{type:String},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:1.2},scrollback:{type:Number,default:1e3},theme:{type:Object,default:()=>({foreground:"#F8F8F8",background:"black",cursor:"#F8F8F8"})}},emits:["closed"],setup(n,{expose:c,emit:f}){const p=f;let d=o(null),m=new e.FitAddon,w=o(!1),y=o(!1),S=o(null),g=o(null),b=o(""),h=o(null),k=o(0);const $=n;function z(e=!0){return S.value||(S.value=new t.Terminal({fontFamily:"Monaco, Menlo, Consolas, monospace",rendererType:"canvas",lineHeight:$.lineHeight,fontSize:$.fontSize,scrollback:$.scrollback,convertEol:!0,cursorBlink:!0,disableStdin:!1,cursorStyle:"block",scrollSensitivity:10,rightClickSelectsWord:!0,tabStopWidth:4,theme:$.theme})),d.value&&(S.value.open(d.value),S.value.loadAddon(m),m.fit(),window.addEventListener("resize",W),e&&S.value.onData((e=>T(e))),w.value=!0),w.value}function x(){y.value=!0,b.value&&T(b.value),N()&&g.value.send(JSON.stringify({type:"heartBeat",timestamp:`${(new Date).getTime()}`}))}function O(e){const t=JSON.parse(e.data);switch(t.type){case"cmd":{S.value.element&&S.value.focus();let e=t.data;b.value&&(e=e.replace(b.value.trim(),"").trim(),b.value=""),t.data&&S.value.write(e);break}case"heartBeat":{let e=(new Date).getTime();k.value=Math.abs(e-t.data.timestamp);break}}}function _(e){h.value&&clearInterval(h.value);let t=e.reason;S.value.write(t),S.value.write("\r\n\u8fde\u63a5\u5df2\u5173\u95ed\r\n"),p("closed")}function F(e){let t=e.message;t||(t="\u8fde\u63a5\u4e2d\u65ad"),S.value.write(`\x1b[31m${t}\x1b[m\r\n`)}function N(){return 1===(!!g.value&&g.value.readyState)}function T(e){N()&&g.value.send(JSON.stringify({type:"cmd",data:e}))}function W(){m.fit(),N()&&S.value.onResize((e=>{g.value.send(JSON.stringify({type:"resize",cols:e.cols,rows:e.rows}))}))}function D(e){e.ctrlKey&&(e.preventDefault(),e.deltaY>0?S.value.options.fontSize>12&&(S.value.options.fontSize=S.value.options.fontSize-1):S.value.options.fontSize=S.value.options.fontSize+1,W())}function j(e=!0){h.value&&clearInterval(h.value),window.removeEventListener("resize",W);try{g.value&&g.value.close()}catch(t){}if(e)try{S.value&&S.value.dispose()}catch(t){}d.value&&(d.value.innerHTML="")}const A=i((()=>y.value&&w.value),(e=>{e&&(W(),A())}));return c({init:function(e="",t="",n="",o=""){v((()=>{let i=e||$.apiSuffix,s=t||$.apiArgs;var r;0!==o.length?(r=o,z(!1)&&(S.value.write(r),S.value.on("copy",(e=>{navigator.clipboard.writeText(e)})))):(b.value=n||"",z(!0)&&function(e,t){const n=btoa(a());if(-1!=e.indexOf("://"))g.value=new WebSocket(`${e}?cols=${S.value.cols}&rows=${S.value.rows}&token=${n}&${t}`);else{const a="http:"===window.location.href.split("//")[0]?"ws":"wss",o=l.API_HOST,i=e.replace(/^\/+/,"");g.value=new WebSocket(`${a}://${o}/${i}?cols=${S.value.cols}&rows=${S.value.rows}&token=${n}&${t}`)}g.value.onopen=x,g.value.onmessage=O,g.value.onclose=_,g.value.onerror=F,h.value=setInterval((()=>{if(N()){let e=(new Date).getTime();g.value.send(JSON.stringify({type:"heartBeat",timestamp:`${e}`}))}}),2e4)}(i,s))}))},isWebSocketOpen:N,sendMsg:T,onClose:j,getDelay:function(){return k.value},handleXtermResize:W}),s((()=>{j()})),(e,t)=>(r(),u("div",{ref_key:"lyterminal",ref:d,class:"lyterminal",onWheel:D},null,544))}},[["__scopeId","data-v-608faed9"]]);export{c as l};
