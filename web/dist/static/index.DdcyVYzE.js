var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,n)=>{for(var s in n||(n={}))a.call(n,s)&&o(e,s,n[s]);if(l)for(var s of l(n))t.call(n,s)&&o(e,s,n[s]);return e},s=(e,l,a)=>new Promise(((t,o)=>{var n=e=>{try{i(a.next(e))}catch(l){o(l)}},s=e=>{try{i(a.throw(e))}catch(l){o(l)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,s);i((a=a.apply(e,l)).next())}));import{r as i,ag as u,c as d,o as r,P as p,H as c,u as m,G as f,J as v,L as b,O as h,a6 as g,a as _,t as y,aq as w,I as k,M as C,n as x,k as D,h as V,C as j,a4 as I}from"./@vue.CQt2tj-6.js";import{P}from"./Pagination.Nl1ehftE.js";import{_ as R,l as O,A as S,M as F,j as U,i as q,e as B,k as z,n as M,d as T,u as $}from"./index.9wSm1W-X.js";import{L as A}from"./dialog.sg3oaGqx.js";import{b as L}from"./batchOp.7HSMWQ3v.js";import{a as E,E as H}from"./element-plus.C3E-FvSa.js";import{_ as J}from"./index.B3LAQoLq.js";import{s as G}from"./softInfo.B4xrDuUY.js";import{b as N}from"./vue-router.BmPBvlxi.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";const K=R({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),s=i(!1),w=i("\u6dfb\u52a0\u7f51\u7ad9"),k=i({format:"utf8mb4",db_name:"",remark:"",db_user:"",db_pass:"",accept:"localhost",accept_ips:"",db_type:0,db_host:"127.0.0.1"}),C=i([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),x=i([{id:"127.0.0.1",name:"\u672c\u5730\u670d\u52a1\u5668"}]),D=i([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),V=i({db_name:[{required:!0,message:"\u8bf7\u8f93\u5165\u6570\u636e\u5e93\u540d",trigger:"blur"}],db_user:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",trigger:"blur"}],db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}],accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u6743\u9650",trigger:"blur"}]});function j(){t("closed")}function I(){k.value.db_pass=O(16)}let P=i(null);function R(){P.value.validate((e=>{if(e){s.value=!0;let e=n({},k.value);"ip"!=e.accept&&(e.accept_ips=""),S.sysDatabasesAdd(e).then((e=>{s.value=!1,2e3==e.code?(F(e.msg),j(),t("refreshData")):U(e.msg)}))}}))}return l({handleOpen:function(e,l){w.value=l,o.value=!0,I()}}),(e,l)=>{const a=u("el-option"),t=u("el-select"),n=u("el-input"),i=u("el-form-item"),O=u("el-button"),S=u("el-form");return r(),d("div",null,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[9]||(l[9]=e=>y(o)?o.value=e:o=e),title:m(w),width:"680px","before-close":j},{footer:c((()=>[p(O,{onClick:j,loading:m(s)},{default:c((()=>l[12]||(l[12]=[b("\u53d6\u6d88")]))),_:1},8,["loading"]),p(O,{type:"primary",onClick:R,loading:m(s)},{default:c((()=>l[13]||(l[13]=[b("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:c((()=>[p(S,{inline:!1,model:m(k),rules:m(V),ref_key:"rulesForm",ref:P,"label-position":"right","label-width":"auto"},{default:c((()=>[p(i,{label:"\u6570\u636e\u5e93\u540d\uff1a",prop:"db_name"},{default:c((()=>[p(n,{clearable:"",placeholder:"\u6570\u636e\u5e93\u540d",modelValue:m(k).db_name,"onUpdate:modelValue":l[1]||(l[1]=e=>m(k).db_name=e),modelModifiers:{trim:!0},onInput:l[2]||(l[2]=e=>m(k).db_user=m(k).db_name)},{append:c((()=>[p(t,{modelValue:m(k).format,"onUpdate:modelValue":l[0]||(l[0]=e=>m(k).format=e),style:{width:"140px"}},{default:c((()=>[p(a,{label:"utf8mb4",value:"utf8mb4"}),p(a,{label:"utf-8",value:"utf8"}),p(a,{label:"gbk",value:"gbk"}),p(a,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),p(i,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:c((()=>[p(n,{modelValue:m(k).db_user,"onUpdate:modelValue":l[3]||(l[3]=e=>m(k).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:""},null,8,["modelValue"])])),_:1}),p(i,{label:"\u5bc6\u7801\uff1a",prop:"db_pass"},{default:c((()=>[p(n,{placeholder:"\u5bc6\u7801",modelValue:m(k).db_pass,"onUpdate:modelValue":l[4]||(l[4]=e=>m(k).db_pass=e),modelModifiers:{trim:!0}},{append:c((()=>[p(O,{onClick:I},{default:c((()=>l[10]||(l[10]=[b("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),p(i,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:c((()=>[p(t,{modelValue:m(k).accept,"onUpdate:modelValue":l[5]||(l[5]=e=>m(k).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"},clearable:"",filterable:""},{default:c((()=>[(r(!0),d(h,null,g(m(C),(e=>(r(),f(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===m(k).accept?(r(),f(i,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===m(k).accept?m(D):[]},{default:c((()=>[p(n,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:m(k).accept_ips,"onUpdate:modelValue":l[6]||(l[6]=e=>m(k).accept_ips=e)},null,8,["modelValue"]),l[11]||(l[11]=_("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):v("",!0),p(i,{label:"\u5907\u6ce8\uff1a",prop:"remark"},{default:c((()=>[p(n,{modelValue:m(k).remark,"onUpdate:modelValue":l[7]||(l[7]=e=>m(k).remark=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"\u5907\u6ce8\u4fe1\u606f",clearable:""},null,8,["modelValue"])])),_:1}),p(i,{label:"\u6dfb\u52a0\u5230\uff1a",prop:"db_host"},{default:c((()=>[p(t,{modelValue:m(k).db_host,"onUpdate:modelValue":l[8]||(l[8]=e=>m(k).db_host=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:c((()=>[(r(!0),d(h,null,g(m(x),(e=>(r(),f(a,{key:e.id,label:e.name+"("+e.id+")",value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-dca61120"]]),X=R({__name:"modulePass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),n=i(!1),s=i("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),f=i(!1),v=i({name:"mysql",action:"set_db_pass",passwd:""}),h=i({passwd:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function g(){t("closed")}function _(){v.value.passwd=O(16)}let C=i(null);function x(){C.value.validate((e=>{e&&(n.value=!0,S.sysDatabasesPass(v.value).then((e=>{n.value=!1,2e3==e.code?(F(e.msg),g(),t("refreshData")):U(e.msg)})))}))}return l({handleOpen:function(e,l){s.value=l,o.value=!0,f.value=!0,S.sysDatabasesPass({action:"get_db_pass",name:"mysql"}).then((e=>{f.value=!1,2e3==e.code?v.value.passwd=e.data:U(e.msg)}))}}),(e,l)=>{const a=u("el-button"),t=u("el-input"),i=u("el-form-item"),D=u("el-form"),V=w("loading");return k((r(),d("div",null,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[1]||(l[1]=e=>y(o)?o.value=e:o=e),title:m(s),width:"580px","before-close":g,showFullScreen:!1},{footer:c((()=>[p(a,{onClick:g,loading:m(n)},{default:c((()=>l[3]||(l[3]=[b("\u53d6\u6d88")]))),_:1},8,["loading"]),p(a,{type:"primary",onClick:x,loading:m(n)},{default:c((()=>l[4]||(l[4]=[b("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:c((()=>[p(D,{inline:!1,model:m(v),rules:m(h),ref_key:"rulesForm",ref:C,"label-position":"right","label-width":"auto"},{default:c((()=>[p(i,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"passwd"},{default:c((()=>[p(t,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:m(v).passwd,"onUpdate:modelValue":l[0]||(l[0]=e=>m(v).passwd=e),modelModifiers:{trim:!0}},{append:c((()=>[p(a,{onClick:_},{default:c((()=>l[2]||(l[2]=[b("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[V,m(f)]])}}},[["__scopeId","data-v-6e19df75"]]),Q=R({__name:"moduleResetUserPass",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),n=i(!1),s=i("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),f=i(!1),v=i({id:"",name:"mysql",action:"set_db_user_pass",db_pass:"",db_user:""}),h=i({db_pass:[{required:!0,message:"\u8bf7\u8f93\u5165\u5bc6\u7801",trigger:"blur"}]});function g(){t("closed")}function _(){v.value.db_pass=O(16)}let C=i(null);function x(){C.value.validate((e=>{e&&(n.value=!0,S.sysDatabasesPass(v.value).then((e=>{n.value=!1,2e3==e.code?(F(e.msg),g(),t("refreshData")):U(e.msg)})))}))}return l({handleOpen:function(e,l){if(s.value=l,o.value=!0,e){let l=q(e);v.value.id=l.id,v.value.db_user=l.db_user,v.value.db_pass=l.db_pass}}}),(e,l)=>{const a=u("el-input"),t=u("el-form-item"),i=u("el-button"),D=u("el-form"),V=w("loading");return k((r(),d("div",null,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[2]||(l[2]=e=>y(o)?o.value=e:o=e),title:m(s),width:"580px","before-close":g,showFullScreen:!1},{footer:c((()=>[p(i,{onClick:g,loading:m(n)},{default:c((()=>l[4]||(l[4]=[b("\u53d6\u6d88")]))),_:1},8,["loading"]),p(i,{type:"primary",onClick:x,loading:m(n)},{default:c((()=>l[5]||(l[5]=[b("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:c((()=>[p(D,{inline:!1,model:m(v),rules:m(h),ref_key:"rulesForm",ref:C,"label-position":"right","label-width":"auto"},{default:c((()=>[p(t,{label:"\u7528\u6237\u540d\uff1a",prop:"db_user"},{default:c((()=>[p(a,{modelValue:m(v).db_user,"onUpdate:modelValue":l[0]||(l[0]=e=>m(v).db_user=e),placeholder:"\u7528\u6237\u540d",clearable:"",disabled:!0},null,8,["modelValue"])])),_:1}),p(t,{label:"\u6570\u636e\u5e93\u5bc6\u7801\uff1a",prop:"db_pass"},{default:c((()=>[p(a,{placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",modelValue:m(v).db_pass,"onUpdate:modelValue":l[1]||(l[1]=e=>m(v).db_pass=e),modelModifiers:{trim:!0}},{append:c((()=>[p(i,{onClick:_},{default:c((()=>l[3]||(l[3]=[b("\u968f\u673a\u83b7\u53d6")]))),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[V,m(f)]])}}},[["__scopeId","data-v-a614f0ce"]]),W=R({__name:"moduleAccept",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),n=i(!1),s=i("\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801"),C=i(!1),x=i({id:"",name:"mysql",action:"set_db_accept",accept:"localhost",accept_ips:""}),D=i([{id:"all",name:"\u6240\u6709\u4eba"},{id:"localhost",name:"\u672c\u5730\u670d\u52a1\u5668"},{id:"ip",name:"\u6307\u5b9aIP"}]),V=i([{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u5b9aIP",trigger:"blur"}]),j=i({accept:[{required:!0,message:"\u8bf7\u9009\u62e9\u8bbf\u95ee\u6743\u9650",trigger:"blur"}]});function I(){t("closed")}let P=i(null);function R(){P.value.validate((e=>{e&&(n.value=!0,S.sysDatabasesPass(x.value).then((e=>{n.value=!1,2e3==e.code?(F(e.msg),I(),t("refreshData")):U(e.msg)})))}))}return l({handleOpen:function(e,l){if(s.value=l,o.value=!0,e){let l=q(e);x.value.id=l.id,x.value.accept=l.accept,x.value.accept_ips=l.accept_ips}}}),(e,l)=>{const a=u("el-option"),t=u("el-select"),i=u("el-form-item"),O=u("el-input"),S=u("el-form"),F=u("el-button"),U=w("loading");return k((r(),d("div",null,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[2]||(l[2]=e=>y(o)?o.value=e:o=e),title:m(s),width:"580px","before-close":I,showFullScreen:!1},{footer:c((()=>[p(F,{onClick:I,loading:m(n)},{default:c((()=>l[4]||(l[4]=[b("\u53d6\u6d88")]))),_:1},8,["loading"]),p(F,{type:"primary",onClick:R,loading:m(n)},{default:c((()=>l[5]||(l[5]=[b("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:c((()=>[p(S,{inline:!1,model:m(x),rules:m(j),ref_key:"rulesForm",ref:P,"label-position":"right","label-width":"auto"},{default:c((()=>[p(i,{label:"\u6743\u9650\uff1a",prop:"accept"},{default:c((()=>[p(t,{modelValue:m(x).accept,"onUpdate:modelValue":l[0]||(l[0]=e=>m(x).accept=e),placeholder:"\u8bf7\u9009\u62e9",style:{width:"100%"}},{default:c((()=>[(r(!0),d(h,null,g(m(D),(e=>(r(),f(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"ip"===m(x).accept?(r(),f(i,{key:0,prop:"accept_ips",label:"\u5141\u8bb8IP\uff1a",rules:"ip"===m(x).accept?m(V):[]},{default:c((()=>[p(O,{clearable:"",autosize:{minRows:2,maxRows:5},type:"textarea",modelValue:m(x).accept_ips,"onUpdate:modelValue":l[1]||(l[1]=e=>m(x).accept_ips=e)},null,8,["modelValue"]),l[3]||(l[3]=_("span",{class:"lyInputHelpInfo"},"\u591a\u4e2aip\u4ee5\u82f1\u6587\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982\uff1a192.168.1.20,192.168.2.33",-1))])),_:1},8,["rules"])):v("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),[[U,m(C)]])}}},[["__scopeId","data-v-51a833d1"]]),Y={class:"lyBackupDialog"},Z={key:3},ee=R({__name:"moduleBackup",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1);i(!1);let n=i("\u6570\u636e\u5e93\u5907\u4efd"),v=i(!1),h=i(!1),g=i(""),_=i({fid:"",type:1,page:1,limit:10}),D=i({page:1,limit:10,total:0}),V=i([]),j=i({});function I(){t("closed"),t("refreshData")}function R(e){_.value.page=e.page,_.value.limit=e.limit,O()}function O(){v.value=!0,S.sysBakBackUpList(_.value).then((e=>{v.value=!1,2e3==e.code?(V.value=e.data.data,D.value.page=e.data.page,D.value.limit=e.data.limit,D.value.total=e.data.total):U(e.msg)}))}function M(){h.value=!0,S.sysDatabasesDbtools({action:"backup_db",id:_.value.fid}).then((e=>{h.value=!1,2e3==e.code?(F(e.msg),O()):U(e.msg)}))}let T=i([]),$=i([]);function J(e){$.value=q(e),T.value=e.map((e=>e.id))}let G=i(null);function N(){x((()=>{G.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let K=i(0),X=i("0%"),Q=i(!1),W=i(1),ee=i("");function le(e){return new Promise((l=>setTimeout(l,e)))}function ae(){return s(this,null,(function*(){W.value=2,Q.value=!0,$.value.forEach((e=>{e.status="wait"}));let e=$.value.length,l=0;for(let a=0;a<e;a++){K.value=a+1==e?100:parseInt((a+1)/e*100),X.value=K.value+"%";let t="del_backup_db",o={id:_.value.fid,bid:$.value[a].id,action:t};S.sysDatabasesDbtools(o).then((e=>{2e3==e.code?$.value[a].status="success":($.value[a].status="error",l+=1)})),yield le(1e3)}Q.value=!1,W.value=3,ee.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}return l({handleOpen:function(e,l){n.value=l,o.value=!0,_.value.fid=e.id,g.value=e.db_name,O()}}),(e,l)=>{const a=u("el-button"),t=u("el-form-item"),s=u("el-form"),i=u("el-table-column"),x=u("el-table"),F=u("el-tag"),U=w("loading");return r(),d("div",Y,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[0]||(l[0]=e=>y(o)?o.value=e:o=e),title:m(n),width:"60%","before-close":I,loading:m(h)},{default:c((()=>[p(s,{inline:!1,model:m(_),rules:m(j),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:m(h)},{default:c((()=>[p(t,null,{default:c((()=>[p(a,{type:"primary",onClick:M},{default:c((()=>l[1]||(l[1]=[b("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1}),p(a,{onClick:N,disabled:m(T).length<1},{default:c((()=>l[2]||(l[2]=[b("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),k((r(),f(x,{ref:"table",border:"",data:m(V),height:410,onSelectionChange:J},{default:c((()=>[p(i,{type:"selection",width:"55",align:"center"}),p(i,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),p(i,{prop:"size",label:"\u5927\u5c0f","min-width":"100"},{default:c((e=>[b(C(m(B)(e.row.size)),1)])),_:1}),p(i,{prop:"filename",label:"\u4f4d\u7f6e","min-width":"190","show-overflow-tooltip":""}),p(i,{prop:"create_at",label:"\u65f6\u95f4","min-width":"160"}),p(i,{prop:"store_type",label:"\u5b58\u50a8\u5bf9\u8c61","min-width":"90"}),p(i,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:c((e=>[p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${g.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{v.value=!0;let l={id:_.value.fid,bid:a.id,action:"recover_db_sql"};S.sysDatabasesDbtools(l).then((e=>{v.value=!1,2e3==e.code?(H.success(e.msg),O()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:c((()=>l[3]||(l[3]=[b("\u6062\u590d")]))),_:2},1032,["onClick"]),p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void S.sysBakFileDownload({id:_.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);H.warning(e.msg)}}else z(e.data,a.name)}));var a}},{default:c((()=>l[4]||(l[4]=[b("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{v.value=!0;let l={id:_.value.fid,bid:a.id,action:"del_backup_db"};S.sysDatabasesDbtools(l).then((e=>{v.value=!1,2e3==e.code?(H.success(e.msg),O()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:c((()=>l[5]||(l[5]=[b("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[U,m(v)]]),p(P,{small:!0,"child-msg":m(D),onCallFather:R},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),p(L,{ref_key:"batchOpRef",ref:G,onClosed:O,tip2:m(ee),percentContent:m(X),percentage:m(K),loadingSave:m(Q),stepStatus:m(W)},{table:c((()=>[p(x,{data:m($),border:"","max-height":500},{default:c((()=>[p(i,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),p(i,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:c((e=>["wait"==e.row.status?(r(),f(F,{key:0,type:"info"},{default:c((()=>l[6]||(l[6]=[b("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(r(),f(F,{key:1,type:"success"},{default:c((()=>l[7]||(l[7]=[b("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(r(),f(F,{key:2,type:"danger"},{default:c((()=>l[8]||(l[8]=[b("\u5220\u9664\u5931\u8d25")]))),_:1})):(r(),d("span",Z))])),_:1})])),_:1},8,["data"])])),footer:c((()=>[p(a,{type:"primary",onClick:ae,loading:m(Q)},{default:c((()=>l[9]||(l[9]=[b("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"])])}}},[["__scopeId","data-v-1e331b57"]]),le={class:"lyuploadimport"},ae={key:1,class:"handle-button"},te={class:"handle-drag"},oe={key:0},ne={key:1},se={key:0},ie={key:1,style:{color:"green"}},ue={key:2},de={key:0},re=R({__name:"moduleUpload",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1),n=i(!1),h=i(""),g=i(""),w=i([]),k=i(""),D=i(0),V=i(null),j=i("file"),I=i(null),P=i(null),R=i(!1),O=i(0),S=i("");function F(){t("refreshData"),t("closed")}function U(){R.value=!1,w.value=[],O.value=0,S.value="",T()}function z(e){j.value=e,I.value.webkitdirectory=!1,V.value.$el.querySelector("input").click()}function T(){V.value.clearFiles()}function $(e){e.preventDefault()}function L(e){e.preventDefault();const l=e.dataTransfer.items;if(l)for(let a=0;a<l.length;a++){const e=l[a].webkitGetAsEntry();e&&J(e)}}function E(e){e.preventDefault()}function J(e,l=""){if(l=l||"",e.isFile)e.file((e=>{w.value.push(function(e,l){const a=Date.now(),t=new File([e],e.name,{type:e.type,lastModified:e.lastModified});t.uid=a;let o=e.name;""!=l&&(o=l+e.name);return{name:o,size:e.size,status:"ready",uid:a,raw:t}}(e,l))}));else if(e.isDirectory){e.createReader().readEntries((a=>{for(let t=0;t<a.length;t++)J(a[t],l+e.name+"/")}))}}function G(e,l){const a=l.findIndex((l=>l.name===e.name));if(a!=l.findLastIndex((l=>l.name===e.name))&&e.raw.webkitRelativePath==l[a].raw.webkitRelativePath&&(H.error(e.name+" \u6587\u4ef6\u5df2\u5b58\u5728"),l.pop()),64==e.size||0==e.size){w.value=l;const a=new FileReader;a.readAsDataURL(e.raw),a.onload=()=>s(this,null,(function*(){})),a.onerror=()=>{w.value=w.value.filter((l=>l.uid!==e.uid)),H.error({message:`\u3010${e.name}\u3011\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u4e3a\u7a7a\u6587\u4ef6\u5939`,type:"error",showClose:!0,duration:3e3})}}else w.value=l;!function(){s(this,null,(function*(){x((()=>{let e=P.value.scrollBarRef.wrapRef.offsetHeight;P.value.scrollBarRef.setScrollTop(e)}))}))}()}function N(e){V.value.clearFiles();for(let l=0;l<e.length;l++){const a=e[l];V.value.handleStart(a)}}function K(e,l){l.status="success"}let X=i(0);function Q(e){return s(this,null,(function*(){x((()=>{if(0==(e=e||0))P.value.scrollBarRef.setScrollTop(0);else if(X.value>3){if(e>0){let l=P.value.scrollBarRef.wrapRef.offsetHeight/w.value.length;e=l*X.value}P.value.scrollBarRef.setScrollTop(e)}}))}))}function W(e){return e?e.split("/").slice(0,-1).join("/"):e}function Y(e){let l=0;for(let a=0;a<w.value.length;a++)l+=w.value[a].size;return B(l/e)}function Z(){return s(this,null,(function*(){yield Q(0);const e=new Date;n.value=!0,X.value=0;const l=w.value.slice();for(let a=0;a<l.length;a++){const t=l[a],o=t.size;if(k.value=`\u3010${t.name}\u3011\u5f00\u59cb\u4e0a\u4f20`,o<=5242880){const e=new FormData;e.append("lyfile",t.raw),""!=t.raw.webkitRelativePath?e.append("path",g.value+"/"+W(t.raw.webkitRelativePath)):e.append("path",g.value+"/"+W(t.name)),D.value=0,yield M({url:"/api/sys/fileManage/upload/",formData:e},(e=>{D.value=Math.round(e.loaded/e.total*100)})).then((e=>{2e3===e.code?(X.value++,w.value[a].status="success"):(X.value++,w.value[a].status=e.msg)})).catch((e=>{H({message:e,grouping:!0,type:"warning"}),X.value++,w.value[a].status=e}))}else{const e=5242880,l=Math.ceil(o/e);let n=0;D.value=0;for(let s=0;s<l;s++){const i=s*e,u=Math.min(i+e,o),d=t.raw.slice(i,u),r=new FormData;r.append("lyfilechunk",t.name),""!=t.raw.webkitRelativePath?r.append("path",g.value+"/"+W(t.raw.webkitRelativePath)):r.append("path",g.value+"/"+W(t.name)),r.append("chunkSize",e),r.append("totalSize",o),r.append("chunk",d),r.append("chunkIndex",s.toString()),r.append("chunkCount",l.toString());let p=!0;if(yield M({url:"/api/sys/fileManage/upload/",formData:r},(e=>{D.value=Math.round(100*(n+e.loaded/e.total)/l)})).then((e=>{2e3===e.code?p=!0:(w.value[a].status=e.msg,p=!1)})).catch((e=>{H({message:e,grouping:!0,type:"warning"}),w.value[a].status=e,p=!1})),!p)break;if(n++,n==l){X.value++,w.value[a].status="success";break}}}if(a==l.length-1&&(n.value=!1,k.value="",R.value=!0,X.value==l.length)){const l=(new Date-e)/1e3;O.value=l.toFixed(2),S.value=Y(O.value)}yield Q(30)}n.value=!1}))}return l({handleOpen:function(e,l){h.value=l,o.value=!0;let a=q(e);g.value=a.path,x((()=>{I.value=document.querySelector(".el-upload__input")}))}}),(e,l)=>{const a=u("el-alert"),t=u("el-button"),s=u("upload-filled"),i=u("el-icon"),g=u("el-text"),x=u("el-progress"),j=u("el-upload"),I=u("el-table-column"),q=u("el-table");return r(),d("div",le,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[4]||(l[4]=e=>y(o)?o.value=e:o=e),title:m(h),width:"60%","before-close":F},{footer:c((()=>[p(t,{onClick:F,loading:m(n)},{default:c((()=>l[8]||(l[8]=[b("\u5173\u95ed")]))),_:1},8,["loading"]),m(R)?v("",!0):(r(),f(t,{key:0,type:"primary",onClick:Z,loading:m(n),disabled:m(w).length<1},{default:c((()=>l[9]||(l[9]=[b("\u786e\u8ba4\u4e0a\u4f20")]))),_:1},8,["loading","disabled"]))])),default:c((()=>[m(R)?(r(),f(a,{key:0,style:{"margin-bottom":"10px"},title:"\u4e0a\u4f20\u6210\u529f"+m(X)+"\u4e2a\uff0c\u8017\u65f6"+m(O)+"\u79d2\uff0c\u5e73\u5747\u901f\u5ea6"+m(S),type:"success",onClick:U},null,8,["title"])):v("",!0),m(R)?v("",!0):(r(),d("div",ae,[_("div",null,[p(t,{type:"primary",onClick:l[0]||(l[0]=e=>z("file"))},{default:c((()=>l[5]||(l[5]=[b("\u4e0a\u4f20\u6587\u4ef6")]))),_:1})]),_("div",null,[p(t,{onClick:T},{default:c((()=>l[6]||(l[6]=[b("\u6e05\u7a7a\u5217\u8868")]))),_:1})])])),_("div",null,[_("div",{class:"el-upload-dragger",onDragover:$,onDrop:L,onDragleave:E},[_("div",te,[_("div",{onClick:l[1]||(l[1]=e=>z("file"))},[p(i,{class:"el-icon--upload"},{default:c((()=>[p(s)])),_:1}),l[7]||(l[7]=_("div",{class:"el-upload__text"}," \u8bf7\u62d6\u62fd\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u5230\u6b64\u5904\uff08\u4ec5\u652f\u6301.sql\u3001.zip\u3001.tar.gz\uff09 ",-1))])])],32)]),p(j,{ref_key:"lyUploadRef",ref:V,accept:".sql,.zip,.tar.gz","show-file-list":!1,multiple:"","file-list":m(w),"onUpdate:fileList":l[2]||(l[2]=e=>y(w)?w.value=e:w=e),action:"#","auto-upload":!1,"on-change":G,"on-exceed":N,"on-success":K},{tip:c((()=>[p(g,null,{default:c((()=>[b(C(m(k)),1)])),_:1}),m(n)?(r(),f(x,{key:0,"text-inside":"","stroke-width":20,percentage:m(D)},null,8,["percentage"])):v("",!0)])),_:1},8,["file-list"]),p(q,{ref_key:"tableContainer",ref:P,data:m(w),"table-layout":"auto","max-height":"300px","scrollbar-always-on":!0},{default:c((()=>[p(I,{prop:"name","min-width":"200",label:"\u6587\u4ef6\u540d","show-overflow-tooltip":""},{default:c((e=>[""!=e.row.raw.webkitRelativePath?(r(),d("span",oe,C(e.row.raw.webkitRelativePath),1)):(r(),d("span",ne,C(e.row.name),1))])),_:1}),p(I,{prop:"size","min-width":"100",label:"\u5927\u5c0f","show-overflow-tooltip":""},{default:c((e=>[b(C(m(B)(e.row.size)),1)])),_:1}),p(I,{prop:"status","min-width":"90",label:"\u72b6\u6001","show-overflow-tooltip":""},{default:c((e=>["ready"==e.row.status?(r(),d("span",se,"\u7b49\u5f85\u4e0a\u4f20")):"success"==e.row.status?(r(),d("span",ie,"\u4e0a\u4f20\u6210\u529f")):(r(),d("span",ue,C(e.row.status),1))])),_:1}),p(I,{width:"45",fixed:"right"},{default:c((a=>["success"==a.row.status||m(n)?v("",!0):(r(),d("span",de,[p(t,{type:"primary",link:"",onClick:l[3]||(l[3]=l=>{return a=e.index,void w.value.splice(a,1);var a}),icon:"Close"})]))])),_:1})])),_:1},8,["data"])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-b642ba8c"]]),pe={class:"lyBackupDialog"},ce={key:3},me=R({__name:"moduleImport",emits:["refreshData","closed"],setup(e,{expose:l,emit:a}){const t=a;let o=i(!1);i(!1);let h=i("\u6570\u636e\u5e93\u5907\u4efd"),g=i(!1),_=i(!1),D=i(""),V=i({fid:"",type:1,page:1,limit:10}),j=i({page:1,limit:10,total:0}),I=i([]),R=i({});function O(){t("closed"),t("refreshData")}function F(e){V.value.page=e.page,V.value.limit=e.limit,M()}function M(){g.value=!0;let e=n({},V.value);e.fid="",S.sysBakBackUpList(e).then((e=>{g.value=!1,2e3==e.code?(I.value=e.data.data,j.value.page=e.data.page,j.value.limit=e.data.limit,j.value.total=e.data.total):U(e.msg)}))}let T=i([]),$=i([]);function J(e){$.value=q(e),T.value=e.map((e=>e.id))}let G=i(null);function N(){x((()=>{G.value.handleOpen(null,"\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6")}))}let K=i(0),X=i("0%"),Q=i(!1),W=i(1),Y=i("");function Z(e){return new Promise((l=>setTimeout(l,e)))}function ee(){return s(this,null,(function*(){W.value=2,Q.value=!0,$.value.forEach((e=>{e.status="wait"}));let e=$.value.length,l=0;for(let a=0;a<e;a++){K.value=a+1==e?100:parseInt((a+1)/e*100),X.value=K.value+"%";let t="del_backup_db",o={id:V.value.fid,bid:$.value[a].id,action:t};S.sysDatabasesDbtools(o).then((e=>{2e3==e.code?$.value[a].status="success":($.value[a].status="error",l+=1)})),yield Z(1e3)}Q.value=!1,W.value=3,Y.value=`\u6279\u91cf\u5220\u9664\u5907\u4efd\u6587\u4ef6\u5df2\u5b8c\u6210\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let le=i(null),ae=i(!1);function te(){ae.value=!0,x((()=>{le.value.handleOpen({path:"backup_datebase_path"},"\u4e0a\u4f20\u6587\u4ef6\u5230")}))}return l({handleOpen:function(e,l){h.value=l,o.value=!0,V.value.fid=e.id,D.value=e.db_name,M()}}),(e,l)=>{const a=u("el-button"),t=u("el-form-item"),n=u("el-form"),s=u("el-table-column"),i=u("el-table"),x=u("el-tag"),U=w("loading");return r(),d("div",pe,[p(A,{modelValue:m(o),"onUpdate:modelValue":l[0]||(l[0]=e=>y(o)?o.value=e:o=e),title:m(h),width:"60%","before-close":O,loading:m(_)},{default:c((()=>[p(n,{inline:!1,model:m(V),rules:m(R),ref:"rulesForm","label-position":"right","label-width":"auto",disabled:m(_)},{default:c((()=>[p(t,null,{default:c((()=>[p(a,{type:"primary",onClick:te},{default:c((()=>l[2]||(l[2]=[b("\u70b9\u51fb\u4e0a\u4f20")]))),_:1}),p(a,{onClick:N,disabled:m(T).length<1},{default:c((()=>l[3]||(l[3]=[b("\u5220\u9664")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["model","rules","disabled"]),k((r(),f(i,{ref:"table",border:"",data:m(I),height:410,onSelectionChange:J},{default:c((()=>[p(s,{type:"selection",width:"55",align:"center"}),p(s,{prop:"name",label:"\u540d\u79f0","min-width":"180","show-overflow-tooltip":""}),p(s,{prop:"size",label:"\u5927\u5c0f",width:"120"},{default:c((e=>[b(C(m(B)(e.row.size)),1)])),_:1}),p(s,{prop:"create_at",label:"\u65f6\u95f4",width:"170"}),p(s,{fixed:"right",label:"\u64cd\u4f5c",width:"150"},{default:c((e=>[p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6\u5f53\u524d\u6570\u636e\u5e93\u3010${D.value}\u3011\uff0c\u786e\u5b9a\u8981\u6062\u590d\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{g.value=!0;let l={id:V.value.fid,bid:a.id,action:"recover_db_sql"};S.sysDatabasesDbtools(l).then((e=>{g.value=!1,2e3==e.code?(H.success(e.msg),M()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:c((()=>l[4]||(l[4]=[b("\u5bfc\u5165")]))),_:2},1032,["onClick"]),p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void S.sysBakFileDownload({id:V.value.fid,bid:a.id,action:"download_backup_db"}).then((e=>{if("application/json"==e.headers["content-type"]){const l=new FileReader;l.readAsText(e.data),l.onload=()=>{const e=JSON.parse(l.result);H.warning(e.msg)}}else z(e.data,a.name)}));var a}},{default:c((()=>l[5]||(l[5]=[b("\u4e0b\u8f7d")]))),_:2},1032,["onClick"]),p(a,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${a.name}\u3011\u5907\u4efd\u6587\u4ef6\u5417\uff1f`,"\u63d0\u9192",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{g.value=!0;let l={id:V.value.fid,bid:a.id,action:"del_backup_db"};S.sysDatabasesDbtools(l).then((e=>{g.value=!1,2e3==e.code?(H.success(e.msg),M()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:c((()=>l[6]||(l[6]=[b("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[U,m(g)]]),p(P,{small:!0,"child-msg":m(j),onCallFather:F},null,8,["child-msg"])])),_:1},8,["modelValue","title","loading"]),p(L,{ref_key:"batchOpRef",ref:G,onClosed:M,tip2:m(Y),percentContent:m(X),percentage:m(K),loadingSave:m(Q),stepStatus:m(W)},{table:c((()=>[p(i,{data:m($),border:"","max-height":500},{default:c((()=>[p(s,{prop:"name",label:"\u540d\u79f0","min-width":"280","show-overflow-tooltip":""}),p(s,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:c((e=>["wait"==e.row.status?(r(),f(x,{key:0,type:"info"},{default:c((()=>l[7]||(l[7]=[b("\u7b49\u5f85\u5220\u9664")]))),_:1})):"success"==e.row.status?(r(),f(x,{key:1,type:"success"},{default:c((()=>l[8]||(l[8]=[b("\u5220\u9664\u6210\u529f")]))),_:1})):"error"==e.row.status?(r(),f(x,{key:2,type:"danger"},{default:c((()=>l[9]||(l[9]=[b("\u5220\u9664\u5931\u8d25")]))),_:1})):(r(),d("span",ce))])),_:1})])),_:1},8,["data"])])),footer:c((()=>[p(a,{type:"primary",onClick:ee,loading:m(Q)},{default:c((()=>l[10]||(l[10]=[b("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip2","percentContent","percentage","loadingSave","stepStatus"]),m(ae)?(r(),f(re,{key:0,ref_key:"moduleUploadFlag",ref:le,onRefreshData:M,onClosed:l[1]||(l[1]=e=>y(ae)?ae.value=!1:ae=!1)},null,512)):v("",!0)])}}},[["__scopeId","data-v-8b70903f"]]),fe={class:"ruyi-mysql-databases"},ve={style:{"margin-bottom":"20px"},class:"lystatuscard"},be={class:"lyflex"},he={class:"lyflex"},ge={class:"lyflex"},_e={class:"handle-top"},ye={class:"search-sites-input"},we={key:0},ke={key:1,class:"lyflex"},Ce={key:0,class:"pass-item",style:{"margin-right":"8px"}},xe={key:1,style:{"margin-right":"8px"}},De={key:0},Ve={key:1},je={key:2},Ie={key:0},Pe={key:1},Re={key:0},Oe={key:3},Se={key:7,class:"softmask"},Fe={key:8,class:"soft-ins-guide-dialog"},Ue=R({__name:"index",setup(e,{expose:l}){const a=T(),t=$();let o=D((()=>t.ismobile)),n=i(!1);const h=N();let g=i({search:"",db_type:0,page:1,limit:10}),R=i({page:1,limit:10,total:0}),O=i([]),F=i([]),U=i([]);function q(e){U.value=e,F.value=e.map((e=>e.id))}function B(e){g.value.page=e.page,g.value.limit=e.limit,te()}function z(){A("mysql")}let M=i({id:"",installed:!1,version:"",status:!1,name:""});function A(e="mysql"){a.loadingInfo.isLoading=!0,a.loadingInfo.content="\u6b63\u5728\u83b7\u53d6...",S.sysSoftinfoMg({name:e,action:"get_soft_info"}).then((e=>{a.loadingInfo.isLoading=!1,a.loadingInfo.content="",2e3==e.code?M.value=e.data:H.warning(e.msg)}))}function Y(e="stop"){let l="\u786e\u5b9a\u8981\u505c\u6b62\u5417\uff1f",t=!1,o="\u542f\u52a8\u6210\u529f";"stop"==e?(a.loadingInfo.content="\u6b63\u5728\u505c\u6b62\u4e2d...",t=!1,o="\u505c\u6b62\u6210\u529f"):"reload"==e?(a.loadingInfo.content="\u6b63\u5728\u91cd\u8f7d\u914d\u7f6e\u4e2d...",l="\u786e\u5b9a\u8981\u91cd\u8f7d\u914d\u7f6e\u5417\uff1f",t=!0,o="\u91cd\u8f7d\u914d\u7f6e\u6210\u529f"):"restart"==e&&(a.loadingInfo.content=M.value.status?"\u6b63\u5728\u91cd\u542f\u4e2d...":"\u6b63\u5728\u542f\u52a8\u4e2d...",l=M.value.status?"\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f":"\u786e\u5b9a\u8981\u542f\u52a8\u5417\uff1f",t=!0,o=M.value.status?"\u91cd\u542f\u6210\u529f":"\u542f\u52a8\u6210\u529f"),E.confirm(`${l}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((l=>{a.loadingInfo.isLoading=!0,S.sysSoftManage({id:M.value.id,status:e,action:"status"}).then((e=>{a.loadingInfo.isLoading=!1,a.loadingInfo.content="",2e3==e.code?(H.success(o),M.value.status=t):H.warning(e.msg)}))})).catch((()=>{}))}let Z=i(!1),le=i(null);function ae(){Z.value=!0,x((()=>{le.value.handleOpen(M.value,"\u3010"+M.value.name+"("+M.value.version+")\u3011\u7ba1\u7406")}))}function te(){n.value=!0,S.sysDatabases(g.value).then((e=>{if(n.value=!1,2e3===e.code){let l=e.data.data;l.length>0&&l.forEach((e=>{e.showPassword=!1})),O.value=l,R.value.page=e.data.page,R.value.limit=e.data.limit,R.value.total=e.data.total}}))}function oe(){g.value.page=1,te()}let ne=i(!1),se=i(null);function ie(){ne.value=!0,x((()=>{se.value.handleOpen(null,"\u6dfb\u52a0\u6570\u636e\u5e93")}))}let ue=i(!1),de=i(null);function re(){ue.value=!0,x((()=>{de.value.handleOpen(null,"\u4fee\u6539root\u5bc6\u7801")}))}let pe=i(!1),ce=i(null);let Ue=i(!1),qe=i(null);let Be=i(!1),ze=i(null);function Me(){h.push({path:"/appstore"})}let Te=i(0),$e=i("0%"),Ae=i(!1),Le=i(1),Ee=i(""),He=i(""),Je=i(""),Ge=i(null);function Ne(e){Je.value=e;let l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93";"del"==e&&(He.value="\u662f\u5426\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93"),"backup"==e&&(He.value="\u662f\u5426\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\uff1f",l="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93"),x((()=>{Ge.value.handleOpen(null,l)}))}function Ke(e){return new Promise((l=>setTimeout(l,e)))}function Xe(){return s(this,null,(function*(){Le.value=2,Ae.value=!0,U.value.forEach((e=>{e.status="wait","del"==Je.value?e.statusname="\u7b49\u5f85\u5220\u9664":"backup"==Je.value&&(e.statusname="\u7b49\u5f85\u5907\u4efd")}));let e=U.value.length,l=0;for(let t=0;t<e;t++){if(Te.value=t+1==e?100:parseInt((t+1)/e*100),$e.value=Te.value+"%","del"==Je.value)S.sysDatabasesDelete({id:U.value[t].id}).then((e=>{2e3==e.code?(U.value[t].status="success","del"==Je.value?U.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==Je.value&&(U.value[t].statusname="\u5907\u4efd\u6210\u529f")):(U.value[t].status="error",l+=1,"del"==Je.value?U.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==Je.value&&(U.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}));else if("backup"==Je.value){let e={id:U.value[t].id,action:"backup_db"};S.sysDatabasesDbtools(e).then((e=>{2e3==e.code?(U.value[t].status="success","del"==Je.value?U.value[t].statusname="\u5220\u9664\u6210\u529f":"backup"==Je.value&&(U.value[t].statusname="\u5907\u4efd\u6210\u529f")):(U.value[t].status="error",l+=1,"del"==Je.value?U.value[t].statusname="\u5220\u9664\u5931\u8d25":"backup"==Je.value&&(U.value[t].statusname="\u5907\u4efd\u5931\u8d25"))}))}yield Ke(1e3)}Ae.value=!1,Le.value=3;let a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210";"del"==Je.value?a="\u6279\u91cf\u5220\u9664\u6570\u636e\u5e93\u5df2\u5b8c\u6210":"backup"==Je.value&&(a="\u6279\u91cf\u5907\u4efd\u6570\u636e\u5e93\u5df2\u5b8c\u6210"),Ee.value=`${a}\uff0c\u5171${e}\u4e2a\u4efb\u52a1\uff0c\u6210\u529f${e-l}\u4e2a\uff0c\u5931\u8d25${l}\u4e2a!`}))}let Qe=i(!1),We=i(null);function Ye(){x((()=>{te()}))}return V((()=>{A("mysql"),Ye()})),l({RefreshData:Ye}),(e,l)=>{const a=u("el-tag"),t=u("el-button"),s=u("el-divider"),i=u("el-card"),h=u("arrow-down"),D=u("el-icon"),V=u("el-dropdown-item"),T=u("el-dropdown-menu"),$=u("el-dropdown"),A=u("el-col"),N=u("el-input"),Je=u("el-row"),Ke=u("el-table-column"),Ye=u("el-text"),Ze=u("el-table"),el=u("InfoFilled"),ll=w("loading");return r(),d("div",fe,[_("div",ve,[p(i,{shadow:"hover",style:j({overflowX:m(o)?"auto":"none"})},{default:c((()=>[_("div",be,[p(a,{style:{"margin-right":"20px"},effect:"dark",type:"success"},{default:c((()=>l[16]||(l[16]=[b(C("mysql"))]))),_:1}),p(a,{style:{"margin-right":"20px"},type:m(M).installed?"success":"info"},{default:c((()=>[b(C(m(M).installed?"\u5df2\u5b89\u88c5":"\u672a\u5b89\u88c5"),1)])),_:1},8,["type"]),p(a,{style:{"margin-right":"20px"}},{default:c((()=>[b("\u7248\u672c: "+C(m(M).version||"\u672a\u77e5"),1)])),_:1}),p(a,{style:{"margin-right":"20px"},type:m(M).status?"success":"danger"},{default:c((()=>[b("\u72b6\u6001: "+C(m(M).status?"\u5df2\u542f\u52a8":"\u672a\u542f\u52a8"),1)])),_:1},8,["type"]),_("div",he,[p(t,{type:"primary",link:"",onClick:l[0]||(l[0]=e=>Y("stop")),disabled:!m(M).installed},{default:c((()=>l[17]||(l[17]=[b("\u505c\u6b62")]))),_:1},8,["disabled"]),p(s,{direction:"vertical"}),p(t,{type:"primary",link:"",onClick:l[1]||(l[1]=e=>Y("restart")),disabled:!m(M).installed},{default:c((()=>[b(C(m(M).status?"\u91cd\u542f":"\u542f\u52a8"),1)])),_:1},8,["disabled"])]),_("div",ge,[p(s,{direction:"vertical"}),p(t,{type:"primary",link:"",onClick:l[2]||(l[2]=e=>Y("reload")),disabled:!m(M).installed},{default:c((()=>l[18]||(l[18]=[b(C("\u91cd\u8f7d"))]))),_:1},8,["disabled"])]),p(s,{direction:"vertical"}),p(t,{type:"primary",link:"",onClick:ae,disabled:!m(M).installed},{default:c((()=>l[19]||(l[19]=[b(C("\u8bbe\u7f6e"))]))),_:1},8,["disabled"])])])),_:1},8,["style"])]),_("div",_e,[p(Je,null,{default:c((()=>[p(A,{xs:24,sm:16,md:16,lg:16,xl:16},{default:c((()=>[p(t,{type:"primary",onClick:ie,disabled:!m(M).status},{default:c((()=>l[20]||(l[20]=[b("\u6dfb\u52a0\u6570\u636e\u5e93")]))),_:1},8,["disabled"]),p(t,{onClick:re,disabled:!m(M).status},{default:c((()=>l[21]||(l[21]=[b("root\u5bc6\u7801")]))),_:1},8,["disabled"]),p(t,{icon:"refresh",circle:"",onClick:oe}),p($,{disabled:m(F).length<1},{dropdown:c((()=>[p(T,null,{default:c((()=>[p(V,{onClick:l[3]||(l[3]=e=>Ne("del"))},{default:c((()=>l[23]||(l[23]=[b("\u5220\u9664\u6570\u636e\u5e93")]))),_:1}),p(V,{onClick:l[4]||(l[4]=e=>Ne("backup"))},{default:c((()=>l[24]||(l[24]=[b("\u5907\u4efd\u6570\u636e\u5e93")]))),_:1})])),_:1})])),default:c((()=>[p(t,{plain:"",disabled:m(F).length<1},{default:c((()=>[l[22]||(l[22]=b(" \u6279\u91cf\u64cd\u4f5c")),p(D,{class:"el-icon--right"},{default:c((()=>[p(h)])),_:1})])),_:1},8,["disabled"])])),_:1},8,["disabled"])])),_:1}),p(A,{xs:24,sm:8,md:8,lg:8,xl:8},{default:c((()=>[_("div",ye,[p(N,{modelValue:m(g).search,"onUpdate:modelValue":l[5]||(l[5]=e=>m(g).search=e),clearable:"",onClear:l[6]||(l[6]=e=>oe()),"suffix-icon":"Search",onKeyup:l[7]||(l[7]=I((e=>oe()),["enter"])),onChange:l[8]||(l[8]=e=>oe()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),k((r(),f(Ze,{data:m(O),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style",onSelectionChange:q},{default:c((()=>[p(Ke,{type:"selection",width:"55",align:"center"}),p(Ke,{prop:"db_name",label:"\u6570\u636e\u5e93\u540d","min-width":"150","show-overflow-tooltip":""}),p(Ke,{prop:"db_user",label:"\u7528\u6237\u540d","min-width":"100","show-overflow-tooltip":""}),p(Ke,{prop:"db_pass",label:"\u5bc6\u7801","min-width":"150"},{default:c((e=>[""===e.row.db_user?(r(),d("span",we,"-")):v("",!0),e.row.db_pass&&e.row.db_user?(r(),d("div",ke,[e.row.showPassword?v("",!0):(r(),d("div",Ce,l[25]||(l[25]=[_("span",null,"*********",-1)]))),e.row.showPassword?(r(),d("span",xe,C(e.row.db_pass),1)):v("",!0),e.row.showPassword?v("",!0):(r(),f(t,{key:2,link:"",onClick:l=>e.row.showPassword=!0,icon:"View",style:{"margin-right":"5px"}},null,8,["onClick"])),e.row.showPassword?(r(),f(t,{key:3,link:"",onClick:l=>e.row.showPassword=!1,icon:"Hide"},null,8,["onClick"])):v("",!0),_("div",null,[p(J,{content:e.row.db_pass,type:"icon"},null,8,["content"])])])):v("",!0)])),_:1}),p(Ke,{prop:"remark",label:"\u8bbf\u95ee\u6743\u9650",width:"130"},{default:c((e=>["ip"==e.row.accept?(r(),d("span",De,"\u6307\u5b9aIP")):"localhost"==e.row.accept?(r(),d("span",Ve,"\u672c\u5730\u670d\u52a1\u5668")):(r(),d("span",je,"\u6240\u6709\u4eba"))])),_:1}),p(Ke,{prop:"remark",label:"\u4f4d\u7f6e",width:"130"},{default:c((e=>["127.0.0.1"==e.row.db_host||"locahost"==e.row.db_host?(r(),d("span",Ie,"\u672c\u5730")):(r(),d("span",Pe,C("\u8fdc\u7a0b["+e.row.db_host+"]"),1))])),_:1}),p(Ke,{prop:"remark",label:"\u5907\u6ce8","min-width":"130","show-overflow-tooltip":""}),p(Ke,{prop:"remark",label:"\u5907\u4efd | \u5bfc\u5165","min-width":"130"},{default:c((e=>[p(Ye,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,Be.value=!0,void x((()=>{ze.value.handleOpen(a,"\u3010"+a.db_name+"\u3011\u6570\u636e\u5e93\u5907\u4efd")}));var a}},{default:c((()=>[l[26]||(l[26]=b("\u5907\u4efd")),e.row.bak_nums>0?(r(),d("span",Re,C("("+e.row.bak_nums+")"),1)):v("",!0)])),_:2},1032,["onClick"]),p(s,{direction:"vertical"}),p(Ye,{type:"primary",style:{cursor:"pointer"},onClick:l=>{return a=e.row,Qe.value=!0,void x((()=>{We.value.handleOpen(a,"\u5bfc\u5165\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5b57\u7b26\u96c6\uff1a"+a.format)}));var a}},{default:c((()=>l[27]||(l[27]=[b("\u5bfc\u5165")]))),_:2},1032,["onClick"])])),_:1}),p(Ke,{fixed:!m(o)&&"right",label:"\u64cd\u4f5c",width:"190"},{default:c((e=>[p(t,{link:"",type:"primary",onClick:l=>{return a=e.row,Ue.value=!0,void x((()=>{qe.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u6743\u9650")}));var a}},{default:c((()=>l[28]||(l[28]=[b("\u6743\u9650")]))),_:2},1032,["onClick"]),p(t,{link:"",type:"primary",onClick:l=>{return a=e.row,pe.value=!0,void x((()=>{ce.value.handleOpen(a,"\u8bbe\u7f6e\u6570\u636e\u5e93\u3010"+a.db_name+"\u3011\u5bc6\u7801")}));var a}},{default:c((()=>l[29]||(l[29]=[b("\u6539\u5bc6")]))),_:2},1032,["onClick"]),p(t,{link:"",type:"primary",onClick:l=>{return a=e.row,void E.confirm("\u3010\u5f7b\u5e95\u5220\u9664\u3011\u6570\u636e\u5e93\u540e\uff0c\u8be5\u6570\u636e\u5e93\u5185\u7684\u6240\u6709\u6570\u636e\u5c06\u88ab\u5220\u9664\uff0c\u4e14\u4e0d\u53ef\u6062\u590d\uff01\uff01\uff01","\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a\u5220\u9664",type:"warning"}).then((e=>{n.value=!0,S.sysDatabasesDelete({id:a.id}).then((e=>{n.value=!1,2e3==e.code?(H.success(e.msg),te()):H.warning(e.msg)}))})).catch((()=>{}));var a}},{default:c((()=>l[30]||(l[30]=[b("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[ll,m(n)]]),p(P,{small:!0,"child-msg":m(R),onCallFather:B,border:!1,position:"right"},null,8,["child-msg"]),m(ne)?(r(),f(K,{key:0,ref_key:"moduleAddFlag",ref:se,onRefreshData:te,onClosed:l[9]||(l[9]=e=>y(ne)?ne.value=!1:ne=!1)},null,512)):v("",!0),m(ue)?(r(),f(X,{key:1,ref_key:"modulePassFlag",ref:de,onClosed:l[10]||(l[10]=e=>y(ue)?ue.value=!1:ue=!1)},null,512)):v("",!0),m(pe)?(r(),f(Q,{key:2,ref_key:"moduleResetUserPassFlag",ref:ce,onRefreshData:te,onClosed:l[11]||(l[11]=e=>y(pe)?pe.value=!1:pe=!1)},null,512)):v("",!0),m(Ue)?(r(),f(W,{key:3,ref_key:"moduleAcceptFlag",ref:qe,onRefreshData:te,onClosed:l[12]||(l[12]=e=>y(Ue)?Ue.value=!1:Ue=!1)},null,512)):v("",!0),m(Be)?(r(),f(ee,{key:4,ref_key:"moduleBackupFlag",ref:ze,onRefreshData:te,onClosed:l[13]||(l[13]=e=>y(Be)?Be.value=!1:Be=!1)},null,512)):v("",!0),m(Qe)?(r(),f(me,{key:5,ref_key:"moduleImportFlag",ref:We,onRefreshData:te,onClosed:l[14]||(l[14]=e=>y(Qe)?Qe.value=!1:Qe=!1)},null,512)):v("",!0),p(L,{ref_key:"batchOpRef",ref:Ge,width:"680px",onClosed:te,tip1:m(He),tip2:m(Ee),percentContent:m($e),percentage:m(Te),loadingSave:m(Ae),stepStatus:m(Le)},{table:c((()=>[p(Ze,{data:m(U),border:"","max-height":500},{default:c((()=>[p(Ke,{prop:"db_name",label:"\u6570\u636e\u5e93","min-width":"280","show-overflow-tooltip":""}),p(Ke,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:c((e=>["wait"==e.row.status?(r(),f(a,{key:0,type:"info"},{default:c((()=>[b(C(e.row.statusname),1)])),_:2},1024)):"success"==e.row.status?(r(),f(a,{key:1,type:"success"},{default:c((()=>[b(C(e.row.statusname),1)])),_:2},1024)):"error"==e.row.status?(r(),f(a,{key:2,type:"danger"},{default:c((()=>[b(C(e.row.statusname),1)])),_:2},1024)):(r(),d("span",Oe))])),_:1})])),_:1},8,["data"])])),footer:c((()=>[p(t,{type:"primary",onClick:Xe,loading:m(Ae)},{default:c((()=>l[31]||(l[31]=[b("\u786e\u8ba4")]))),_:1},8,["loading"])])),_:1},8,["tip1","tip2","percentContent","percentage","loadingSave","stepStatus"]),m(Z)?(r(),f(G,{key:6,ref_key:"softInfoFlag",ref:le,onClosed:l[15]||(l[15]=e=>y(Z)?Z.value=!1:Z=!1),onRefreshStatus:z},null,512)):v("",!0),m(M).installed?v("",!0):(r(),d("div",Se)),m(M).installed?v("",!0):(r(),d("div",Fe,[p(D,{size:20,color:"var(--el-color-danger)",style:{"margin-right":"10px"}},{default:c((()=>[p(el)])),_:1}),l[33]||(l[33]=b(" \u5f53\u524d\u672a\u5b89\u88c5Mysql\u73af\u5883 ")),p(t,{type:"primary",link:"",style:{"margin-left":"10px","font-size":"15px"},onClick:Me},{default:c((()=>l[32]||(l[32]=[b("\u53bb\u5546\u5e97\u5b89\u88c5")]))),_:1})]))])}}},[["__scopeId","data-v-9daa3135"]]);export{Ue as default};
