import{c as e,i as l,A as a}from"./index.DdU3pFbI.js";import{L as o}from"./dialog.BvK2-1BY.js";import{l as t}from"./index.GhyFdw6y.js";import{_ as n}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E as s}from"./element-plus.CMBwCou9.js";import{b as i,j as u,W as r,n as d,aq as f,o as v,c as m,P as c,H as p,I as g,u as h,t as _}from"./@vue.BluSRtaz.js";const w={class:"lysoftLogDialog"},j=n({__name:"installLog",emits:["refreshData","closed"],setup(n,{expose:j,emit:y}){e();const L=y;let x=i(!1),R=i(!1),V=i("\u65e5\u5fd7\u8be6\u60c5"),C=i({id:""}),I={},b=i("\u52a0\u8f7d\u4e2d..."),D=i("55vh"),T=i("log"),z=i(null),E=i("new_lines");function H(){S(),L("refreshData"),L("closed")}function S(){clearInterval(z.value),z.value=null}u((()=>{window.addEventListener("resize",q),q()})),r((()=>{window.removeEventListener("resize",q),S()}));let U=i(null);function k(){R.value=!0;let e={id:C.value.id,action:E.value};a.sysSoftInstallLogs(e).then((e=>{R.value=!1,2e3==e.code?(b.value=e.data.data,d((()=>{U.value&&U.value.scrollToBottom()})),e.data.done&&"all"!=E.value&&setTimeout((()=>{H()}),2e3)):(s.warning(e.msg),setTimeout((()=>{H()}),2e3))}))}let O=i(null),W=i(!1);function q(){d((()=>{const e=O.value.getRef();if(e.dialogContentRef){const l=e.dialogContentRef.$refs.headerRef.offsetHeight||80,a=document.body.offsetHeight;e.dialogContentRef.fullscreen||W.value?D.value=a-l:D.value="55vh"}}))}function A(e){W.value=e,q()}return j({handleOpen:function(e,a){V.value=a,x.value=!0,e&&(I=l(e),C.value.id=I.id,I.action&&(E.value=I.action),"all"!=E.value?z.value=setInterval((()=>{k()}),2e3):k())}}),(e,l)=>{const a=f("loading");return v(),m("div",w,[c(o,{ref_key:"codeMirrorDialogRef",ref:O,modelValue:h(x),"onUpdate:modelValue":l[1]||(l[1]=e=>_(x)?x.value=e:x=e),title:h(V),width:"50%",onOnChangeFullScreen:A,"before-close":H},{default:p((()=>[g(c(t,{modelValue:h(b),"onUpdate:modelValue":l[0]||(l[0]=e=>_(b)?b.value=e:b=e),fontSize:"15px",placeholder:(h(b),""),showLineNums:!0,lineWrapping:!0,mode:h(T),height:h(D),"read-only":!0,ref_key:"lyCodemirror",ref:U},null,8,["modelValue","placeholder","mode","height"]),[[a,"all"==h(E)&&h(R)]])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-456feb0c"]]);export{j as i};
