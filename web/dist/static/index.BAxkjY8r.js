var e=Object.defineProperty,l=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(l,t,a)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a,i=(e,i)=>{for(var r in i||(i={}))t.call(i,r)&&o(e,r,i[r]);if(l)for(var r of l(i))a.call(i,r)&&o(e,r,i[r]);return e};import{k as r,r as n,i as s,ag as d,aq as p,c as u,o as c,P as m,G as f,J as g,H as h,I as _,u as y,a as v,L as j,t as w,n as b,h as k,a4 as x,V as C,M as V}from"./@vue.CQt2tj-6.js";import{_ as I,d as O,A as G,i as D,u as F,m as P}from"./index.9wSm1W-X.js";import{P as U}from"./Pagination.Nl1ehftE.js";import{L as S}from"./dialog.sg3oaGqx.js";import{l as E}from"./fileList.GFkIKX1Q.js";import{b as L}from"./vue-router.BmPBvlxi.js";import{E as q,a as M}from"./element-plus.C3E-FvSa.js";import{s as T}from"./softInfo.B4xrDuUY.js";import{l as z}from"./dialogTerminal.CWPECdEv.js";import"./axios.BhTbhqQQ.js";import"./crypto-js.BjUPrIIl.js";import"./@xterm.C7qPmoRH.js";import"./js-cookie.Ch5AnFJE.js";import"./vue-clipboard3.c61pm64N.js";import"./clipboard.BBhAuw9K.js";import"./pinia.CWB7oRTw.js";import"./@element-plus.CU4brdXH.js";import"./nprogress.Dzr5m2b3.js";import"./pinia-plugin-persistedstate.DTf8V5gU.js";import"./destr.ZpApkS-1.js";import"./deep-pick-omit.DP_A4OSP.js";import"./lodash-es.CUM784Py.js";import"./@vueuse.7zPzjEtO.js";import"./@popperjs.DxP-MrnL.js";import"./@ctrl.D-8vaqgC.js";import"./dayjs.BpgH7LzR.js";import"./async-validator.BTKOuuO-.js";import"./memoize-one.Ds0C_khL.js";import"./normalize-wheel-es.BhHBPXsK.js";import"./@floating-ui.D1oRyyfp.js";import"./index.CwpTJOPX.js";const A={style:{display:"flex"}},B={class:"ryhelp-tips",style:{display:"flex","align-items":"center"}},R={style:{display:"flex","align-items":"center",width:"100%"}},$={style:{display:"flex","align-items":"center",width:"100%"}},N={style:{width:"150px","padding-left":"20px"}},H=I({__name:"moduleAdd",emits:["refreshData","closed"],setup(e,{expose:l,emit:t}){const a=L(),o=O(),k=t;r((()=>"windows"==o.sysConfig.currentOs));let x=n(!1),C=n(!1),V=n(!0),I=n("\u6dfb\u52a0Go\u9879\u76ee"),F=n({name:"",remark:"",path:"",group:0,type:4,project_cfg:{bin:"",port:"",allowport:!1,start_user:"www",start_command:"",autostart:!0}});s((()=>F.value.project_cfg.sgi),((e,l)=>{const t=F.value.project_cfg;if("django"==t.framework){if(t.application){let a=t.application.replace(l,e);F.value.project_cfg.application=a}if(t.rukou){let l="wsgi"==e?"asgi.py":"wsgi.py",a=t.rukou.replace(l,e+".py");F.value.project_cfg.rukou=a}}})),n([{id:0,name:"\u9ed8\u8ba4\u5206\u7ec4"}]);let P=n([]),U=n(null),M=n(!1);let T=n({name:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0",trigger:"blur"}],path:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u6839\u76ee\u5f55",trigger:"blur"}],"project_cfg.bin":[{required:!0,message:"\u8bf7\u9009\u62e9Go\u9879\u76ee\u7f16\u8bd1\u7684\u53ef\u6267\u884c\u6587\u4ef6",trigger:"blur"}],"project_cfg.start_command":[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u6267\u884c\u547d\u4ee4",trigger:"blur"}]}),z=n([{required:!0,validator:function(e,l,t){const a=parseInt(l,10);isNaN(a)&&t(new Error("\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7aef\u53e3\u53f7")),a<1||a>65534?t(new Error("\u7aef\u53e3\u53f7\u5fc5\u987b\u57280\u523065535\u4e4b\u95f4")):t()},trigger:"blur"}]);function H(){k("closed")}function J(){M.value=!0,b((()=>{U.value.handleOpen({path:F.value.path,isDir:!1},"\u9879\u76ee\u6267\u884c\u6587\u4ef6\u9009\u62e9")}))}function K(e){let l=D(e);F.value.project_cfg.bin=l,F.value.path=l.substring(0,l.lastIndexOf("/")),F.value.name=l.substring(l.lastIndexOf("/")+1,l.length),F.value.project_cfg.start_command=l,X.value.validateField("project_cfg.bin")}function Q(){a.push({path:"/appstore"})}function W(){window.open("https://gitee.com/lybbn/golyadmin")}let X=n(null);function Y(){P.value.length<1?q.warning("\u8bf7\u5148\u5b89\u88c5Go\u73af\u5883"):X.value.validate((e=>{if(e){C.value=!0;let e=i({},F.value);e.action="create_site",G.sysGoSiteMg(e).then((e=>{if(C.value=!1,2e3==e.code){let l=e.data;q.success(e.msg),H(),k("refreshData",l.id,l.name)}else q.warning(e.msg)}))}}))}return l({handleOpen:function(e,l){I.value=l,x.value=!0,V.value=!0,G.sysGetGolangMg({action:"list_version"}).then((e=>{V.value=!1,2e3===e.code&&(P.value=e.data)}))}}),(e,l)=>{const t=d("el-button"),a=d("el-alert"),o=d("el-input"),i=d("el-form-item"),r=d("el-checkbox"),n=d("el-tooltip"),s=d("el-option"),b=d("el-select"),k=d("el-switch"),O=d("el-form"),G=p("loading");return c(),u("div",null,[m(S,{modelValue:y(x),"onUpdate:modelValue":l[8]||(l[8]=e=>w(x)?x.value=e:x=e),title:y(I),width:"730px","before-close":H},{footer:h((()=>[m(t,{onClick:H,loading:y(C)},{default:h((()=>l[16]||(l[16]=[j("\u53d6\u6d88")]))),_:1},8,["loading"]),m(t,{type:"primary",onClick:Y,loading:y(C)},{default:h((()=>l[17]||(l[17]=[j("\u4fdd\u5b58")]))),_:1},8,["loading"])])),default:h((()=>[_((c(),f(O,{inline:!1,model:y(F),rules:y(T),ref_key:"rulesForm",ref:X,"label-position":"right","label-width":"auto"},{default:h((()=>[y(P).length<1?(c(),f(a,{key:0,type:"warning",style:{"margin-bottom":"20px"}},{default:h((()=>[v("div",A,[l[11]||(l[11]=j(" \u5f53\u524d\u672a\u5b89\u88c5go\u73af\u5883\uff0c\u8bf7\u524d\u5f80")),m(t,{link:"",type:"primary",onClick:Q},{default:h((()=>l[10]||(l[10]=[j("\u3010\u5e94\u7528\u5546\u5e97\u3011")]))),_:1}),l[12]||(l[12]=j("\u5b89\u88c5 "))])])),_:1})):g("",!0),m(i,{label:"\u6267\u884c\u6587\u4ef6\uff1a",prop:"project_cfg.bin"},{default:h((()=>[m(o,{modelValue:y(F).project_cfg.bin,"onUpdate:modelValue":l[0]||(l[0]=e=>y(F).project_cfg.bin=e),placeholder:"\u8bf7\u9009\u62e9Go\u9879\u76ee\u7f16\u8bd1\u540e\u7684\u6267\u884c\u6587\u4ef6",class:"selectDirs"},{prepend:h((()=>[m(t,{onClick:J,icon:"Folder",type:"primary"})])),_:1},8,["modelValue"]),v("div",B,[l[14]||(l[14]=j("\u8bf7\u63d0\u524d\u7f16\u8bd1go\u9879\u76ee\u6587\u4ef6\uff0c\u7136\u540e\u6b64\u5904\u9009\u62e9\u7f16\u8bd1\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6")),m(t,{onClick:W,size:"small",type:"primary",link:"",icon:"Position"},{default:h((()=>l[13]||(l[13]=[j("\u5e2e\u52a9")]))),_:1})])])),_:1}),m(i,{label:"\u9879\u76ee\u540d\u79f0\uff1a",prop:"name"},{default:h((()=>[v("div",R,[m(o,{modelValue:y(F).name,"onUpdate:modelValue":l[1]||(l[1]=e=>y(F).name=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0",maxlength:"50"},null,8,["modelValue"])])])),_:1}),m(i,{label:"\u9879\u76ee\u76ee\u5f55\uff1a",prop:"path"},{default:h((()=>[m(o,{modelValue:y(F).path,"onUpdate:modelValue":l[2]||(l[2]=e=>y(F).path=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u6839\u76ee\u5f55",class:"selectDirs"},null,8,["modelValue"])])),_:1}),m(i,{label:"\u542f\u52a8\u547d\u4ee4\uff1a",prop:"project_cfg.start_command"},{default:h((()=>[m(o,{modelValue:y(F).project_cfg.start_command,"onUpdate:modelValue":l[3]||(l[3]=e=>y(F).project_cfg.start_command=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u542f\u52a8\u547d\u4ee4",maxlength:"300"},null,8,["modelValue"])])),_:1}),m(i,{label:"\u9879\u76ee\u7aef\u53e3\uff1a",prop:"project_cfg.port",rules:y(z)},{default:h((()=>[v("div",$,[m(o,{ref:"PathInputElement",modelValue:y(F).project_cfg.port,"onUpdate:modelValue":l[4]||(l[4]=e=>y(F).project_cfg.port=e),placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u7aef\u53e3",type:"number",min:"1",max:"65534"},null,8,["modelValue"]),v("div",N,[m(n,{content:"\u9009\u62e9\u653e\u884c\u7aef\u53e3\uff0c\u8868\u793a\u9632\u706b\u5899\u81ea\u52a8\u653e\u901a\u3010\u9879\u76ee\u7aef\u53e3\u3011"},{default:h((()=>[m(r,{modelValue:y(F).project_cfg.allowport,"onUpdate:modelValue":l[5]||(l[5]=e=>y(F).project_cfg.allowport=e),label:"\u653e\u901a\u7aef\u53e3"},null,8,["modelValue"])])),_:1})])]),l[15]||(l[15]=v("span",{class:"ryhelp-tips"},"\u8bf7\u586b\u5199\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u6216\u547d\u4ee4\u542f\u52a8\u65f6\u7684\u9879\u76ee\u7aef\u53e3",-1))])),_:1},8,["rules"]),m(i,{label:"\u542f\u52a8\u7528\u6237\uff1a",prop:"project_cfg.start_user"},{default:h((()=>[m(b,{modelValue:y(F).project_cfg.start_user,"onUpdate:modelValue":l[6]||(l[6]=e=>y(F).project_cfg.start_user=e),placeholder:"\u8bf7\u9009\u62e9\u542f\u52a8\u7528\u6237",style:{width:"100%"},clearable:"",filterable:""},{default:h((()=>[m(s,{key:"root",label:"root",value:"root"}),m(s,{key:"www",label:"www",value:"www"})])),_:1},8,["modelValue"])])),_:1}),m(i,{label:"\u5f00\u673a\u542f\u52a8\uff1a"},{default:h((()=>[m(k,{modelValue:y(F).project_cfg.autostart,"onUpdate:modelValue":l[7]||(l[7]=e=>y(F).project_cfg.autostart=e),"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"\u5f00\u542f","inactive-text":"\u5173\u95ed"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[G,y(V)]])])),_:1},8,["modelValue","title"]),y(M)?(c(),f(E,{key:0,ref_key:"chooseFileShowFlag",ref:U,onChange:K,onClosed:l[9]||(l[9]=e=>w(M)?M.value=!1:M=!1),onlyFileSelect:!0},null,512)):g("",!0)])}}},[["__scopeId","data-v-e9ac7d60"]]),J={class:"handle-top"},K={class:"search-sites-input"},Q={key:0},W={key:1},X={class:"lyczj",style:{display:"flex","align-items":"center"}},Y=["onClick"],Z={key:0,style:{"font-size":"12px","font-weight":"bold"}},ee=I({__name:"index",setup(e,{expose:l}){const t=L(),a=O(),o=F();let s=r((()=>o.ismobile)),I=n(!1),D=n({page:1,limit:10}),S=n({page:1,limit:10,total:0}),E=n([]);function A(e){D.value.page=e.page,D.value.limit=e.limit,B()}function B(){I.value=!0;let e=i({},D.value);G.sysGetGoSiteList(e).then((e=>{I.value=!1,2e3===e.code&&(e.data.data.forEach((e=>{e.showEndDate=!1})),E.value=e.data.data,S.value.page=e.data.page,S.value.limit=e.data.limit,S.value.total=e.data.total)}))}function R(){D.value.page=1,B()}let $=n(!1),N=n(null);function ee(){$.value=!0,b((()=>{N.value.handleOpen(null,"\u6dfb\u52a0Go\u9879\u76ee")}))}let le=n(!1),te=n(null);function ae(e,l){le.value=!0,b((()=>{let t={id:e};te.value.handleOpen(t,"\u6dfb\u52a0\u3010"+l+"\u3011\u9879\u76ee\u65e5\u5fd7\u8be6\u60c5")}))}let oe=n(!1),ie=n(null);function re(e){oe.value=!0;let l={id:e.id,installed:!0,version:"",status:e.status,name:"go_project"};b((()=>{ie.value.handleOpen(l,"\u3010"+e.name+"\u3011\u7ba1\u7406")}))}let ne=n(!1),se=n(null);function de(e,l){let t="\u786e\u5b9a\u542f\u52a8\u7ad9\u70b9\u5417\uff1f",o="\u542f\u52a8\u4e2d...";"stop"==e?(t="\u786e\u5b9a\u8981\u505c\u6b62\u7ad9\u70b9\u5417\uff1f",o="\u505c\u6b62\u4e2d..."):"restart"==e&&(t="\u786e\u5b9a\u8981\u91cd\u542f\u5417\uff1f",o="\u91cd\u542f\u4e2d..."),M.confirm(`${t}`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((t=>{a.loadingInfo.isLoading=!0,a.loadingInfo.content=o,G.sysGoSiteMg({id:l,op:e,action:"set_status"}).then((e=>{a.loadingInfo.isLoading=!1,a.loadingInfo.content="",2e3==e.code?(q.success(e.msg),B()):q.warning(e.msg)}))})).catch((()=>{}))}function pe(){t.push({path:"/appstore"})}function ue(e){E.value.forEach((l=>{l.id==e.id&&(l.status=e.status)}))}function ce(){b((()=>{B()}))}return k((()=>{ce()})),l({RefreshData:ce}),(e,l)=>{const o=d("el-button"),i=d("el-col"),r=d("el-input"),n=d("el-row"),k=d("el-link"),O=d("el-table-column"),F=d("el-tag"),L=d("el-tooltip"),le=d("el-table"),te=p("loading");return c(),u("div",null,[v("div",J,[m(n,null,{default:h((()=>[m(i,{xs:24,sm:16,md:16,lg:16,xl:16},{default:h((()=>[m(o,{type:"primary",onClick:ee},{default:h((()=>l[7]||(l[7]=[j("\u6dfb\u52a0Go\u9879\u76ee")]))),_:1}),m(o,{onClick:pe},{default:h((()=>l[8]||(l[8]=[j("\u5b89\u88c5Go\u73af\u5883")]))),_:1}),m(o,{icon:"refresh",circle:"",onClick:R})])),_:1}),m(i,{xs:24,sm:8,md:8,lg:8,xl:8},{default:h((()=>[v("div",K,[m(r,{modelValue:y(D).search,"onUpdate:modelValue":l[0]||(l[0]=e=>y(D).search=e),clearable:"",onClear:l[1]||(l[1]=e=>R()),"suffix-icon":"Search",onKeyup:l[2]||(l[2]=x((e=>R()),["enter"])),onChange:l[3]||(l[3]=e=>R()),placeholder:"\u641c\u7d22"},null,8,["modelValue"])])])),_:1})])),_:1})]),_((c(),f(le,{data:y(E),style:{width:"100%","border-top":"1px solid var(--el-border-color-lighter)"},"header-cell-class-name":"table-header-style"},{default:h((()=>[m(O,{prop:"name",label:"\u540d\u79f0","min-width":"180"},{default:h((e=>[m(k,{type:"primary",underline:!1,onClick:C((l=>re(e.row)),["stop"])},{default:h((()=>[j(V(e.row.name),1)])),_:2},1032,["onClick"])])),_:1}),m(O,{prop:"status",label:"\u72b6\u6001","min-width":"100"},{default:h((({row:e})=>[e.status?(c(),f(o,{key:0,link:"",type:"success",icon:"VideoPlay",onClick:l=>de("stop",e.id)},{default:h((()=>l[9]||(l[9]=[j(" \u5df2\u542f\u52a8 ")]))),_:2},1032,["onClick"])):(c(),f(o,{key:1,link:"",type:"danger",icon:"VideoPause",onClick:l=>de("start",e.id)},{default:h((()=>l[10]||(l[10]=[j(" \u5df2\u505c\u6b62 ")]))),_:2},1032,["onClick"]))])),_:1}),m(O,{prop:"project_cfg.port",label:"\u7aef\u53e3",width:"90"},{default:h((e=>["command"==e.row.start_method?(c(),u("span",Q)):(c(),u("span",W,V(e.row.project_cfg.port),1))])),_:1}),m(O,{prop:"project_cfg.autostart",label:"\u5f00\u673a\u542f\u52a8",width:"100"},{default:h((e=>[e.row.project_cfg.autostart?(c(),f(F,{key:0,type:"primary"},{default:h((()=>l[11]||(l[11]=[j("\u662f")]))),_:1})):(c(),f(F,{key:1},{default:h((()=>l[12]||(l[12]=[j("\u5426")]))),_:1}))])),_:1}),m(O,{prop:"path",label:"\u9879\u76ee\u76ee\u5f55",width:"90"},{default:h((e=>[v("div",X,[m(L,{effect:"dark",content:e.row.path,placement:"bottom"},{default:h((()=>[v("img",{class:"ruyi-fileicons",src:P,onClick:l=>{var o;(o=e.row).path&&(a.fileInfo.currentDir=o.path,t.push({path:"/files"}))}},null,8,Y)])),_:2},1032,["content"]),e.row.is_default?(c(),u("span",Z,"(\u9ed8\u8ba4\u7ad9)")):g("",!0)])])),_:1}),m(O,{prop:"create_at",label:"\u521b\u5efa\u65f6\u95f4","min-width":"170"}),m(O,{fixed:!y(s)&&"right",label:"\u64cd\u4f5c",width:"200"},{default:h((e=>["windows"!=y(a).sysConfig.currentOs?(c(),f(o,{key:0,link:"",type:"primary",onClick:l=>{return t=e.row,ne.value=!0,void b((()=>{let e={id:0,initcmd:`clear && cd ${t.path} \n`};se.value.handleOpen(e,"\u5982\u610f\u7ec8\u7aef")}));var t}},{default:h((()=>l[13]||(l[13]=[j("\u7ec8\u7aef")]))),_:2},1032,["onClick"])):g("",!0),m(o,{link:"",type:"primary",onClick:l=>de("restart",e.row.id)},{default:h((()=>l[14]||(l[14]=[j("\u91cd\u542f")]))),_:2},1032,["onClick"]),m(o,{link:"",type:"primary",onClick:l=>re(e.row)},{default:h((()=>l[15]||(l[15]=[j("\u914d\u7f6e")]))),_:2},1032,["onClick"]),m(o,{link:"",type:"primary",onClick:l=>{return t=e.row,void M.confirm(`\u786e\u5b9a\u8981\u5220\u9664\u3010${t.name}\u3011\u9879\u76ee\u5417\uff1f\u6b64\u64cd\u4f5c\u4f1a\u5220\u9664\u8be5\u9879\u76ee\u7684\u65e5\u5fd7\u3001\u914d\u7f6e\u4fe1\u606f\u7b49\uff01\uff01\uff01`,"\u8b66\u544a",{closeOnClickModal:!1,cancelButtonText:"\u53d6\u6d88",confirmButtonText:"\u786e\u5b9a",type:"warning"}).then((e=>{a.loadingInfo.isLoading=!0,a.loadingInfo.content="\u5220\u9664\u4e2d...",G.sysGoSiteMg({id:t.id,action:"del_site"}).then((e=>{a.loadingInfo.isLoading=!1,a.loadingInfo.content="",2e3==e.code?(q.success(e.msg),B()):q.warning(e.msg)}))})).catch((()=>{}));var t}},{default:h((()=>l[16]||(l[16]=[j("\u5220\u9664")]))),_:2},1032,["onClick"])])),_:1},8,["fixed"])])),_:1},8,["data"])),[[te,y(I)]]),m(U,{small:!0,"child-msg":y(S),onCallFather:A,border:!1,position:"right"},null,8,["child-msg"]),y($)?(c(),f(H,{key:0,ref_key:"moduleAddFlag",ref:N,onClosed:l[4]||(l[4]=e=>w($)?$.value=!1:$=!1),onRefreshData:ae},null,512)):g("",!0),y(oe)?(c(),f(T,{key:1,ref_key:"softInfoFlag",ref:ie,onClosed:l[5]||(l[5]=e=>w(oe)?oe.value=!1:oe=!1),onRefreshStatus:ue,onRefreshData:B},null,512)):g("",!0),y(ne)?(c(),f(z,{key:2,ref_key:"moduleDialogTerminalFlag",ref:se,onClosed:l[6]||(l[6]=e=>w(ne)?ne.value=!1:ne=!1)},null,512)):g("",!0)])}}},[["__scopeId","data-v-db789d51"]]);export{ee as default};
